(function(a){if(typeof define==="function"&&define.amd){define("bforms-fileupload",["jquery","load-image","jquery-fileupload","jquery.fileupload-validate","jquery-iframe-transport","bforms-ajax"],a)}else{a(window.jQuery,window.loadImage)}})(function(a,c){var b=function(){};b.prototype.options={loadingClass:"loading",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,imageUrlParam:"AvatarUrl",imageSelector:".bs-uploadImage",deleteImageSelector:".bs-deleteImage",hasInitialImage:false,autoUpload:true};b.prototype._init=function(){this.$element=this.element;this._prepareOptions();this._initSelectors();this._initUpload();this._delegateEvents();this._initElement()};b.prototype._delegateEvents=function(){this.$element.on("click",this.options.deleteImageSelector,a.proxy(this._onDeleteClick,this))};b.prototype._initSelectors=function(){this.$image=this.$element.find(this.options.imageSelector)};b.prototype._initElement=function(){if(this.options.hasInitialImage==true){this._toggleBlockDelete(false)}};b.prototype._prepareOptions=function(){if(typeof this.$element.data("hasinitialimage")!=="undefined"){this.options.hasInitialImage=this.$element.data("hasinitialimage")}};b.prototype._initUpload=function(){var d=a.extend(true,{url:this.options.url,autoUpload:this.options.autoUpload,add:a.proxy(this._onAdd,this),start:a.proxy(this._onStart,this),progress:a.proxy(this._onProgress,this),done:a.proxy(this._onDone,this),stop:a.proxy(this._onStop,this),maxFileSize:this.options.maxFileSize,acceptFileTypes:this.options.acceptFileTypes,dropZone:this.$element,formData:a.proxy(this._getFormData,this)},this.options.fileUpload);this.$element.fileupload(d)};b.prototype._onStart=function(){this._toggleLoading(true);this._trigger("start",0,arguments)};b.prototype._onAdd=function(f,d){var g=[];if(d.originalFiles[0]["type"].length&&!this.options.acceptFileTypes.test(d.originalFiles[0]["type"])){g.push({Type:"InvalidFileType",Message:"Not an accepted file type"})}if(d.originalFiles[0]["size"].length&&d.originalFiles[0]["size"]>this.options.maxFileSize){g.push({Type:"MaxFileSize",Message:"Filesize is too big"})}if(g.length>0){this._trigger("onInvalidFile",0,g)}else{this._trigger("add",0,arguments);if(this.options.autoUpload===false){this._currentUploadData=d;if(!c(d.files[0],a.proxy(this._displayPreviewImage,this,d),{canvas:false})){console.log("Your browser does not support the URL or FileReader API.")}}else{d.submit()}}};b.prototype._onProgress=function(){this._trigger("progress",0,arguments)};b.prototype._onDone=function(f,d){var h=d.result.Data;if(h!=null){var g=h[this.options.imageUrlParam];if(g!=null){this._updateImage(g);this._toggleBlockDelete(false);this._trigger("done",0,arguments)}}};b.prototype._onStop=function(){this._toggleLoading(false);this._trigger("stop",0,arguments)};b.prototype._onDeleteClick=function(f){f.preventDefault();f.stopPropagation();this._currentUploadData=null;if(this.options.deleteUrl){var d=this._getExtraData();a.bforms.ajax({url:this.options.deleteUrl,data:d,success:this._onDeleteSuccess,error:this._onDeleteError,context:this})}else{if(typeof this.options.defaultImageUrl!=="undefined"){this._updateImage(this.options.defaultImageUrl)}}this._trigger("delete",0,arguments)};b.prototype._onDeleteSuccess=function(d){if(typeof d[this.options.imageUrlParam]!=="undefined"){this._updateImage(d[this.options.imageUrlParam])}else{if(typeof this.options.defaultImageUrl!=="undefined"){this._updateImage(this.options.defaultImageUrl)}}this._toggleBlockDelete(true)};b.prototype._onDeleteError=function(){};b.prototype._toggleLoading=function(d){if(this.options.loadingClass){if(d){this.$element.addClass(this.options.loadingClass)}else{this.$element.removeClass(this.options.loadingClass)}}};b.prototype._toggleBlockDelete=function(d){if(d){this.$element.find(this.options.deleteImageSelector).addClass("disabled")}else{this.$element.find(this.options.deleteImageSelector).removeClass("disabled")}};b.prototype._updateImage=function(d){if(this.$image.length){if(d.indexOf("?")===-1){d+="?"+new Date()}else{d+="&"+new Date()}this.$image.attr("src",d)}};b.prototype._getExtraData=function(d){if(typeof d!=="object"||d===null){d={}}a.extend(true,d,this.options.extraData);this._trigger("getExtraData",0,d);return d};b.prototype._getFormData=function(){var d=[];if(typeof this.options.getFormData==="function"){d=this.options.getFormData()}return d};b.prototype._displayPreviewImage=function(e,f){if(!(f.src||f instanceof HTMLCanvasElement)){console.log("Loading image file failed")}else{var d=a(f);d.css("width",this.$image.css("width"));d.css("height",this.$image.css("width"));d.attr("class",this.$image.attr("class"));this.$image.replaceWith(d);this.$image=d}};b.prototype.startUpload=function(){if(this._currentUploadData!=null&&typeof this._currentUploadData.submit==="function"){this._currentUploadData.submit()}};b.prototype.getCurrentData=function(){return this._currentUploadData};a.widget("bforms.bsFileUpload",b.prototype)});(function(a){if(typeof define==="function"&&define.amd){define("bforms-inlineQuestion",["jquery","bootstrap","jquery-ui-core","icanhaz"],a)}else{a(window.jQuery)}})(function(a){var b=function(c){this.options=a.extend(true,{},this.options,c)};b.prototype.options={template:'<p>{{question}}</p><hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button> {{/buttons}}',contentTemplate:'{{{content}}}<hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button> {{/buttons}}',jqueryContentTemplate:'<div><span class="js-replaceme"></span><hr />{{#buttons}}<button type="button" class="btn bs-popoverBtn {{cssClass}}"> {{text}} </button> {{/buttons}}</div>',placement:"left",placementArray:"left,right,bottom,top",content:undefined,stretch:false,closeOnOuterClick:true,preventDefault:false};b.prototype._init=function(){if(this.element.hasClass("bs-hasInlineQuestion")){return this.element}this.$element=this.element;this.$element.addClass("bs-hasInlineQuestion");if(this.options.placement==="auto"){this._placementArray=this.options.placementArray.split(",");this.options.placement=a.proxy(this._placementMethod,this)}if(typeof ich.renderPopoverQuestion!=="function"){ich.addTemplate("renderPopoverQuestion",this.options.template)}if(typeof ich.renderPopoverContent!=="function"){ich.addTemplate("renderPopoverContent",this.options.contentTemplate)}if(typeof ich.renderjQueryPopoverContent!=="function"){ich.addTemplate("renderjQueryPopoverContent",this.options.jqueryContentTemplate)}this._addPopover();if(this.options.stretch==true){this.$tip.css("max-width","none")}};b.prototype._delegateEvents=function(){this.$tip.on("click",".bs-popoverBtn",a.proxy(function(d){var f=this.$tip.find(".bs-popoverBtn").index(d.currentTarget),c=this.options.buttons[f];if(c!=null&&typeof c.callback==="function"){d.preventDefault();d.stopPropagation();c.callback.apply(this,arguments)}},this));if(this.options.closeOnOuterClick&&a(document).data("bsPopoverClickHandler")!==true){a(document).on("click",function(f){var d=a(f.target);var c=a(".bs-hasInlineQuestion").filter(function(i,h){var e=a(h),k=e.data("bs.popover"),j=e.data("bformsBsInlineQuestion");if(typeof k!=="undefined"&&k!=null&&j.options.closeOnOuterClick!==false){var g=k.$tip;return g.is(":visible")&&e[0]!=d[0]&&e.find(d).length==0&&d[0]!=g[0]&&g.find(d).length==0}return false});c.bsInlineQuestion("toggle")}).data("bsPopoverClickHandler",true)}};b.prototype._addPopover=function(){this.$element.popover(a.extend(true,{html:true,placement:this.options.placement,content:this.options.cacheContent===true?this._renderPopover():a.proxy(this._renderPopover,this),trigger:this.options.preventDefault?"manual":"click"},this.options.popoverOptions)).addClass("bs-hasInlineQuestion");if(this.options.preventDefault===true){this.$element.on("click",a.proxy(function(c){c.preventDefault();this.$element.popover("toggle")},this))}this.$element.on("show.bs.popover",a.proxy(function(){this._trigger("show",0,arguments)},this));this.$element.on("shown.bs.popover",a.proxy(function(){this._trigger("shown",0,arguments)},this));this.$element.on("hide.bs.popover",a.proxy(function(){this._trigger("hide",0,arguments)},this));this.$element.on("hidden.bs.popover",a.proxy(function(){this._trigger("hidden",0,arguments)},this));this.$tip=this.$element.data("bs.popover").tip();this._delegateEvents()};b.prototype._renderPopover=function(){var d=typeof this.options.content==="undefined"?ich.renderPopoverQuestion(this.options,true):(this.options.content instanceof jQuery?ich.renderjQueryPopoverContent(this.options,true):ich.renderPopoverContent(this.options,true));if(this.options.content instanceof jQuery){var c=a(d);c.find(".js-replaceme").replaceWith(this.options.content);return c}return d};b.prototype.hide=function(){this.$element.popover("hide");return this};b.prototype.show=function(){this.$element.popover("show");return this};b.prototype.toggle=function(){this.$element.popover("toggle");return this};b.prototype.content=function(c,d){if(typeof c!=="undefined"){if(typeof c.content!=="undefined"||d){this.options.content=c.content}if(typeof c.question!=="undefined"||d){this.options.question=c.question}if(typeof c.buttons!=="undefined"||d){this.options.buttons=c.buttons}}return this};b.prototype.destroy=function(){this.hide();this.$element.popover("destroy");this.$element.removeData("bformsBsInlineQuestion");this.$element.removeClass("bs-hasInlineQuestion");this.$tip.remove()};b.prototype._placementMethod=function(l,f){var d=a(l),c=a(f),h=c.offset(),o=h.top,g=h.left,p=a(window).outerHeight(),q=a(window).outerWidth();var e=d.clone().appendTo(a("body")),n=e.outerWidth(),m=e.outerHeight();e.remove();var k={left:g,right:q-c.outerWidth()-g,top:o-a(window).scrollTop(),bottom:p-c.outerHeight()-(o-a(window).scrollTop())};for(var j in this._placementArray){var i=this._placementArray[j];if(i=="right"||i=="left"){if(k[i]>n){return i}}if(i=="top"||i=="bottom"){if(k[i]>m){return i}}}return this._placementArray[0]||"left"};a.widget("bforms.bsInlineQuestion",b.prototype)});(function(a){if(typeof define=="function"&&define.amd){define("bforms-sortable",["jquery","jquery-ui-core","nestedsortable"],a)}else{a(window.jQuery)}})(function(a){var b=function(c){};b.prototype.options={containerSelector:".sortable-container",toolbarFormSelector:".grid_toolbar_form",sortableListSelector:".bs-sortable",itemSelector:".bs-sortable-item",containerClass:"sortable-container",itemClass:"bs-sortable-item",sortableListClass:"bs-sortable",navPillsClass:"nav nav-pills nav-stacked",preventMigration:false};b.prototype.renderers={base:"base",light:"light"};b.prototype.rendererSpecificOptions={base:{handle:"span",items:"li",toleranceElement:"> span",listType:"ol"},light:{handle:"a",items:"li",toleranceElement:"a",listType:"ul",cursor:"pointer"}};b.prototype.serializationMethods={hierarchy:"hierarchy",array:"array"};b.prototype._init=function(){this.$element=this.element;this.$container=this.$element.parents(this.options.containerSelector);this.renderer=this.$container.data("renderer")||this.renderers.base;this._initStyleOptions();this.$element.nestedSortable(this._getSortableOptions())};b.prototype._initStyleOptions=function(){this.$container.css("overflow","auto");if(this.renderer===this.renderers.light){this.$container.find(this.options.itemSelector).css("cursor","default");this.$container.on("click","a",function(c){c.preventDefault();return})}};b.prototype._getSortableOptions=function(){var c={handle:"span",items:"li",toleranceElement:"> span",listType:"ol",helper:a.proxy(this._getSortableHelper,this),isAllowed:a.proxy(this._dropIsAllowed,this),update:a.proxy(this._evSortUpdate,this),start:a.proxy(this._evSortStart,this),stop:a.proxy(this._evSortStop,this)};var d=this.$container.data("renderer")||this.renderers.base,e=this.rendererSpecificOptions[d];c=a.extend(true,c,e);return c};b.prototype._evSortUpdate=function(f,g){var c=g.item,d=c.parents("ul:first");if(this.renderer===this.renderers.light){if(!d.hasClass(this.options.navPillsClass)){d.addClass(this.options.navPillsClass)}if(!d.parent().hasClass(this.options.containerClass)){d.css({"margin-top":"4px","margin-left":"40px"})}}this._trigger("sortUpdate",f,{event:f,ui:g,id:c.data("id"),parentId:d.data("id")})};b.prototype._evSortStop=function(h,k){var c=k.item;var j=this.rendererSpecificOptions[this.renderer].listType,d=c.parents(j+":first"),g=c.find(j+":first");if(!d.hasClass(this.options.sortableListClass)){d.addClass(this.options.sortableListClass)}if(!g.hasClass(this.options.sortableListClass)){g.addClass(this.options.sortableListClass)}var f=c.parents(this.options.sortableListSelector+":first").find(this.options.itemSelector),i=this.renderer===this.renderers.light;f.each(function(l,e){a(e).data("order",""+(l+1));a(e).attr("data-order",""+(l+1));if(i){a(e).css("margin-top","4px")}})};b.prototype._getSortableHelper=function(f,c){var d=c.clone(),g=parseInt(d.css("opacity"));d.css("opacity",0.7*g);return d};b.prototype._dropIsAllowed=function(c,d){if(c==null||d==null){return true}var e=d.data("id"),f=c.parents(this.options.itemSelector+":first").data("id");if(e===f){return true}if(this.options.preventMigration||this.$element.data("migration-permited")==="False"){return false}var g=c.data("appends-to")!=null?c.data("appends-to").split(" "):[];return g.indexOf(""+e)!=-1};b.prototype._serializeAsArray=function(){var c=this.$element.find(this.options.itemSelector),d=[];c.each(a.proxy(function(i,g){var e=a(g),f=e.parents(this.options.itemSelector+":first"),h=e.data("id"),k=f.length!=0?f.data("id"):null,j=e.data("order");d.push({value:h,order:j,parentId:k})},this));return d};b.prototype._serializeAsHierarchy=function(d){d=d||this.$element;var e=[];var c=d.children(this.options.itemSelector);c.each(a.proxy(function(j,i){var f=a(i),g=f.find(this.options.sortableListSelector+":first").children(this.options.itemSelector),h=g.length!=0?this._serializeAsHierarchy(f.find(this.options.sortableListSelector+":first")):null;var k={value:f.data("id"),children:h};e.push(k)},this));return e};b.prototype.serialize=function(c){c=c||this.serializationMethods.hierarchy;switch(c){case this.serializationMethods.hierarchy:return this._serializeAsHierarchy();case this.serializationMethods.array:return this._serializeAsArray();default:return null}};a.widget("bforms.bsSortable",b.prototype);return b});var factory=function(a,c,d){var b=function(e){a.extend(true,this.options,e);this._init()};b.prototype.options={controlsTabSelector:".form_builder-tab.form_builder-controls",formSelector:"form.form_builder-form",formContainerSelector:".form_container",controlItemSelector:".form_builder-controlItem",controlItemsListSelector:".form_builder-controlsList",controlItemAddSelector:".form_builder-controlItem-add",controlItemLabelSelector:".form_builder-controlItem-label",formTabSelector:".form_builder-tab.form_builder-form",controlTabSelector:".form_builder-tabBtn",controlTabsContainerSelector:".form_builder-tabControl",controlsTabWrapperSelector:".form_builder-controlsWrapper",formControlSelector:".form_builder-formControl",formControlAddonSelector:"[data-addon-toggle]",propertiesTabSelector:".form_builder-tab.form_builder-properties",settingsContainerSelector:".form_builder-settingsContainer",inputGroupSelector:".input-group"};b.prototype._addons={grab:{name:"grab",glyphicon:"glyphicon-sort",title:"Sort"},up:{name:"up",glyphicon:"glyphicon-chevron-up",title:"Move up"},down:{name:"down",glyphicon:"glyphicon-chevron-down",title:"Move down"},settings:{name:"settings",glyphicon:"glyphicon-wrench",title:"Settings"},remove:{name:"remove",glyphicon:"glyphicon-remove-circle",title:"Remove"}};b.prototype._controlActions={all:"all",grab:"grab",up:"up",down:"down",settings:"settings",remove:"remove"};b.prototype._init=function(){this._cacheElements();this._initMembers();this._addDelegates();this._initControls();this._initForm();this._initProperties();this._applyDisplayFixes()};b.prototype._cacheElements=function(){this.$element=this.element;this.$controlsTab=this.$element.find(this.options.controlsTabSelector);this.$controlsWrapper=this.$controlsTab.find(this.options.controlsTabWrapperSelector);this.$controlItemsList=this.$controlsTab.find(this.options.controlItemsListSelector);this.$tabsContainer=this.$controlsTab.find(this.options.controlTabsContainerSelector);this.$formTab=this.$element.find(this.options.formTabSelector);this.$propertiesTab=this.$element.find(this.options.propertiesTabSelector);this.$settingsContainer=this.$propertiesTab.find(this.options.settingsContainerSelector);this.$form=this.$element.find(this.options.formSelector)};b.prototype._initMembers=function(){this._defaultActions=this._getDefaultActions();this._customActions=this._getCustomActions();this.renderer=new c({defaultAddons:this._defaultActions.map(a.proxy(this._mapControlActionToControlAddon,this))});this.formModel=[];this.resource=this.options.resource;this.draggedControl=null;var e=this.$element.attr("data-controls")?this.$element.attr("data-controls"):"{}";var f=JSON.parse(e);this.availableControls=f?(f.controls||[]):[];this._settingsTabs={};this._saveModel=[]};b.prototype._initControls=function(){this._renderInitialControls(this.availableControls);this._initControlsTabs();this._initControlsDrag();this._initTabsReceive()};b.prototype._initForm=function(){this._assignUids(this.formModel);this._renderForm(this.formModel);this._initFormControlsSort();this._initFormControlsResize();this._initFormControlActions()};b.prototype._initSpoofModel=function(){this.formModel.push({type:d.controlTypes.textBox,label:"First name",name:"FirstName",glyphicon:"user",size:12,placeholder:"Type your first name here",required:true});this.formModel.push({type:d.controlTypes.textBox,label:"Last name",name:"LastName",glyphicon:"user",size:12,placeholder:"Type your last name here",required:true});this.formModel.push({type:d.controlTypes.singleSelect,label:"Location",name:"Location",glyphicon:"map-marker",size:12,items:[{text:"Bucharest",value:1},{text:"Militari",value:2}],widget:"select2",widgetOptions:{query:function(){}},required:false});this.formModel.push({type:d.controlTypes.radioButtonList,label:"Role",name:"Role",glyphicon:"star",size:12,selectedValue:2,items:[{value:1,label:"Lead"},{value:2,label:"Dev"},{value:3,label:"Tester"}],required:true});this.formModel.push({type:d.controlTypes.textArea,label:"Description",name:"Description",glyphicon:"font",size:12,required:false});this.formModel.push({type:d.controlTypes.tagList,label:"Languages",name:"Languages",glyphicon:"tags",size:12,items:[{value:"C#",text:"C#"},{value:"JavaScript",text:"JavaScript"},{value:"Perl",text:"Perl"}],required:false})};b.prototype._initProperties=function(){var e=this.renderer.renderControlProperties(d.controlTypes.textBox)};b.prototype._applyDisplayFixes=function(){var h=[this.$controlsTab,this.$formTab,this.$propertiesTab];var j,k=0;for(var g in h){var e=h[g],f=this._getHeight(e);if(f>k){k=f;j=g}}for(var g in h){var e=h[g];if(g!==j){e.css("border-left","none");e.css("border-right","none")}}this.$form.find(".form_container").css("min-height","200px")};b.prototype._initControlsDrag=function(){var f=this.$controlsTab.find(this.options.controlItemsListSelector),e=f.find(this.options.controlItemSelector);e.css("background-color","white");f.sortable({cursor:"move",zIndex:100,opacity:"0.85",connectWith:this.$form.find(this.options.formContainerSelector),drag:a.proxy(this._evControlItemsSortDrag,this),helper:a.proxy(this._evControlItemsSortHelper,this),update:a.proxy(this._evControlItemsSortUpdate,this)})};b.prototype._initControlsTabs=function(){this.$controlsTab.on("click",this.options.controlTabSelector,a.proxy(this._evControlTabClick,this));this._updateTabsPositions()};b.prototype._initTabsReceive=function(){var f=this.$controlsTab.find(this.options.controlTabsContainerSelector),e=f.find(this.options.controlTabSelector);f.sortable({items:this.options.controlTabSelector,containment:"document",start:a.proxy(this._evTabsSortStart,this),stop:a.proxy(this._evTabsSortStop,this)});e.droppable({accept:this.options.controlItemSelector,tolerance:"pointer",drop:a.proxy(this._evTabReceive,this),over:a.proxy(this._evTabOver,this),out:a.proxy(this._evTabOut,this)})};b.prototype._initFormControlsSort=function(){this.$form.find(this.options.formContainerSelector).sortable({items:this.options.formControlSelector,handle:'[data-addon-toggle="grab"]',cursor:"move",opacity:"0.85",tolerance:"pointer",receive:a.proxy(this._evFormReceive,this)})};b.prototype._initFormControlsResize=function(){var e=this.$form.find(this.options.formControlSelector),f=this.$form.find(this.options.formControlAddonSelector+'[data-addon-toggle="resize"]');f.addClass("ui-resizable-e ui-resizable-handle");f.css("cursor","ew-resize");var g=this;e.each(function(k,j){var i=a(j),h=i.find(g.options.formControlAddonSelector+'[data-addon-toggle="resize"]');var l=parseInt(i.css("width").replace("px",""));if(h.length!=0){i.resizable({handles:{e:h},grid:[l/2,l/2]})}})};b.prototype._initFormControlActions=function(){this.$form.on("click",this.options.formControlAddonSelector,a.proxy(this._evFormControlActionClick,this))};b.prototype._renderInitialControls=function(k){for(var j in k){var l=this._mapControlModelToControlListModel(k[j]);var e=this.renderer.renderControlListItem(l),f=this._getTab(l.tabId);f.append(e)}var g=this.$element.find(this.options.controlItemsListSelector);var h=this;g.each(function(n,m){var i=a(m).find(h.options.controlItemSelector);i.each(function(p,o){a(o).attr("data-position",p+1)})})};b.prototype._renderForm=function(f){var e=this.$form.find(this.options.formContainerSelector);if(f){e.empty();for(var g in f){this._appendControl(f[g],{noAnimate:true})}}};b.prototype._renderControl=function(f){var e=this._getAddons(f);a.extend(true,f,{addons:e});switch(f.type){case d.controlTypes.textBox:return this.renderer.renderTextBox(f);case d.controlTypes.textArea:return this.renderer.renderTextArea(f);case d.controlTypes.singleSelect:return this.renderer.renderDropdown(f);case d.controlTypes.radioButtonList:return this.renderer.renderRadioButtonList(f);case d.controlTypes.tagList:return this.renderer.renderTagList(f);case d.controlTypes.title:return this.renderer.renderTitle(f);case d.controlTypes.listBox:return this.renderer.renderListBox(f);case d.controlTypes.datePicker:return this.renderer.renderDatePicker(f);case d.controlTypes.datePickerRange:return this.renderer.renderDatePickerRange(f);case d.controlTypes.checkBox:return this.renderer.renderCheckBox(f);case d.controlTypes.checkBoxList:return this.renderer.renderCheckBoxList(f);case d.controlTypes.numberPicker:return this.renderer.renderNumberPicker(f);case d.controlTypes.numberPickerRange:return this.renderer.renderNumberPickerRange(f);case d.controlTypes.pagebreak:return this.renderer.renderPageBreak(f);case d.controlTypes.customControl:return this.renderer.renderCustomControl(f.controlName,f)}return null};b.prototype._addDelegates=function(){this.$controlsTab.on("click",this.options.controlItemAddSelector,a.proxy(this._evControlItemAddClick,this))};b.prototype._evControlItemAddClick=function(k){k.preventDefault();var h=a(k.target).is("a")?a(k.target):a(k.target).parents("a:first"),f=h.parents(this.options.controlItemSelector),g=this.$form.find(this.options.formControlSelector+":last"),i=f.attr("data-controlType"),j=f.attr("data-name"),l=f.attr("data-glyphicon");var m=this._createNewControl(i,j,l);this._appendControl(m,{after:g})};b.prototype._evControlItemsSortUpdate=function(h,i){var g=i.item.parents(this.options.controlItemsListSelector),f=g.find(this.options.controlItemSelector);f.each(function(j,e){a(e).attr("data-position",j+1)})};b.prototype._evControlItemsSortDrag=function(g,h){var f=h.item;this.draggedControlType=f.attr("data-controltype")};b.prototype._evControlItemsSortHelper=function(g,f){return f.get(0)};b.prototype._evFormReceive=function(i,p){var f=p.item,o=parseInt(f.attr("data-controltype")),k=f.attr("data-name"),m=f.attr("data-position"),j=f.attr("data-glyphicon"),h=f.attr("data-name"),n=f.attr("data-tabid"),g=this.renderer.renderControlListItem({type:o,name:k,glyphicon:j,order:m,tabId:n});var l=this._createNewControl(o,h,j);this._appendControlItem(g,{position:m,tabId:n});this._appendControl(l,{replace:p.item})};b.prototype._evFormControlActionClick=function(j){j.preventDefault();var f=a(j.target),g=f.parents(this.options.formControlSelector),h=f.attr("data-addon-toggle"),i=this._getFormControlModel(g);this._handleAction(h,i,{hide:f.hasClass("selected")})};b.prototype._evControlTabClick=function(m){m.preventDefault();var f=a(m.target).is(this.options.controlTabSelector)?a(m.target):a(m.target).parents(this.options.controlTabSelector),j=f.hasClass("selected");if(j){return}var g=f.parent(),p=f.attr("data-tabid");var h=this.$element.find(this.options.controlItemsListSelector),i=h.filter('[data-tabid="'+p+'"]');h.hide();var n=g.find(".selected").attr("data-position"),k=f.attr("data-position");var o=parseInt(n)<=parseInt(k);g.find(this.options.controlTabSelector).removeClass("selected");f.addClass("selected");var l=o?d.directions.right:d.directions.left;this._slideTab(i,l)};b.prototype._evTabReceive=function(l,r){var f=r.draggable,j=a(l.target),p=j.attr("data-tabid");j.removeClass("over");var q=f.attr("data-controltype"),n=f.attr("data-name"),m=f.attr("data-glyphicon");var h=this._getTab(p),i=h.find(this.options.controlItemSelector);var o=i.length+1;f.remove();var k={tabId:p};if(p==f.attr("data-tabid")){o=parseInt(f.attr("data-position"));a.extend(true,k,{position:o})}var g=this.renderer.renderControlListItem({type:q,name:n,glyphicon:m,order:o,tabId:p});this._appendControlItem(g,k)};b.prototype._evTabOver=function(h,i){var f=i.helper,g=a(h.target);g.addClass("over");f.css("opacity",0.2);this.$draggedHelper=f};b.prototype._evTabOut=function(g,h){var f=a(g.target);f.removeClass("over");if(this.$draggedHelper){this.$draggedHelper.css("opacity",1)}};b.prototype._evTabsSortStart=function(g,h){var f=this.$controlsTab.find(this.options.controlItemSelector+":visible");f.addClass("loading")};b.prototype._evTabsSortStop=function(g,h){var f=this.$controlsTab.find(this.options.controlItemSelector+":visible");f.removeClass("loading")};b.prototype._evTabsSortUpdate=function(f,g){this._updateTabsPositions()};b.prototype._appendControl=function(k,n){if(n&&n.replace){n.replace.empty()}var l="",j;try{l=this._renderControl(k)}catch(m){j=m}var h=this.$form.find(this.options.formContainerSelector),g=a(l),f=n?n.after:null,i=n?n.replace:null;g.attr("data-controlType",k.type);g.attr("data-uid",this._generateUid());g.attr("data-displayName",k.label);g.hide();if(!n){h.append(g)}else{if(f&&f.length!==0){f.after(g)}else{if(i&&i.length!==0){i.replaceWith(g)}else{h.append(g)}}}if(j){throw j}var o=n.noAnimate?null:{easing:"swing",duration:200};g.show(o);this.applyWidget({control:k,$element:g});this.formModel.push(k)};b.prototype.applyWidget=function(g){var e=g.$element,f=g.control;if(typeof f.applyWidget=="function"){f.applyWidget(e)}else{if(!f.noInitUI){e.bsInitUI()}}};b.prototype._appendControlItem=function(f,h){var i=h.position,j=h.tabId;i=parseInt(i);var e=this._getTab(j),g=e.find(this.options.controlItemSelector);if(isNaN(i)||g.length==0||g.length+1===i){e.append(f)}else{g.each(function(l,k){if(l+1===i){a(k).before(f)}})}};b.prototype._createNewControl=function(q,j,l){q=parseInt(q);var n=this._getControlTypeName(q),g={type:q,name:"New."+n,label:"New "+j,glyphicon:this.renderer._getGlyphiconName(l)},m={};var f=[];var i=[];var e={textValueName:"New."+n+".TextValue",textValueId:this.renderer._generateIdFromName("New."+n+".TextValue"),dateValueName:"New."+n+".DateValue",dateValueId:this.renderer._generateIdFromName("New."+n+".DateValue")};var h={textValueName:"New."+n+".TextValue",textValueId:this.renderer._generateIdFromName("New."+n+".TextValue"),dateValueName:"New."+n+".ItemValue",dateValueId:this.renderer._generateIdFromName("New."+n+".ItemValue")};switch(q){case d.controlTypes.title:m={text:"Title",glyphicon:"glyphicon-header"};break;case d.controlTypes.singleSelect:m={items:f};break;case d.controlTypes.listBox:m={items:f};break;case d.controlTypes.tagList:m={items:f};break;case d.controlTypes.radioButtonList:m={items:i};break;case d.controlTypes.datePicker:m=e;break;case d.controlTypes.datePickerRange:var k="New."+n+".From.TextValue",p="New."+n+".To.TextValue";var o={fromName:k,fromId:this.renderer._generateIdFromName(k),toName:p,toId:this.renderer._generateIdFromName(p)};a.extend(true,m,e,o);break;case d.controlTypes.checkBox:m={items:i};break;case d.controlTypes.checkBoxList:m={items:i};break;case d.controlTypes.numberPicker:m=h;break;case d.controlTypes.numberPickerRange:m=a.extend(true,h,{textValueName:"New."+n+".TextValue",textValueId:this.renderer._generateIdFromName("New."+n+".TextValue"),fromName:"New."+n+".From.ItemValue",fromId:this.renderer._generateIdFromName("New."+n+".From.ItemValue"),toName:"New."+n+".To.ItemValue",toId:this.renderer._generateIdFromName("New."+n+".To.ItemValue"),fromValue:1,fromTextValue:"1",fromDisplay:"From",toValue:10,toTextValue:"10",toDisplay:"To"});break;default:break}return a.extend(true,g,m)};b.prototype._updateTabsPositions=function(){var e=this.$controlsTab.find(this.options.controlTabSelector);e.each(function(g,f){a(f).attr("data-position",g+1)})};b.prototype._assignUids=function(g){for(var e in g){var f=g[e];if(typeof f.uid=="undefined"){f.uid=this._generateUid()}}};b.prototype._getDefaultActions=function(){var f=this.$element.attr("data-defaultactions")?this.$element.attr("data-defaultactions"):"{}";var e=JSON.parse(f).actions||[];e=this._getAvailableActions(e);return e};b.prototype._getCustomActions=function(){var f=this.$element.attr("data-customactions")?this.$element.attr("data-customactions"):"{}";var e=JSON.parse(f).actions||[];e=e.map(a.proxy(this._mapCustomActionModelToCustomAction,this));return e};b.prototype._getAvailableActions=function(g){var f=g.slice();if(f.indexOf(this._controlActions.all)!=-1){f=[];for(var e in this._controlActions){if(this._controlActions.hasOwnProperty(e)&&e!="all"){f.push(e)}}}return f};b.prototype._getAddons=function(j){for(var h in this.availableControls){var g=this._mapControlModelToControlListModel(this.availableControls[h]);if(g.type===j.type){var e=this._getAvailableActions(g.actions),f=e.map(a.proxy(this._mapControlActionToControlAddon,this));f=f.concat(g.customActions);return f}}return null};b.prototype._handleAction=function(e,g,f){if(this._controlActions[e]){this._handleDefaultAction(e,g,f)}else{this._handleCustomAction(e,g,f)}};b.prototype._handleDefaultAction=function(e,g,f){switch(e){case this._controlActions.grab:break;case this._controlActions.up:this._moveFormElement(d.directions.up,g);break;case this._controlActions.down:this._moveFormElement(d.directions.down,g);break;case this._controlActions.settings:this._toggleSettings(g,f.hide,true);break;case this._controlActions.remove:this._removeFormElement(g);break;default:break}};b.prototype._moveFormElement=function(k,i){var e=this._getFormControl(i.uid);var f=this.$form.find(this.options.formControlSelector);var m,l,j;f.each(a.proxy(function(p,o){var n=a(o);if(n.attr("data-uid")==i.uid){j=p}},this));j=j+1;m=j-1;l=j+1;var h=this.$form.find(this.options.formControlSelector+":nth-child("+m+")"),g=this.$form.find(this.options.formControlSelector+":nth-child("+l+")");if(k===d.directions.up){this._swapElements(e,h,k)}else{this._swapElements(e,g,k)}};b.prototype._toggleSettings=function(j,k,i){if(j.uid==null){return}var e=this._getFormControl(j.uid),h=this._getFormControlAddon(j.uid,this._controlActions.settings);if(h.hasClass("selected")&&i){return}if(k){e.removeClass("selected");h.removeClass("selected")}if(this._openedSettingsUid===j.uid){return}this._toggleSettings({uid:this._openedSettingsUid},true);this._openedSettingsUid=j.uid;e.addClass("selected");h.addClass("selected");var l=true;var f=this._settingsTabs[""+j.uid];if(!f){l=false;f=this._getFormSettingsTab(j.type).clone();f.hide();f.attr("data-uid",j.uid);this.$settingsContainer.append(f);this._settingsTabs[""+j.uid]=f}var g=this.$settingsContainer.find('[data-properties-for][data-uid]:not([data-uid="'+j.uid+'"])').hide();if(k){f.slideUp("fast")}else{f.slideDown("fast");if(!l){f.find("form").each(a.proxy(this._initPropertiesForm,this,j))}}};b.prototype._initPropertiesForm=function(g,j,h){var e=a(h);var f="settings|"+g.uid;var i={validate:true,parse:true,actions:[{selector:".btn-theme",handler:a.proxy(this._handlePropertiesSave,this,e,g),parse:true,validate:true},{selector:".btn-warning",handler:function(m,l){$formSettings.find("form").bsForm("reset")},parse:true,validate:true}]};var k=f+"|"+j;e.bsForm(a.extend(true,i,{uniqueName:k}))};b.prototype._handlePropertiesSave=function(e,f,j){var g=f.type,l=f.uid;var k=e.attr("data-property-name");var h={controlModel:f,propertyName:k,$form:e,parsedForm:j};switch(g){case d.controlTypes.textBox:this._handleTextBoxPropertiesSave(l,h);break;case d.controlTypes.textArea:this._handleTextAreaPropertiesSave(l,h);break;case d.controlTypes.singleSelect:this._handleSingleSelectPropertiesSave(l,h);break;case d.controlTypes.tagList:this._handleTagListPropertiesSave(l,h);break;case d.controlTypes.listBox:this._handleListBoxPropertiesSave(l,h);break;case d.controlTypes.radioButtonList:this._handleRadioButtonListPropertiesSave(l,h);break}var i=this._getFormModel(f.uid);if(i==null){i={uid:f.uid,type:f.type,name:f.name}}i[k]=a.extend(true,{},j);this._updateFormModel(i)};b.prototype._handleDefaultPropertiesChange=function(e,f,j){var h=f.find("label"),g=f.find(".input-group-addon:first");e.attr("name",j.Name);e.attr("name",j.Name);h.text(j.Label);if(j["Required.SelectedValues"]===""+d.yesNoValues.yes){h.addClass("required")}var i=j["GlyphiconAddon.SelectedValues"];if(i){g.attr("class","input-group-addon glyphicon "+i)}else{g.attr("class","input-group-addon glyphicon")}};b.prototype._handleTextBoxPropertiesSave=function(k,h){var e=this._getFormControl(k);var g=e.find(this.options.inputGroupSelector);var i=h.parsedForm,j=h.propertyName;var f=g.find("input");if(j===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(f,e,i)}else{f.attr("placeholder",i.Placeholder);f.attr("value",i.InitialValue);f.attr("type",d.inputTypes[""+i["Type.SelectedValues"]])}};b.prototype._handleTextAreaPropertiesSave=function(k,h){var e=this._getFormControl(k);var f=e.find(this.options.inputGroupSelector);var i=h.parsedForm,j=h.propertyName;var g=f.find("textarea");if(j===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(g,e,i)}else{}};b.prototype._handleSingleSelectPropertiesSave=function(m,h){var e=this._getFormControl(m);var f=e.find(this.options.inputGroupSelector);var k=h.parsedForm,l=h.propertyName;var g=f.find("select");if(l===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(g,e,k)}else{var i=this._getSelectItemsFromSavedProperties(k,"Items.SelectedValues");var j=this._getOptionsFromSelectItems(i);g.html(j);g.select2("val","")}};b.prototype._handleTagListPropertiesSave=function(m,h){var e=this._getFormControl(m);var f=e.find(this.options.inputGroupSelector);var k=h.parsedForm,l=h.propertyName;var g=f.find(".bs-tag-list");if(l===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(g,e,k)}else{return;var i=this._getSelectItemsFromSavedProperties(k,"Items.SelectedValues");var j=this._getOptionsFromSelectItems(i);var h=i.map(function(n){return{id:n,text:n}});g.filter("select").html(j);g.select2("val","")}};b.prototype._handleListBoxPropertiesSave=function(m,h){var e=this._getFormControl(m);var f=e.find(this.options.inputGroupSelector);var k=h.parsedForm,l=h.propertyName;var g=f.find("select");if(l===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(g,e,k)}else{var i=this._getSelectItemsFromSavedProperties(k,"Items.SelectedValues");var j=this._getOptionsFromSelectItems(i);g.html(j);g.select2("val","")}};b.prototype._handleRadioButtonListPropertiesSave=function(p,k){var f=this._getFormControl(p);var g=f.find(this.options.inputGroupSelector);var n=k.parsedForm,o=k.propertyName;var e=g.find(".btn-group-justified");if(o===d.propertyNames.defaultProperties){this._handleDefaultPropertiesChange(e,f,n)}else{var m=this._getSelectItemsFromSavedProperties(n,"Items.SelectedValues");var j="";for(var l in m){var h='<a class="option" value="'+m[l]+'">'+m[l]+"</a>";j+=h}e.html(j)}};b.prototype._removeFormElement=function(f){var j=f.uid;var g=null;for(var h in this.formModel){if(this.formModel[h].uid===j){g=h;break}}if(g!==null){this.formModel.splice(g,1)}var e=this._getFormControl(j);this._openedSettingsUid=null;this._toggleSettings({uid:j},true);e.hide({duration:200,easing:"swing",done:function(){e.remove()}})};b.prototype._handleCustomAction=function(f,g){var e;if(this.options.customActions instanceof Array){for(var j in this.options.customActions){var h=this.options.customActions[j];if(h.name===f){e=h.handler}}}if(typeof e=="function"){e(g)}else{throw'Handler not defined for custom action "'+f+'"'}};b.prototype.serialize=function(){var e=this.formModel.map(function(f){return a.extend(true,f,{Type:f.type,Name:f.DefaultProperties?f.DefaultProperties.Name:null})});return e};b.prototype._mapControlModelToControlListModel=function(e){var f={type:e.Type,name:e.Text,glyphicon:e.Glyphicon,order:e.Order,tabId:e.TabId,controlName:e.ControlName,actions:e.Actions,customActions:e.CustomActions?e.CustomActions.map(a.proxy(this._mapCustomActionModelToCustomAction,this)):[]};return f};b.prototype._mapCustomActionModelToCustomAction=function(e){return{name:e.Name,glyphicon:e.Glyphicon,title:e.Title}};b.prototype._mapControlActionToControlAddon=function(f){var e=this._addons[f];return{name:e.name,glyphicon:e.glyphicon,title:e.title,}};b.prototype._generateUid=function(){this._uid=this._uid?this._uid+1:1;return this._uid};b.prototype._getControlTypeName=function(e){for(var f in d.controlTypes){if(d.controlTypes.hasOwnProperty(f)&&d.controlTypes[f]===e){return f}}return null};b.prototype._getLocalizedString=function(e){if(typeof e!="string"){return null}if(typeof this.resource=="object"&&this.resource!=null){return this.resource[e]}if(typeof this.resource=="function"){return this.resource(e)}return e};b.prototype._getTab=function(f){var e=this.$element.find(this.options.controlItemsListSelector+'[data-tabid="'+f+'"]');return e};b.prototype._slideTab=function(e,f){e.show("slide",{direction:f},250)};b.prototype._toggleElements=function(j,i){var e=this.$element.find(this.options.controlItemsListSelector),g=this.$form,h=this.$element.find(this.options.settingsContainerSelector);var f=e.add(g).add(h);if(j){if(i){f.slideDown("fast")}else{f.show()}}else{if(i){f.slideUp("fast")}else{f.hide()}}};b.prototype._getHeight=function(e){return parseInt(e.css("height").replace("px",""))};b.prototype._getFormControlModel=function(e){var f={uid:parseInt(e.attr("data-uid")),displayName:e.attr("data-displayname"),type:parseInt(e.attr("data-controltype"))};return f};b.prototype._getFormControl=function(e){return this.$form.find(this.options.formControlSelector+'[data-uid="'+e+'"]')};b.prototype._getFormControlAddon=function(f,e){return this._getFormControl(f).find('[data-addon-toggle="'+e+'"]')};b.prototype._getFormSettingsTab=function(e,f){return this.$element.find('[data-properties-for="'+e+'"]:first')};b.prototype._swapElements=function(e,f,h){e.hide();f.hide();var g={easing:null,duration:200};g=null;e.show(g);if(h===d.directions.up){f.before(e);f.show(g)}else{f.after(e);f.show(g)}};b.prototype._getFormModel=function(f){for(var e in this.formModel){if(this.formModel[e].uid===f){return this.formModel[e]}}return null};b.prototype._updateFormModel=function(g){var f=0;for(var e in this.formModel){if(this.formModel[e].uid===g.uid){f=e;break}}this.formModel.splice(f,1);this.formModel.push(g)};b.prototype._getSelectItemsFromSavedProperties=function(g,h){var e=[];for(var f in g){if(g.hasOwnProperty(f)&&f.indexOf(h)==0){e.push(g[f])}}return e};b.prototype._getOptionsFromSelectItems=function(g){var e="";for(var f in g){var h='<option value="'+g[f]+'">'+g[f]+"</option>";e+=h}return e};a.widget("bforms.bsFormBuilder",b.prototype);return b};if(typeof define=="function"&&define.amd){define("bforms-formBuilder",["jquery","bforms-formBuilder-formRenderer","bforms-formBuilder-models","jquery-ui-core","amplify","select2","bforms-form"],factory)}else{factory(window.jQuery)};var factory=function(a){var g={formGroup:'<div class="form-group {{cssClass}} col-lg-{{colLg}} col-md-{{colMd}} col-sm-{{colSm}} col-xs-{{colXs}} {{validationCss}}">{{{label}}}<div class="input-group">{{{addon}}}{{{control}}}{{{validation}}}{{#controlAddons}}<span class="input-group-addon glyphicon {{glyphicon}}" data-addon-toggle="{{name}}" title="{{title}}"></span>{{/controlAddons}}</div></div>',formControlWrapper:'<div class="form_builder-formControlWrapper col-lg-{{colLg}} col-md-{{colMd}} col-sm-{{colSm}} col-xs-{{colXs}} border"><div class="row"><div class="col-lg-11 col-md-11 col-sm-11 col-xs-8">{{{control}}}</div><div class="col-lg-1 col-md-1 col-sm-1 col-xs-4 form-group"><label class="control-label"></label><div class="input-group"><button class="btn btn-default pull-left"></button></div></div></div></div>',controlListItem:'<li class="form_builder-controlItem list-group-item" data-controltype="{{type}}" data-position="{{order}}" data-name="{{name}}" data-glyphicon="{{glyphicon}}" data-controlname="{{controlName}}" data-tabid="{{tabId}}"><span class="form_builder-controlItem-glyphicon {{glyphicon}} glyphicon"></span><a class="badge form_builder-controlItem-add"><span class="glyphicon glyphicon-plus"></span></a> {{name}}</li>',propertiesTab:'<div class="row"><div class="col-lg-12 col-md-12 col-sm-12"><div class="row">{{#tabs}}<div class="col-lg-12 col-md-12 col-sm-12"><h3 class="bs-editable"><span class="glyphicon glyphicon-{{glyphicon}}"></span><a href="#">{{name}}</a><span class="glyphicon glyphicon-pencil pull-right"></span></h3></div><div class="col-lg-12 col-md-12 col-sm-12">{{{controls}}}</div>{{/tabs}}</div></div></div>',controlProperties:'{{#tabs}}<div class="col-lg-12 col-md-12 col-sm-12"><h3 class="bs-editable"><span class="glyphicon glyphicon-{{glyphicon}}"></span>{{name}}</h3></div>{{/tabs}}'};var f={validation:'<span class="input-group-addon glyphicon glyphicon-warning-sign {{#invalid}}field-validation-invalid{{/invalid}}{{^invalid}}field-validation-valid{{/invalid}}" data-toggle="tooltip" data-valmsg-for="{{controlName}}" data-valmsg-replace="{{replace}}"></span>',validationCss:"{{#invalid}}has-error{{/invalid}}{{^invalid}}{{/invalid}}"};var d={glyphiconAddon:'<span class="glyphicon glyphicon-{{glyphicon}} input-group-addon"></span>'};var c={label:'<label class="control-label {{#required}}required{{/required}}{{^required}}{{/required}}" for="{{controlId}}">{{text}}</label>',input:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control {{cssClass}}" type="{{type}}" id="{{id}}" name="{{name}}" value="{{value}}" placeholder="{{placeholder}}" />',dropdown:'<select {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-dropdown" id="{{id}}" name="{{name}}" tabindex="-1">{{#items}}<option value="{{value}}">{{text}}</option>{{/items}}</select>',radioButtonList:'<div class="form-control bs-radio-list radioButtonList-done {{cssClass}}" data-initialvalue="{{initialValue}}" id="{{id}}" style="display:none;">{{#items}}<div><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} data-initialValue="{{initialValue}}" id="{{id}}" name="{{controlName}}" type="radio" value="{{value}}" {{#selected}}checked="checked"{{/selected}}/><label for="{{id}}">{{label}}</label></div>{{/items}}</div>',textArea:'<textarea {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-textarea {{cssClass}} cols="20" rows="2" name="{{name}}" id="{{id}}"></textarea>',tagList:'<select {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} id="{{id}}" name="{{name}}" multiple="multiple" class="form-control bs-tag-list bs-hasBformsSelect" style="display:none;">{{#items}}<option value="{{value}}">{{text}}</option>{{/items}}</select>',listBox:'<select {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-listbox select2-offscreen bs-hasBformsSelect" id="{{id}}" name="{{name}}" multiple="multiple" tabindex="-1">{{#items}}<option value="{{value}}">{{text}}</option>{{/items}}</select>',formTitle:'<div class="col-lg-12 col-md-12 col-sm-12"><h4 class="form-title"><span class="glyphicon {{glyphicon}}"></span> {{text}}</h4></div>',datePicker:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-datetime " id="{{textValueId}}" name="{{textValueName}}" type="text" value="{{textValue}}" data-minvalue="{{minValue}}" data-maxvalue="{{maxValue}}"><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-date-iso" data-for="{{textValueName}}" id="{{dateValueId}}" name="{{dateValueName}}" type="hidden" value="{{dateValue}}">',datePickerRange:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-datetime-range" data-maxvalue="{{maxValue}}" data-minvalue="{{minValue}}" id="{{textValueId}}" name="{{textValueName}}" placeholder="{{placeHolder}}" type="text" value="{{value}}"><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-range-from" data-allowdeselect="{{fromAllowDeselect}}" data-for="{{textValueName}}" id="{{fromId}}" name="{{fromName}}" type="hidden" value="{{fromValue}}" data-minvalue="{{fromMinValue}}" data-maxvalue="{{fromMaxValue}}"><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-range-to" data-allowdeselect="{{toAllowDeselect}}" data-for="{{textValueName}}" id="{{toId}}" name="{{toName}}" type="hidden" value="{{toValue}}" data-minvalue="{{toMinValue}}" data-maxvalue="{{toMaxValue}}">',checkBox:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} type="checkbox" {{#checked}}checked="checked"{{/checked}} />',checkBoxList:'<div class="form-control bs-checkbox-list checkBoxList-done" id="{{id}}" style="display:none;">{{#items}}<div><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} data-value="{{value}}" id="{{id}}" name="{{controlName}}" type="checkbox" /><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} name="{{controlName}}" type="hidden" value="{{#selected}}true{{/selected}}{{^selected}}false{{/selected}}"/><label for="{{id}}">{{label}}</label></div>{{/items}}</div><div tabindex="0" id="{{name}}_checkBox" class="checkbox_replace form-control"><div class="btn-group-justified">{{#items}}<a data-value="{{value}}" class="option">{{label}}</a>{{/items}}</div></div>',numberPicker:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-number-inline bs-number-single_range_inline" id="{{textValueId}}" name="{{textValueName}}" type="text" value="{{textValue}}" /><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-number-value" data-for="{{textValueName}}" data-maxvalue="{{maxValue}}" data-minvalue="{{minValue}}" id="{{itemValueId}}" name="{{itemValueName}}" type="hidden" value="{{itemValue}}" />',numberPickerRange:'<input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="form-control bs-number-range" id="{{textValueId}}" name="{{textValueName}}" type="" value="{{fromTextValue}} - {{toTextValue}}"><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-range-from" data-allowdeselect="{{fromAllowDeselect}}" data-display="{{fromDisplay}}" data-for="{{textValueName}}" data-minvalue="{{fromMinValue}}" data-maxvalue="{{fromMaxValue}}" id="{{fromId}}" name="{{fromName}}" type="hidden" value="{{fromValue}}"><input {{#applyValidation}}data-val="{{required}}" data-val-required="{{requiredMessage}}"{{/applyValidation}} class="bs-range-to" data-allowdeselect="{{toAllowDeselect}}" data-display="{{toDisplay}}" data-for="{{textValueName}}" data-minvalue="{{toMinValue}}" data-maxvalue="{{toMaxValue}}" id="{{toId}}" name="{{toName}}" type="hidden" value="{{toValue}}">',pageBreak:'<div class="col-lg-12 col-md-12 col-sm-12"><hr/></div>'};var b={tabControl:'<div class="btn-group btn-group-justified form_builder-tabControl">{{#tabs}}<a role="button" class="btn btn-theme form_builder-tabBtn" data-tabId="{{id}}">{{text}}</a>{{/tabs}}</div>'};var e=a.extend(true,{},g,f,c,d,b);return e};if(typeof define=="function"&&define.amd){define("bforms-formBuilder-templates",["jquery","bforms-datepicker"],factory)}else{factory(window.jQuery)};var factory=function(a,d,c){var b=function(e){a.extend(true,this.options,e);this._init()};b.prototype.options={idDotReplacement:"_",applyValidation:undefined};b.prototype._init=function(){this.customRenderers={};this._initTemplates()};b.prototype._initTemplates=function(){for(var e in d){if(d.hasOwnProperty(e)){if(typeof ich[e]!="function"){ich.addTemplate(e,d[e])}}}};b.prototype.renderControlProperties=function(f){var h={},e=[];for(var g in c.propertiesModels){var j=c.propertiesModels[g];if(j.type===f){h=j;break}}for(var g in h.settings){e.push(this.renderFormControlWrapper(h.settings[g]))}var k=a.extend(true,{},h,{controls:e});return ich.propertiesTab(h)};b.prototype.renderControlListItem=function(e){return ich.controlListItem(e)};b.prototype.renderFormControlWrapper=function(e){var f=this._getSizeModel(e);var g={colLg:f.lg,colMd:f.md,colSm:f.sm,colXs:f.xs,control:e.control};return ich.formControlWrapper(g,true)};b.prototype.renderFormGroup=function(g){var h={};if(typeof g.size=="object"||!g.size){h=a.extend(true,{},g.size||{},{lg:12,md:12,sm:12,xs:12})}else{h={lg:g.size,md:g.size,sm:g.size,xs:g.size}}var f={colLg:h.lg,colMd:h.md,colSm:h.sm,colXs:h.xs,label:g.label,addon:g.addon,control:g.control,validation:g.validation,cssClass:g.cssClass,controlAddons:g.controlAddons};var e=ich.formGroup(f,true);return e};b.prototype.renderControlGroup=function(r,h){var q=r.label,s=r.name,n=this._generateIdFromName(s),u=r.type,l=r.glyphicon,i=r.description;var t=r.required||false;var p={text:q,controlId:n,required:t},m={glyphicon:l},w={replace:"true",controlName:s},g=r.addons||this.options.defaultAddons;g=this._removeDuplicateAddons(g);var o=ich.label(p,true),e=l?ich.glyphiconAddon(m,true):"",f=h,v=ich.validation(w,true);var k={cssClass:"form_builder-formControl",label:o,addon:e,control:f,validation:v,size:r.size,controlAddons:g};var j=this.renderFormGroup(k);return j};b.prototype.renderInput=function(h){var i=h.name,e=this._generateIdFromName(i),l=h.type,j=h.placeholder,k=h.required||false;var g={name:i,id:e,type:l,placeholder:j,required:k,applyValidation:this.options.applyValidation};var f=ich.input(g,true);return this.renderControlGroup(h,f)};b.prototype.renderTextBox=function(e){var f=a.extend(true,{},e,{type:"text",applyValidation:this.options.applyValidation});return this.renderInput(f)};b.prototype.renderDropdown=function(f){f.name=f.name+".SelectedValues";f=a.extend(true,{},f,{id:this._generateIdFromName(f.name),applyValidation:this.options.applyValidation});var e=ich.dropdown(f,true);return this.renderControlGroup(f,e)};b.prototype.renderRadioButtonList=function(g){g.name=g.name+".SelectedValues";var e=this._generateIdFromName(g.name);var f=g.items?g.items.map(function(k,j){return{value:k.value,label:k.label,controlName:g.name,id:e+"_"+j,selected:g.selectedValue===k.value}}):[];var i=a.extend(true,{},g,{items:f,applyValidation:this.options.applyValidation});var h=ich.radioButtonList(i,true);return this.renderControlGroup(i,h)};b.prototype.renderTextArea=function(e){e=a.extend(true,{},e,{id:this._generateIdFromName(e.name),applyValidation:this.options.applyValidation});var f=ich.textArea(e,true);return this.renderControlGroup(e,f)};b.prototype.renderTagList=function(e){e.name=e.name+".SelectedValues";e=a.extend(true,{},e,{id:this._generateIdFromName(e.name),applyValidation:this.options.applyValidation});var f=ich.tagList(e,true);return this.renderControlGroup(e,f)};b.prototype.renderListBox=function(f){f.name=f.name+".SelectedValues";f.applyValidation=this.options.applyValidation;var e=ich.listBox(f,true);return this.renderControlGroup(f,e)};b.prototype.renderTitle=function(e){var f=ich.formTitle(e,true);e.glyphicon=null;return this.renderControlGroup(e,f)};b.prototype.renderDatePicker=function(f){f=a.extend(true,{},f,{id:this._generateIdFromName(f.name),applyValidation:this.options.applyValidation});var e=ich.datePicker(f,true);return this.renderControlGroup(f,e)};b.prototype.renderDatePickerRange=function(f){f=a.extend(true,{},f,{id:this._generateIdFromName(f.name),applyValidation:this.options.applyValidation});var e=ich.datePickerRange(f,true);return this.renderControlGroup(f,e)};b.prototype.renderCheckBox=function(f){f=a.extend(true,{},f,{id:this._generateIdFromName(f.name),applyValidation:this.options.applyValidation});var e=ich.checkBox(f,true);return this.renderControlGroup(f,e)};b.prototype.renderCheckBoxList=function(i){i.name=i.name+".SelectedValues";var g=this._generateIdFromName(i.name);i=a.extend(true,{},i,{id:g});var h=i.items?i.items.map(function(k,j){return{value:k.value,label:k.label,controlName:i.name,id:g+"_"+j,selected:i.selectedValue===k.value}}):[];var f=a.extend(true,{},i,{items:h,applyValidation:this.options.applyValidation});var e=ich.checkBoxList(f,true);return this.renderControlGroup(i,e)};b.prototype.renderNumberPicker=function(f){var e=this._generateIdFromName(f.name);f=a.extend(true,{},f,{id:e,applyValidation:this.options.applyValidation});var h=a.extend(true,f,{});var g=ich.numberPicker(h,true);return this.renderControlGroup(f,g)};b.prototype.renderNumberPickerRange=function(f){var e=this._generateIdFromName(f.name);f=a.extend(true,{},f,{id:e,applyValidation:this.options.applyValidation});var h=a.extend(true,f,{});var g=ich.numberPickerRange(h,true);return this.renderControlGroup(f,g)};b.prototype.renderPageBreak=function(e){e.glyphicon=null;var f=ich.pageBreak(e,true);return this.renderControlGroup(e,f)};b.prototype.renderCustomControl=function(e,g){var f=this.customRenderers[e];if(typeof f!="function"){throw"No method for rendering "+e+" custom control was found"}a.extend(true,g,{applyValidation:this.options.applyValidation});return f(g)};b.prototype.renderTabControl=function(e){return ich.tabControl(e,true)};b.prototype._generateIdFromName=function(g){if(typeof g!="string"){return null}var e=this.options.idDotReplacement||"_",f=g.replace(/\./g,e);return f};b.prototype._getSizeModel=function(f){var e={};if(typeof f=="object"||!f){e=a.extend(true,{},f||{},{lg:12,md:12,sm:12,xs:12})}else{e={lg:f,md:f,sm:f,xs:f}}return e};b.prototype._getGlyphiconName=function(e){if(typeof e!="string"){return""}return e.replace("glyphicon-","")};b.prototype._removeDuplicateAddons=function(g){var f=[],h={};for(var j in g){var e=g[j];if(!h[e.name]){f.push(e);h[e.name]=true}}return f};return b};if(typeof define=="function"&&define.amd){define("bforms-formBuilder-formRenderer",["jquery","bforms-formBuilder-templates","bforms-formBuilder-models","icanhaz","bforms-form"],factory)}else{factory(window.jQuery)};var factory=function(){var a={textBox:1,textArea:2,numberPicker:3,numberPickerRange:4,decimalNumberPicker:5,datePicker:6,datePickerRange:7,timePicker:8,singleSelect:9,tagList:10,listBox:11,radioButtonList:12,checkBoxList:13,checkBox:14,pagebreak:15,title:16,customControl:17,file:18};var e=[{type:a.textBox,tabs:[{name:"Settings",glyphicon:"wrench",settings:[{type:a.textBox,name:"Label",label:"Label",constraints:{required:true}}]}]}];var b={up:"up",down:"down",left:"left",right:"right"};var f={defaultProperties:"DefaultProperties",specificProperties:"Properties"};var g={yes:1,no:2};var c={"1":"text","2":"email","3":"url","4":"password","5":"search"};var d={controlTypes:a,directions:b,propertyNames:f,yesNoValues:g,inputTypes:c};return d};if(typeof define=="function"&&define.amd){define("bforms-formBuilder-models",[],factory)}else{factory()};var factory=function(a){var b=function(c){};b.prototype.options={instantQuickSearch:true,panelActionSelector:".control-panel-action",panelHeadingSelector:".panel-heading",panelBodySelector:".panel-body",tabButtonSelector:".control-panel-nav-tab",tabSelector:".control-panel-tab",quickSearchSelector:".tab-search",titleSelector:".control-panel-title",gridSelector:".grid_view"};b.prototype.predefinedActions={remove:"remove",toggle:"toggle"};b.prototype.tabContentTypes={defaultContent:"default",form:"form",grid:"grid"};b.prototype._init=function(){this._initMembers();this._cacheElements();this._addHandlers()};b.prototype._initMembers=function(){this._initializedTabs={}};b.prototype._cacheElements=function(){this.$element=this.element;this.$head=this.$element.find(this.options.panelHeadingSelector);this.$body=this.$element.find(this.options.panelBodySelector);this.$sideMenu=this.$element.find(this.options.sideMenuSelector);this.$quickSearch=this.$element.find(this.options.quickSearchSelector)};b.prototype._addHandlers=function(){this.$element.on("click",this.options.panelActionSelector,a.proxy(this.evActionClick,this));this.$element.on("click",this.options.tabButtonSelector,a.proxy(this.evTabButtonSelectorClick,this));if(!this.$element.attr("id")||this.options.preventAnchoring){this.$element.find(this.options.titleSelector).on("click","a:not(.control-panel-action)",function(c){c.preventDefault()})}this._initQuickSearch()};b.prototype._initQuickSearch=function(){this.$quickSearch.on("keyup",a.proxy(this._evQuickSearchKeyUp,this));this.$element.find(this.options.gridSelector).on("bsgridbeforereset",a.proxy(this._evGridReset,this))};b.prototype._evGridReset=function(d,c){if(this.$quickSearch.is(":visible")){this.$quickSearch.val("")}};b.prototype.evTabButtonSelectorClick=function(h){h.preventDefault();var c=a(h.target),l=c.attr("data-tabid");var g=this._getTab(l),d=this._getCurrentTab();var k=c.attr("data-showquicksearch")==="True";var f=c.parents("li:first");if(!f.hasClass("active")){d.hide();g.show();if(!this._initializedTabs[l]){var i={tabId:l,$tab:g,contentType:g.attr("data-content-type")};var j=this._initializeTab(i);if(j&&typeof i.done=="function"){j.done(a.proxy(function(m,e){this._trigger("afterTabInitialization",h,i)},this))}else{this._trigger("afterTabInitialization",h,i)}this._initializedTabs[l]=true}if(k){this.$quickSearch.show()}else{this.$quickSearch.hide()}this.$element.find(".active").removeClass("active");f.addClass("active")}};b.prototype.evActionClick=function(f){f.preventDefault();var c=a(f.target).is("a")?a(f.target):a(f.target).parents("a:first");var d=c.attr("data-action");if(this.predefinedActions[d]){this._executePredefinedAction(d)}};b.prototype._evQuickSearchKeyUp=function(f){var c=this._getCurrentTab();var d=c.find(this.options.gridSelector);if(d.length==0){return}var g=this.options.instantQuickSearch,h=this.options.quickSearchTimeout;var i=this.$quickSearch.val();if(g){if(this.quickSearchTimeout){window.clearTimeout(this.quickSearchTimeout)}this.quickSearchTimeout=window.setTimeout(a.proxy(function(){d.bsGrid("search",i,true)},this),h)}else{if(f.which==13||f.keyCode==13){d.bsGrid("search",i,true)}}};b.prototype._initializeTab=function(f){var c=f.$tab,d=f.contentType;var e;var g=this.options.tabOptions?(this.options.tabOptions[f.tabId]||{}):{};switch(d){case this.tabContentTypes.defaultContent:break;case this.tabContentTypes.form:e=c.find("form").bsForm(g);break;case this.tabContentTypes.grid:e=c.find(this.options.gridSelector).bsGrid(g);break;default:break}return e};b.prototype._executePredefinedAction=function(c){switch(c){case this.predefinedActions.remove:this.remove();break;case this.predefinedActions.toggle:this.toggle();break;default:break}};b.prototype._toggleElement=function(c,e,d){d=typeof d!="undefined"?d:true;if(typeof e=="undefined"){e=c.is(":hidden")}if(e){if(d){c.stop().slideDown(300)}else{c.show()}}else{if(d){c.stop().slideUp(300)}else{c.hide()}}};b.prototype._getTab=function(c){return this.$element.find(this.options.tabSelector+'[data-tabid="'+c+'"]')};b.prototype._getCurrentTab=function(){return this.$element.find(this.options.tabSelector+":visible")};b.prototype.toggle=function(d){if(typeof d=="undefined"){d=this.$body.is(":hidden")}var c=this.$head.find('[data-action="toggle"] .glyphicon');c.removeClass("glyphicon-chevron-up");c.removeClass("glyphicon-chevron-down");if(d){c.addClass("glyphicon-chevron-up")}else{c.addClass("glyphicon-chevron-down")}this._toggleElement(this.$body,d,true)};b.prototype.remove=function(){this.$element.hide()};a.widget("bforms.bsControlPanel",b.prototype);return b};if(typeof define=="function"&&define.amd){define("bforms-controlPanel",["jquery","jquery-ui-core"],factory)}else{factory(window.jQuery)};var factory=function(a,b,d){var c=function(e){this.options=a.extend(true,this.options,e)};c.prototype.options={alternate:true,sortable:false,allowDuplicates:true};c.prototype._init=function(){this.$element=this.element;this.$select=this.$element.parents(".input-group").find("select");this.select2Options=this.$element.data("select2").opts;this.currentTagsIndex=""+0;this._select2PopulateResults=a.proxy(this.select2Options.populateResults,this.$element.data("select2"));this.initialTags=a.extend(true,this.options.tags);this.options.tags=this._evaluateInitialTags(this.options.tags);this.values=[];this._setTags(this.options.tags[0]);this.stateBeforeRemoval=[];this.currentTags=this.options.tags[0];this._uid=0;if(this.options.selectedValues){this._testSelectedValues(this.options.selectedValues);this._initInitialValues(this.options.selectedValues)}if(this.options.initialTags){this._setInitialTags(this.options.initialTags)}if(this.options.sortable){this._initSortable()}this._addDelegates()};c.prototype._addDelegates=function(){this.$element.on("change",a.proxy(this._evSelect2Change,this))};c.prototype._initSortable=function(f){var e=this.$element.parents(".input-group").find(".select2-choices");if(f&&e.data("ui-sortable")){e.sortable("destroy")}e.find(".select2-search-choice").css("cursor","pointer");e.css("overflow","auto");e.sortable({containment:"parent",start:a.proxy(this._evSelect2SortStart,this),update:a.proxy(this._evSelect2SortEnd,this)})};c.prototype._setInitialTags=function(j){var k=[];var g=j.map(function(i){return i.id||null});var n=j.map(function(i){return i.text||i});for(var h in j){var f=g[h],m=n[h],l=this.options.tags[this._getIndexFromTags([{id:f,text:m}])];if(f==null){for(var e in l){if(l[e].text===m){f=l[e].id;break}}}k.push({id:f,text:m,tags:l,_uid:++this._uid})}this.currentTagsIndex=this._getIndexFromTags(k);this._setTags(k);this._fixSelect2Choices()};c.prototype._initInitialValues=function(f){this._setSelectedValues(this.options.selectedValues);var e=typeof this.options.getNextTags=="function"?this.options.getNextTags(this.val(),0,this.options.tags[0],this.options.tags):this.options.tags[this.currentTagsIndex];this.currentTagsIndex=this._getIndexFromTags(e);this.currentTags=this.options.tags[this.currentTagsIndex]};c.prototype._evSelect2Change=function(j){if(typeof j.added=="undefined"&&typeof j.removed=="undefined"){return}var h=this.options.tags[this.currentTagsIndex],n=this.currentTagsIndex,m=[];if(j.added){var g=j.added;this.added={id:g.id||g,text:g.text||g,tags:h,_uid:this._uid}}if(j.removed){var p=j.removed;this.removed={id:p.id||p,text:p.text||text,tags:h,_uid:this._uid}}if(this.options.alternate){var q=this._getNextTags();q=this._alterTags(q);this._setTags(q);m=q}if(j.added){var g=j.added;this.values.push({id:g.id||g,text:g.text||g,tags:h,_uid:this._uid});if(this._isNewTag(j.added,h)){this.options.tags[this.currentTagsIndex].push(j.added)}var f=this.$element.parents(".input-group").find(".select2-choices > .select2-search-choice:last");f.data("_uid",this._uid)}if(j.removed){j.preventDefault();var p=a.extend(true,{},j.removed);var o=this.$element.select2("val").map(a.proxy(function(e){return this._fixId(e.id||e)},this)),l=this.values.map(function(e){return e.id||e});for(var k in l){if(o[k]!==""+l[k]){this.values.splice(k,1);break}}this.removed=j.removed}this._uid=this._uid+1;this._fixSelect2Choices();if(this.options.sortable&&(j.added||j.removed)){this._initSortable()}};c.prototype._evSelect2SortStart=function(f){this.$element.select2("onSortStart")};c.prototype._evSelect2SortEnd=function(f){this.$element.select2("onSortEnd");var h=this._setValuesFromSelect2(this.$element.select2("val"));if(this.options.alternate&&typeof this.options.getNextTags=="function"){var g=this.options.getNextTags(h,parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags);this.currentTagsIndex=this._getIndexFromTags(g);g=this._alterTags(g);this.currentTags=g;this._setTags(g);this._initSortable(true);this._fixSelect2Choices()}};c.prototype._getNextTags=function(h){var f=h||(this.currentTagsIndex+1)%this.options.tags.length,j=[];if(typeof this.options.getNextTags=="function"){var k=this.val();if(this.added){k.push({id:this.added.id||this.added,text:this.added.text||this.added});this.added=undefined}if(this.removed){var g;for(var e in k){if(k[e].id==this.removed.id){g=e;break}}if(g){k.splice(g,1)}this.removed=undefined}j=this.options.getNextTags(k,parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags);f=this._getIndexFromTags(j);this.currentTagsIndex=f;this.currentTags=j.slice();return j}this.currentTagsIndex=f;j=this.options.tags[this.currentTagsIndex];this.currentTags=j.slice();return j};c.prototype._getIndexFromTags=function(k){var e=this.options.tags;for(var h in e){var f=e[h].map(function(i){return i.text||i});var l=k.map(function(i){return i.text||i});var j=true;for(var g in l){if(f.indexOf(l[g])==-1){j=false;break}}if(j){return h}}return null};c.prototype._setTags=function(h){h=a.isArray(h)?h:[];var f={tags:h,populateResults:a.proxy(this._populateResults,this),matcher:function(m,i,l){return i.toUpperCase().indexOf(m.toUpperCase())!=-1}};this.$select.empty();for(var e in h){var g=h[e],j=g.text||g,k=g.id||g;this.$select.append('<option value="'+k+'">'+j+"</option>")}this.select2Options.tags=[];this.$element.select2("destroy");this.$element.select2(a.extend(true,this.select2Options,f))};c.prototype._mergeTags=function(g){var e=this.$element.data("select2").opts.tags;for(var f in g){e.push(g[f])}this._setTags(e)};c.prototype._populateResults=function(e,l,k){var m=this._alterTags(this.currentTags),h=[];var f=typeof this.options.finalize=="function"?this.options.finalize(this.val(),this.currentTagsIndex,this.options.tags[this.currentTagsIndex],this.options.tags):false;if(f){this._select2PopulateResults(e,[],k);return}for(var g in m){var n=m[g].text||m[g];if(k.term==null||k.term===""||n.indexOf(k.term)!=-1){h.push(m[g])}}if(k.term!=null&&k.term!=""){var j=this._createSearchChoice(k.term);if(j){h.push(j)}}if(!this._duplicatesAllowed()){h=this._removeDuplicates(h)}this._select2PopulateResults(e,h,k)};c.prototype._alterIds=function(g){var f=this.$element.select2("val");for(var e in g){if(f.indexOf(""+g[e].id)!=-1){g[e].id="_"+g[e].id}}return g};c.prototype._fixSelect2Choices=function(){var e=this.$element.parents(".input-group").find(".select2-choices > .select2-search-choice");e.each(a.proxy(function(k,h){var f=a(h),g=f.find("div:first");for(var j in this.values){if(j===""+k){g.text(this.values[j].text);break}}},this))};c.prototype._isId=function(h){var e=this.options.tags[this.currentTagsIndex];for(var f in e){var g=e[f].id||e[f];if(""+g===h){return true}}return false};c.prototype._getTagById=function(f){var g=this.options.tags[this.currentTagsIndex];for(var e in g){if(g[e].id===""+f){return g[e]}}return undefined};c.prototype._getTagByIdFromAllTags=function(g){var e=this.options.tags;for(var h in e){var j=e[h];for(var f in j){if(""+j[f].id===""+g){return j[f]}}}return undefined};c.prototype._getTagByText=function(g){var f=this.options.tags[this.currentTagsIndex];for(var e in f){if(f[e].text===g){return f[e]}}return undefined};c.prototype._alterTags=function(g,h){var n="",o=h||this.$element.select2("val"),p=[],e=this._duplicatesAllowed();for(var k in g){var l=g[k].id||g[k],q=g[k].text||g[k];if(typeof g[k].id!="undefined"&&e){var f=0;for(var m in o){var r=o[m].replace(/_+/g,"");if(r===l){f++}}for(var m=0;m<f;m++){n+="_"}}p.push({id:n+l,text:q})}return p};c.prototype._fixId=function(e){var f=e.match(/_+/g);if(f){e=e.slice(e.indexOf(f[0])+f[0].length)}return e};c.prototype._createSearchChoice=function(e){if(typeof this.options.createSearchChoice!="undefined"){if(typeof this.options.createSearchChoice=="boolean"){return this.options.createSearchChoice?{id:e,text:e}:null}if(typeof this.options.createSearchChoice=="function"){return this.options.createSearchChoice(e)}}return true};c.prototype._duplicatesAllowed=function(){var e=false;if(typeof this.options.allowDuplicates!="undefined"){if(typeof this.options.allowDuplicates=="boolean"){e=this.options.allowDuplicates}if(typeof this.options.allowDuplicates=="function"){e=this.options.allowDuplicates(this.val(),parseInt(this.currentTagsIndex),this.options.tags[this.currentTagsIndex],this.options.tags)}}return e};c.prototype._removeDuplicates=function(g){var j=this.values.map(function(i){return i.text||i});var h=g.map(function(i){return i.text||i});var f=[];for(var e in h){if(j.indexOf(h[e])==-1){f.push(g[e])}}return f};c.prototype._isNewTag=function(f,e){var h=f.text||f,g=e.map(function(i){return i.text||i});return g.indexOf(h)==-1};c.prototype._evaluateInitialTags=function(m){var f=[];for(var k in m){var g=m[k],e=[];for(var h in g){var j=g[h].id||g[h],n=g[h].text||g[h];var l={id:j,text:n};e.push(l)}f.push(e)}return f};c.prototype._setSelectedValues=function(k){this.values=[];var h=k.map(function(i){return i.id||null});var n=k.map(function(i){return i.text||i});for(var j in k){var g=h[j],m=n[j],l=this.options.tags[this._getIndexFromTags([{id:g,text:m}])];if(g==null){for(var f in l){if(l[f].text===m){g=l[f].id;break}}}this.values.push({id:g,text:m,tags:l,_uid:++this._uid})}h=this.values.map(function(i){return i.id});var e=this._alterIds(h);this.$element.select2("val",e);this._fixSelect2Choices();return this.values};c.prototype._alterIds=function(j){var e=[],f={};for(var k in j){if(typeof f[""+j[k]]!="undefined"){f[""+j[k]]++}else{f[""+j[k]]=1}var h=j[k];if(f[""+j[k]]!=1){for(var g=1;g<f[""+j[k]];g++){h="_"+h}}e.push(h)}return e};c.prototype._setSelect2Choices=function(j){var h=j.map(function(i){return{id:i.id||i,text:i.text||i}});var e=this.$element.parents(".input-group").find(".select2-choices");e.empty();for(var g in h){var f='<li class="select2-search-choice"><div>'+h[g].text+'</div><a href="#" onclick="return false;" class="select2-search-choice-close" tabindex="-1"></a></li>';e.append(f)}e.parents(".select2-container").removeClass("select2-active")};c.prototype._setValuesFromSelect2=function(l){var g=l.map(a.proxy(this._fixId,this));this.values=[];for(var e in g){var f=g[e],h=this._getTagByIdFromAllTags(f),k=h.text||h,j=this.options.tags[this._getIndexFromTags([{id:f,text:k}])];this.values.push({id:f,text:k,tags:j})}return this.values};c.prototype._testSelectedValues=function(f){for(var e in f){if(!this._testSelectedValue(f[e])){throw {message:'No element with text "'+(f[e].text||f[e])+'" was found in tags'}}}return true};c.prototype._testSelectedValue=function(k){var e=this.options.tags,j=k.text||k;for(var g in e){var h=e[g];for(var f in h){if(""+h[f].text===""+j){return true}}}return false};c.prototype._normalizeTags=function(f){var e=f.map(function(g){return{id:g.id||g,text:g.text||g}});return e};c.prototype.val=function(e){if(e){this._setSelectedValues(e)}return this.values.map(a.proxy(function(f){return{id:typeof f.id!="undefined"?this._fixId(f.id):f,text:f.text||f}},this))};c.prototype.valid=function(){if(typeof this.options.validate=="function"){return this.options.validate(this.val())}if(typeof this.options.validate=="string"){var e=this.values.reduce(function(f,g){return(f.text||f)+(g.text||g)});return new RegExp(this.options.validate,"g").test(e)}if(typeof this.options.validate=="object"&&this.options.validate instanceof RegExp){var e=this.values.reduce(function(f,g){return(f.text||f)+(g.text||g)});return this.options.validate.test(e)}return true};c.prototype.preview=function(){var e=this.val();if(typeof this.options.preview=="function"){return this.options.preview(e)}return e.reduce(function(f,g){return(f.text||f)+", "+(g.text||g)})};c.prototype.valuesText=function(e){e=e||this.values;return e.map(function(f){return f.text||f})};c.prototype.tags=function(f,e){if(f&&f instanceof Array){this.options.tags=f.slice();this.currentTagsIndex="0";if(e){this.currentTags=this._getNextTags()}else{this.currentTags=this.options.tags[this.currentTagsIndex]}this.$element.select2({tags:this.currentTags});this.val([]);if(this.options.sortable){this._initSortable(true)}}return this.options.tags};a.widget("bforms.bsTaglist",c.prototype);return c};if(typeof window.define=="function"&&define.amd){define("bforms-taglist",["jquery","select2","jquery-ui-core"],factory)}else{factory(window.jquery)};define("bforms-grid",["jquery","jquery-ui-core","bforms-pager","bforms-editable","bforms-panel","bforms-ajax","bforms-namespace","bforms-inlineQuestion"],function(){var a=function(b){this.options=$.extend(true,{},this.options,b);this._init()};a.prototype.options={$toolbar:$([]),gridItem:".bs-item",gridItemDetails:".bs-details",gridDetailsContainer:".bs-rowDetails",hasOrder:true,orderContainerSelector:".title",orderElemSelector:".bs-orderColumn",multipleOrder:false,defaultPage:1,currentPage:1,goTopElement:null,uniqueName:null,gridRowsHeaderSelector:".bs-header",gridContainerSelector:".grid_rows",gridCountContainerSelector:"h2 > .badge",gridHeaderSelector:"h2",filterSelector:".bs-filter",resetGridSelector:".bs-resetGrid",addSelector:".bs-triggerAdd",expandToggleSelector:".bs-toggleExpand",inlineActionSelector:".bs-inline_action",bulkContainerSelector:".bs-selectorsContainer",rowsContainerSelector:".grid_rows_wrapper",rowSelector:".grid_row",rowHeaderSelector:"header",rowDetailsSelector:".grid_row_details",rowActionsContainerSelector:".bs-row_controls",rowDetailsSuccessHandler:null,rowActions:[],updateRowUrl:null,hasRowCheck:true,rowCheckSelector:'.bs-row_check:not([disabled="disabled"])',headerCheckSelector:".check_all > input",groupActionsSelector:".bs-group_actions",gridCell:".grid_cell",pager:null,pagerUrl:null,onRefresh:null,pagerSelector:".bs-pager",pagerGoTopTitle:"",pagerDataPageContainer:"page",goTopAfterPagination:false,detailsSelector:".bs-expand",detailsUrl:null,multipleDetails:true,removeDetailsOnCollapse:false,validationSummaryContainer:".bs-validation_summary",validationRowActionsContainer:".bs-validation_row_action",errorRowContainer:".bs-validation_row",errorCloseSelector:".bs-form-error .close",noResultsRowSelector:".bs-noResultsRow",sortable:true,rowClickExpandable:true,expandByToggleSelector:true,defaultFilterButtons:[{btnSelector:".js-all",filter:function(b){return true},},{btnSelector:".js-none",filter:function(b){return false},}]};a.prototype._refreshModel={OrderableColumns:[],Search:{},Page:1,PageSize:5,quickSearch:"",fromReset:false};a.prototype._initialModel={PageSize:5};a.prototype._init=function(){this.$element=this.element;if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.expandByToggleSelector){$(this.options.expandToggleSelector).hide()}if(!this.options.uniqueName){throw"grid needs a unique name or the element on which it is aplied has to have an id attr"}this._initDefaultOptions();this._initSelectors();if(this.options.selectorsContainerTitle){this.$selectorsContainer.attr("title",this.options.selectorsContainerTitle)}this.options.hasRowCheck=this.$actionsContainer.length>0;this.hasDetails=this.options.detailsSelector&&this.options.detailsUrl;this._addDelegates();this.refreshModel=$.extend(true,{},this._refreshModel,this.element.data("settings"));this.refreshModel.OrderColumns=this._getColumnsOrder();this._currentResultsCount=this.element.data("initialcount");this.$pager=this.element.find(this.options.pagerSelector).bsPager({pagerUpdate:$.proxy(this._evOnPageChange,this),pagerUpdateNoOffset:$.proxy(this._onPageNoOffsetChange,this),pagerGoTop:$.proxy(this._evOnPagerGoTop,this),goTopTitle:this.options.pagerGoTopTitle,dataPageContainer:this.options.pagerDataPageContainer});this.refreshModel.PageSize=parseInt(this.$pager.bsPager("getPageSize"),10)||this.refreshModel.PageSize;this._initialModel.PageSize=this.refreshModel.PageSize;this.needsRefresh=false;if(this.options.sortable&&($.browser==null||$.browser.mobile==false)){this._initSortable()}this.$rowsContainer.find(this.options.rowSelector).each($.proxy(function(b,c){this._initInitialDetails($(c))},this))};a.prototype._initDefaultOptions=function(){if(typeof this.options.filterButtons!=="undefined"&&$.isArray(this.options.filterButtons)){this.options.filterButtons=this.options.filterButtons.concat(this.options.defaultFilterButtons)}else{this.options.filterButtons=this.options.defaultFilterButtons}};a.prototype._addDelegates=function(){if(this.hasDetails){this.element.on("click",this.options.detailsSelector,$.proxy(this._evOnDetailsClick,this));if(this.options.rowClickExpandable){this.element.on("click",this.options.rowSelector,$.proxy(this._onRowClick,this))}}if(this.options.hasOrder){this.element.on("click",this.options.orderContainerSelector+" "+this.options.orderElemSelector,$.proxy(this._evOnOrderChange,this))}if(this.options.hasRowCheck){this.$headerCheck=this.element.find(this.options.headerCheckSelector);this.element.on("click",this.options.rowCheckSelector,$.proxy(this._evOnRowCheckChange,this));this.element.on("change",this.options.headerCheckSelector,$.proxy(this._evOnHeaderCheckSelector,this));for(var b=0;b<this.options.filterButtons.length;b++){var c=this.options.filterButtons[b];(function(e,d){d.$actionsContainer.on("click",e.btnSelector,$.proxy(function(f){f.preventDefault();this.$rowsContainer.find(d.options.rowCheckSelector).parents(d.options.rowSelector).each($.proxy(function(j,i){var g=$(i);var h=e.filter.call(this,g);g.find(this.options.rowCheckSelector).prop("checked",h);h?g.addClass("selected"):g.removeClass("selected")},this));this._evOnRowCheckChange(null,$(f.currentTarget))},d))})(c,this)}if(this.options.gridActions!=null){for(var b=0;b<this.options.gridActions.length;b++){var c=this.options.gridActions[b];(function(j,i){if(j.popover){var d=i.$actionsContainer.find(j.btnSelector);var k="Are you sure?";var h="btn-primary bs-confirm";var f="btn-theme bs-cancel";var g="Yes";var e="No";if(typeof j.question!=="undefined"){k=j.question}if(typeof j.confirmButtonText!=="undefined"){g=j.confirmButtonText}if(typeof j.cancelButtonText!=="undefined"){e=j.cancelButtonText}if(typeof j.confirmCssClass!=="undefined"){h=j.confirmCssClass+" bs-confirm"}if(typeof j.cancelCssClass!=="undefined"){f=j.cancelCssClass+" bs-cancel"}d.bsInlineQuestion($.extend(true,j.popoverOptions,{placement:"auto",question:k,popoverOptions:{animation:false},buttons:[{text:g,cssClass:h,callback:$.proxy(function(){var l=j.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this);if(l!==false){d.bsInlineQuestion("toggle")}},i)},{text:e,cssClass:f,callback:function(l){d.bsInlineQuestion("toggle")}}]}));d.attr("title",d.attr("data-original-title")||"")}else{i.$actionsContainer.on("click",j.btnSelector,$.proxy(function(l){j.handler.call(this,this.element.find(this.options.rowSelector+".selected"),this)},i))}})(c,this)}}}this.element.on("click",".edit_col",$.proxy(this._evOnCellEdit,this));this.element.on("click",this.options.resetGridSelector,$.proxy(this._evResetGrid,this));this.element.on("click",this.options.errorCloseSelector,$.proxy(this._evOnErrorRemove,this));if(this.options.expandByToggleSelector){this.element.on("click",this.options.expandToggleSelector,$.proxy(this._evOnExpandToggle,this))}this.element.on("click",this.options.addSelector,$.proxy(function(){if(this.options.$toolbar!=null&&typeof this.options.$toolbar.bsToolbar==="function"){this.options.$toolbar.bsToolbar("toggleControl","add")}},this))};a.prototype._initSelectors=function(){this.$rowsContainer=this.element.find(this.options.rowsContainerSelector);this.$gridContainer=this.element.find(this.options.gridContainerSelector);this.$gridCountContainer=this.element.find(this.options.gridCountContainerSelector);this.$filterIcon=this.element.find(this.options.filterSelector);this.$resetGridButton=this.element.find(this.options.resetGridSelector);this.$gridOrderContainer=this.element.find(this.options.orderContainerSelector);this.$actionsContainer=this.element.find(this.options.groupActionsSelector);this.$gridHeader=this.element.find(this.options.gridHeaderSelector);this.$expandToggle=this.element.find(this.options.expandToggleSelector);this.$gridRowsHeader=this.element.find(this.options.gridRowsHeaderSelector);this.$selectorsContainer=this.element.find(this.options.bulkContainerSelector)};a.prototype._createActions=function(f,c){for(var e=0;e<f.length;e++){var d=f[e];if(typeof d.handler!=="function"&&typeof d.init!=="function"){throw"action with selector "+d.btnSelector+" has no click handler and no init handler"}var b=c.find(d.btnSelector);if(typeof d.init==="function"){b.each($.proxy(function(i,h){var g=$(h);if(!g.data("hasrowaction")){d.init.call(this,$.extend(true,{},d,{btnSelector:g}),c,this);g.data("hasrowaction",true)}},this))}if(typeof d.handler==="function"){b.each($.proxy(function(i,h){var g=$(h);if(!g.data("hasrowhandler")){g.on("click",$.proxy(function(j,k){var l=j.options;l.handler.call(this,k,l,$(k.target).closest(this.options.rowSelector),this)},this,{options:d}));g.data("hasrowhandler",true)}},this))}}};a.prototype.initSearch=function(b){this.refreshModel.Search=b;if(this._isNoOffset()){this._getTotalCount(true)}};a.prototype.search=function(b,c){if(b.Page){this.refreshModel.Page=b.Page}else{this.refreshModel.Page=1}if(c){this.refreshModel.quickSearch=b;this.refreshModel.Search=null}else{this.refreshModel.Search=b;this.refreshModel.quickSearch=null}this._showFilterIcon();if(c&&this.refreshModel.quickSearch==""){this._hideFilterIcon()}this.refreshModel.fromReset=false;if(this._isNoOffset()){this.refreshModel.GoTo="First";this._forceGetCount=true}this._getPage()};a.prototype.reset=function(b,c){this.refreshModel.Page=1;this.refreshModel.Search=b;this.refreshModel.quickSearch=null;this.refreshModel.fromReset=true;this._hideFilterIcon();if(this.$pager&&this.$pager.length&&this.$pager.bsPager("noOffset")){this.refreshModel.GoTo="First"}if(this._isNoOffset()){this._forceGetCount=true}if(c!==true){this._getPage()}};a.prototype.refresh=function(c,b){this._getPage();if(this._isNoOffset()){this._getTotalCount(true)}};a.prototype.add=function(f,d,e){if(typeof this.options.addValidation==="function"){var c=this.options.addValidation.apply(this,[d,e]);if(c===false){return}}var b=$(f).find(this.options.rowSelector);b.attr("data-new",true);this._currentResultsCount++;this._forceSetCount=true;this._changeCount();this.$pager.bsPager("add");if(this.$rowsContainer.hasClass("no_results")){this.$rowsContainer.removeClass("no_results");this.$rowsContainer.children().remove();this.$gridRowsHeader.closest(".row").show()}this.$rowsContainer.prepend(b);this._createActions(this.options.rowActions,b);this.$pager.bsPager("updateTotal",this._currentResultsCount);this.toggleBulkActions();this._updateExpandToggle();this.$rowsContainer.show();this.element.find(this.options.noResultsRowSelector).remove();this._trigger("afterAdd",0,{row:f,data:d})};a.prototype.collapseAll=function(){var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector+".open");b.find(this.options.detailsSelector).trigger("click")};a.prototype.hideBulkActions=function(){if(this.options.hasRowCheck){this.$resetGridButton.hide();this.$actionsContainer.children('button:not([data-ignore="true"])').hide();this.element.find(this.options.headerCheckSelector).parent().hide();this.element.find(this.options.headerCheckSelector).prop("checked",false);this.element.find(this.options.rowCheckSelector).hide();this.element.find(this.options.rowCheckSelector).prop("checked",false);this.element.find(this.options.rowCheckSelector).parents(this.options.rowSelector).removeClass("selected")}};a.prototype.showBulkActions=function(){if(this.options.hasRowCheck){this.element.find(this.options.headerCheckSelector).parent().show();this.element.find(this.options.rowCheckSelector).show()}};a.prototype.showErrors=function(c){if(c.Message){var b=$(this.element).find(".bs-validation_summary");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(b)}this._addError(c.Message,b)}};a.prototype.manualPager=function(c,d){this._trigger("beforeManualPager",0,c);var b={name:this.options.uniqueName+"|pager",url:this.options.pagerUrl,data:c,callbackData:{sent:c,pageChanged:d||false},context:this,success:$.proxy(this._pagerAjaxSuccess,this),error:$.proxy(this._pagerAjaxError,this),loadingElement:this.$rowsContainer,loadingDelay:100,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._createDetails=function(){var b=this.element.find(this.options.detailsContainerSelector).each(function(d,c){this._createDetailsHelper($(c))},this)};a.prototype._createDetailsHelper=function(b){var c=b.closest(this.options.rowSelector);if(!c.data("objid")<0){throw"row with index "+c.index()+" has no objId set"}b.prepend('<a href="#" class="expand">&nbsp;</a>');var d=b.find(".expand");d.on("click",this._evOnDetailsClick,this)};a.prototype._evOnDetailsClick=function(f,d){f.preventDefault();f.stopPropagation();var b=$(f.currentTarget).closest(this.options.rowSelector);if(d!=null&&d.removeErrors){if(b.find(this.options.errorCloseSelector).length){b.find(this.options.errorCloseSelector).trigger("click");this._updateExpandToggle();return}}if(b.hasClass("open")){b.removeClass("open");b.children(this.options.rowDetailsSelector).stop(true,true).slideUp(400);this._updateExpandToggle();return}if(b.data("hasdetails")){this._handleDetails(b);return}var g={items:[{Id:b.data("objid"),GetDetails:true}]};this._addAdditionalData(g);this._trigger("beforeGetRowsAjax",0,g);var c={name:this.options.uniqueName+"|details|"+b.data("objId"),url:this.options.detailsUrl,data:g,callbackData:{sent:g,row:b,id:b.data("objid")},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"};$.bforms.ajax(c)};a.prototype._detailsAjaxSuccess=function(d){var b=$(d.RowsHtml),c=b.find(this.options.rowSelector);c.each($.proxy(function(g,h){var f=$(h);if(f.parents(c).length>1){return true}var e=this._getRowElement(f.data("objid"));e.find(this.options.rowHeaderSelector).replaceWith(f.find(this.options.rowHeaderSelector).first());e.append(f.find(this.options.rowDetailsSelector).hide());d.$detailsHtml=e.find(this.options.rowDetailsSelector);this._trigger("beforeRowDetailsSuccess",0,{$row:e,data:d});e.stop(true,true).slideDown(800);this._handleDetails(e);e.data("hasdetails",true);this._createActions(this.options.rowActions,e);this._trigger("afterRowDetailsSuccess",0,{$row:e,data:d})},this))};a.prototype._detailsAjaxError=function(e){if(e.Message){var d=arguments[4].row;if(typeof d!=="undefined"&&d!=null){var b=d.find(".bs-validation_row");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row"></div>');d.find(this.options.rowHeaderSelector).after(b)}this._addError(e.Message,b,true);this._updateExpandToggle()}else{var c=$(this.element).find(".bs-validation_summary");if(c.length==0){c=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.element.find("h2").after(c)}this._addError(e.Message,c)}}};a.prototype._expandGridRow=function(b){b.addClass("open");b.find(this.options.rowDetailsSelector).stop(true,true).slideDown(800)};a.prototype._handleDetails=function(d){var c=this.element.find(this.options.rowSelector+".open"),e=false;if(c.length>0&&!this.options.multipleDetails){c.removeClass("open");var b=c.children(this.options.rowDetailsSelector);b.hide();if(this.options.removeDetailsOnCollapse){b.remove();c.data("hasdetails",false)}this._expandGridRow(d);$.bforms.scrollToElement(d);e=true}if(!e){this._expandGridRow(d)}this._updateExpandToggle()};a.prototype._getMultiDetails=function(e,c){var b=this.$rowsContainer.find(this.options.rowSelector).length==c.length?this.$rowsContainer:c,d={items:e};this._addAdditionalData(d);this._trigger("beforeGetMultiDetails",0,{data:d,$rows:c});$.bforms.ajax({name:this.options.uniqueName+"|multiDetails",url:this.options.detailsUrl,data:d,callbackData:{items:e},context:this,success:$.proxy(this._detailsAjaxSuccess,this),error:$.proxy(this._detailsAjaxError,this),loadingElement:b,loadingClass:"loading"})};a.prototype._evOnPageChange=function(c,b){this.refreshModel.Page=b.page;var d=true;if(b.pageSize&&this.refreshModel.PageSize!==b.pageSize){this.refreshModel.PageSize=b.pageSize;d=false}this._getPage(d)};a.prototype._onPageNoOffsetChange=function(c,b){this.refreshModel.GoTo=b.goTo;if(b.pageSize&&this.refreshModel.PageSize!==b.pageSize){this.refreshModel.PageSize=b.pageSize;d=false}var d=true;this._getPage(true)};a.prototype._evOnPagerGoTop=function(c){var b=$([]);if(this.options.goTopElement!==null){b=$(this.options.goTopElement)}else{b=this.$gridHeader}if(b.length){$.bforms.scrollToElement(b)}};a.prototype._evOnOrderChange=function(c){c.preventDefault();c.stopPropagation();if(!this._currentResultsCount){return}var d=$(c.currentTarget);var k="";var l="";var m=0;if(d.hasClass("sort_asc")){k="sort_desc";m=2}else{if(!d.hasClass("sort_desc")||this._isNoOffset()){k="sort_asc";m=1}}var h=d.parent().data("name");var j={Name:h,Type:m};if(this.options.multipleOrder){var b=false;for(var f=0;f<this.refreshModel.OrderableColumns.length;f++){var g=this.refreshModel.OrderableColumns[f];if(g.Name==h){if(m==0){this.refreshModel.OrderableColumns.splice(f,1)}else{g.Type=m}b=true;break}}if(!b){this.refreshModel.OrderableColumns.push(j)}d.removeClass("sort_asc").removeClass("sort_desc")}else{this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc").removeClass("sort_desc");this.refreshModel.OrderableColumns=[];this.refreshModel.OrderableColumns.push(j)}if(m!=0){d.addClass(k)}if(this._isNoOffset()){this.refreshModel.GoTo="First"}this._getPage();if(!this._isInitialState()){this._showResetGridButton()}else{this._hideResetGridButton()}};a.prototype._evOnHeaderCheckSelector=function(f){var d=$(f.currentTarget).prop("checked");this.element.find(this.options.rowCheckSelector).prop("checked",d);var b=this.element.find(this.options.rowCheckSelector).parents(this.options.rowSelector);if(d){b.addClass("selected")}else{b.removeClass("selected")}var c=this.$actionsContainer.children('button:not([data-ignore="true"])');if(d){this._showBulkActions(c,b);this._showResetGridButton()}else{c.hide();this._hideResetGridButton()}};a.prototype._evOnRowCheckChange=function(i,f){var c;if(i&&typeof i.stopPropagation=="function"){i.stopPropagation();c=$(i.currentTarget)}else{c=f}if(typeof c!=="undefined"&&c!=null){var d=c.closest(this.options.rowSelector);if(c.prop("checked")){d.addClass("selected")}else{d.removeClass("selected")}}var b=this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).parents(this.options.rowSelector),h=b.length;var g=this.$actionsContainer.children('button:not([data-ignore="true"])');if(h>0){this._showBulkActions(g,b);this._showResetGridButton();if(h==this.element.find(this.options.rowCheckSelector).length){this.$headerCheck.prop("indeterminate",false)}else{this.$headerCheck.prop("indeterminate",true)}this.$headerCheck.prop("checked",true)}else{g.hide();this._resetHeaderCheck();this._hideResetGridButton()}if(i!=null){this._hidePopoverOnRowCheckChange(i)}};a.prototype._showBulkActions=function(b,c){b.each($.proxy(function(f,e){var d=$(e),g=true;if(typeof this.options.beforeShowBulkActionButton==="function"){g=this.options.beforeShowBulkActionButton(d,c)}if(g!==false){d.show()}else{d.hide()}},this))};a.prototype._resetHeaderCheck=function(){if(this.$headerCheck){this.$headerCheck.prop("indeterminate",false);this.$headerCheck.prop("checked",false);this.$actionsContainer.children('button:not([data-ignore="true"])').hide()}};a.prototype._evOnCellEdit=function(d){d.preventDefault();d.stopPropagation();var g=$(d.currentTarget);var f=g.parent().index();var c=this.$gridOrderContainer.children(":eq("+f+")").children("form");var b=c.clone();var h=g.closest(this.options.rowSelector).data("id");b.find("*").each(function(j,i){var e=$(i);if(e.attr("id")){e.attr("id",e.attr("id")+"_"+h+"_"+f)}});g.after(b);g.hide();b.show()};a.prototype._evOnCellSave=function(c){c.preventDefault();var b=$(c.cuurentTarget).closest("form");$.validator.unobtrusive.parse(b);if(!b.valid()){return}var d=b.parseForm()};a.prototype._evResetGrid=function(b){b.stopPropagation();var c=false;this._resetHeaderCheck();this._uncheckAllRows();if(!this._isNoOffset()){this._resetOrder()}this._hideResetGridButton(true);this._removeErrors();this._trigger("beforeReset",b,{goToFirstPage:c});if(this.refreshModel.PageSize!=this._initialModel.PageSize){c=true;this.refreshModel.PageSize=this._initialModel.PageSize;this.$pager.bsPager("selectValue",this.refreshModel.PageSize)}if(this.options.$toolbar!=null&&this.$filterIcon.is(":visible")){this.options.$toolbar.bsToolbar("reset",{preventPagination:false})}else{if(c===true){this.refreshModel.Page=1}if(this.$pager&&this.$pager.length&&this.$pager.bsPager("noOffset")){this.refreshModel.GoTo="First"}this._getPage()}};a.prototype._evOnErrorRemove=function(b){if(this.element.find(".bs-form-error").length==1){window.setTimeout($.proxy(function(){this._hideResetGridButton();this._updateExpandToggle()},this),0)}};a.prototype._evOnExpandToggle=function(d){d.preventDefault();d.stopPropagation();if(this.$expandToggle.hasClass("open")){this.element.find(this.options.detailsSelector).trigger("click",{removeErrors:true})}else{var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var c=$();var f=b.map($.proxy(function(g,h){var e=$(h);if(e.data("hasdetails")){this._handleDetails(e)}else{if(e.find(this.options.errorCloseSelector).length==0){c=c.add(e);return{Id:e.data("objid"),getDetails:true}}}},this)).get();if(f.length){this._getMultiDetails(f,c)}}};a.prototype._onRowClick=function(d){if(!this._isInlineAction(d)&&!this._isTextSelectedOrLink(d)){var b=$(d.currentTarget),c=$(d.target).closest(this.options.rowDetailsSelector).length>0,f=$(d.target).closest(".bs-form-error").length>0;if(!c&&!f){b.find(this.options.detailsSelector).trigger("click")}}};a.prototype._getPage=function(d){this.needsRefresh=false;var c=this._serializeRefreshModel();if(this.$pager&&this.$pager.length&&this.$pager.bsPager("noOffset")){this._fillNoOffsetData(c)}if(typeof this.options.onRefresh==="function"){this.options.onRefresh.call(this,c)}this._addAdditionalData(c);this._trigger("beforePager",0,c);var b={name:this.options.uniqueName+"|pager",url:this.options.pagerUrl,data:c,callbackData:{sent:c,pageChanged:d},context:this,success:$.proxy(this._pagerAjaxSuccess,this),error:$.proxy(this._pagerAjaxError,this),loadingElement:this.$rowsContainer,loadingDelay:100,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._pagerAjaxSuccess=function(f,e){f.sendData=e.sent;var i=true;this._trigger("beforePaginationSuccess",0,f);var g=this._currentResultsCount;if(!this._isNoOffset()||this._forceGetCount||f.Count==0){this._currentResultsCount=f.Count||0}var b=$(f.Html),d=$("<div></div>").append(b);if(this._isNoOffset()){if(this._currentResultsCount){this.$rowsContainer.html(b.html());this.$rowsContainer.removeClass("no_results");this.element.find(this.options.pagerSelector).show();this.$gridRowsHeader.closest(".row").show()}else{if(e.sent.GoTo=="Prev"||e.sent.GoTo=="Next"){this.$pager.bsPager("blockGoTo",e.sent.GoTo);this.$pager.bsPager("blockGoTo",e.sent.GoTo=="Prev"?"First":"Last");i=false;this._currentResultsCount=g}else{this.$rowsContainer.html(d.find(this.options.noResultsRowSelector));this.$rowsContainer.addClass("no_results");this.$gridRowsHeader.closest(".row").hide()}}}else{if(this._currentResultsCount){this.$rowsContainer.html(b.html());this.$rowsContainer.removeClass("no_results");this.element.find(this.options.pagerSelector).show();this.$gridRowsHeader.closest(".row").show()}else{this.$rowsContainer.html(d.find(this.options.noResultsRowSelector));this.$rowsContainer.addClass("no_results");this.$gridRowsHeader.closest(".row").hide()}}if(i){this.$pager.bsPager("update",b.closest(".bs-pages"))}if(this._isNoOffset()){var h=this.$rowsContainer.find(this.options.rowSelector).length;if(h<this.refreshModel.PageSize){if(e.sent.GoTo=="Next"){this.$pager.bsPager("blockGoTo","Next");this.$pager.bsPager("blockGoTo","Last")}else{if(e.sent.GoTo=="Prev"){this.$pager.bsPager("blockGoTo","Prev");this.$pager.bsPager("blockGoTo","First")}else{if(e.sent.GoTo=="First"){this.$pager.bsPager("blockGoTo","Next");this.$pager.bsPager("blockGoTo","Last");this.$pager.bsPager("blockGoTo","Prev");this.$pager.bsPager("blockGoTo","First")}}}}}if(this._currentResultsCount==0&&i){this.$actionsContainer.hide()}else{this.$actionsContainer.show()}this._changeCount();this._resetHeaderCheck();var c=this.$rowsContainer.find(this.options.rowSelector);c.each($.proxy(function(j,k){this._initInitialDetails($(k))},this));this.toggleBulkActions();this._updateExpandToggle();this._trigger("afterPaginationSuccess",0,f);if(!this.options.expandByToggleSelector){$(this.options.expandToggleSelector).hide()}if(this.options.goTopAfterPagination&&e.pageChanged==true){$.bforms.scrollToElement(this.element)}};a.prototype._changeCount=function(){if(this._isNoOffset()){if(this._currentResultsCount>0){if(!window.isNaN(this._currentResultsCount)){if(this.refreshModel.PageSize!=null){if(this._currentResultsCount>=this.refreshModel.PageSize){if(this._forceGetCount){this.$gridCountContainer.html(this._currentResultsCount+"+");this._getTotalCount()}else{if(this._forceSetCount===true){this.$gridCountContainer.html(this._currentResultsCount);this._forceSetCount=false}}}else{if(this._forceGetCount){this.$gridCountContainer.html(this._currentResultsCount)}}}else{this._getTotalCount()}}else{this._getTotalCount()}}else{if(this._currentResultsCount==0){this.$gridCountContainer.html(this._currentResultsCount)}}}else{this.$gridCountContainer.html(this._currentResultsCount)}};a.prototype._pagerAjaxError=function(c){this._trigger("beforePaginationError",0,c);if(c.Message){var b=$(this.element).find(".bs-validation_summary");if(b.length==0){b=$('<div class="bs-validation_summary"></div>');this.element.find("h2").after(b)}this._addError(c.Message,b)}if(arguments[4]&&arguments[4].pageChanged){$.bforms.scrollToElement(this.$gridHeader)}this._trigger("afterPaginationError",0,c)};a.prototype._fillNoOffsetData=function(d){var c=this.$element.find(this.options.gridRowsHeaderSelector);if(d.GoTo=="Next"||d.GoTo=="Prev"){var b=d.GoTo=="Next"?this.$element.find(this.options.rowSelector+'[data-new!="true"]:last'):this.$element.find(this.options.rowSelector+'[data-objid][data-new!="true"]:first');if(d.OrderableColumns){for(var e in d.OrderableColumns){var f=d.OrderableColumns[e],g=c.find("[data-name]").index(c.find('[data-name="'+f.Name+'"]')),h=b.find(this.options.gridCell).eq(g).data("value");if(window.isNaN(h)||h==""){f.Value=h}else{f.Value=h}}}if(d.GoTo=="Next"){d.UniqueId=b.data("objid")}else{if(d.GoTo=="Prev"){d.UniqueId=b.data("objid")}}}};a.prototype._isNoOffset=function(){return this.$pager&&this.$pager.length&&this.$pager.bsPager("noOffset")};a.prototype._reverseOrder=function(c){if(c&&c.OrderableColumns){for(var d in c.OrderableColumns){var e=c.OrderableColumns[d],b=this._getOrderColumn(e.Name);if(e.Type==1){e.Type=2}else{if(e.Type==2){e.Type=1}}}}};a.prototype._getTotalCount=function(c){if(typeof this.options.countUrl!=="undefined"){if(c===true||this._forceGetCount===true){var b=this._serializeRefreshModel();this._forceGetCount=false;$.bforms.ajax({url:this.options.countUrl,success:$.proxy(this._onGetTotalCountSuccess,this),error:$.proxy(this._onGetTotalCountError,this),data:b})}}};a.prototype._onGetTotalCountSuccess=function(b){this._currentResultsCount=b.Count;this.$gridCountContainer.html(b.Count)};a.prototype._onGetTotalCountError=function(b){};a.prototype._initSortable=function(){this.$gridOrderContainer.find("header").sortable({start:$.proxy(this._onSortStart,this),stop:$.proxy(this._onSortStop,this),update:$.proxy(this._onSortUpdate,this),containment:"parent",distance:10,cursor:"move",tolerance:"pointer",helper:"clone"})};a.prototype._onSortStart=function(b,c){this.$rowsContainer.addClass("loading");c.item.data("startpos",c.item.index());this.element.find(this.options.expandToggleSelector).hide()};a.prototype._onSortStop=function(b,d){var c=d.item.data("startpos");if(c==d.item.index()){this.$rowsContainer.removeClass("loading");this.$expandToggle.show()}};a.prototype._onSortUpdate=function(b,c){this.refreshModel.OrderColumns=this._getColumnsOrder();this._getPage();this.$expandToggle.show()};a.prototype._hidePopoverOnRowCheckChange=function(d){var b=$(d.target);var c=$(".bs-hasInlineQuestion").filter(function(h,g){var e=$(g),i=e.data("bs.popover");if(typeof i!=="undefined"&&i!=null){var f=i.$tip;return f.is(":visible")&&e[0]!=b[0]&&e.find(b).length==0&&b[0]!=f[0]&&f.find(b).length==0}return false});c.bsInlineQuestion("toggle")};a.prototype._showFilterIcon=function(){this.$filterIcon.show();this._showResetGridButton()};a.prototype._hideFilterIcon=function(){this.$filterIcon.hide();this._hideResetGridButton()};a.prototype._showResetGridButton=function(){this.$resetGridButton.show()};a.prototype._hideResetGridButton=function(b){if(this._isInitialState()||b===true){this.$resetGridButton.hide()}};a.prototype._isInitialState=function(){if(this.$filterIcon.is(":visible")){return false}if(this.element.find(this.options.errorCloseSelector).length){return false}var c=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector+'[data-expandedonload="True"]');var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(c);var e=c.filter(function(){return $(this).hasClass("open")}).length,d=b.not(".open").length;if(c.length!=e||b.length!=d){return false}if(this.element.find(this.options.rowCheckSelector).filter(function(){return $(this).prop("checked")}).length>0){return false}return true};a.prototype._uncheckAllRows=function(){var b=this.element.find(this.options.rowsContainerSelector+">"+this.options.rowSelector);this.element.find(this.options.rowCheckSelector).prop("checked",false);b.removeClass("selected")};a.prototype._resetOrder=function(){this.element.find(this.options.orderContainerSelector+" "+this.options.orderElemSelector).removeClass("sort_asc sort_desc");this.refreshModel.OrderableColumns=[]};a.prototype._removeErrors=function(){this.element.find(this.options.errorCloseSelector).trigger("click")};a.prototype._updateExpandToggle=function(){if(this.element.find(this.options.detailsSelector).length>0){this.$expandToggle.show()}else{this.$expandToggle.hide()}var c=false;var b=this.element.find(this.options.detailsSelector).parents(this.options.rowSelector).not(".open");var d=b.length-b.find(this.options.errorCloseSelector).length;if(d==0){c=true}if(this._isInitialState()){this._hideResetGridButton()}else{this._showResetGridButton()}if(c){this.$expandToggle.addClass("open")}else{this.$expandToggle.removeClass("open")}};a.prototype._getColumnsOrder=function(){var b=[];this.$gridOrderContainer.find("*[data-name]").each(function(d,c){b.push({key:$(c).data("name"),value:d})});return b};a.prototype._getRowElement=function(d,b){var c=null;if(b){c=this.element.find(this.options.rowSelector+"[data-"+b+'="'+d+'"]')}if(c==null||c.length==0){c=this.element.find(this.options.rowSelector+'[data-objid="'+d+'"]')}return c};a.prototype._initInitialDetails=function(b){var c={$detailsHtml:b.find(this.options.rowDetailsSelector)};this._createActions(this.options.rowActions,b);if(c.$detailsHtml.length){this._trigger("beforeRowDetailsSuccess",0,{$row:b,data:c});this._handleDetails(b);b.data("hasdetails",true);this._trigger("afterRowDetailsSuccess",0,{$row:b,data:c})}};a.prototype._isTextSelectedOrLink=function(b){var c="";if(typeof window.getSelection!="undefined"){c=window.getSelection().toString()}else{if(typeof document.selection!="undefined"&&document.selection.type=="Text"){c=document.selection.createRange().text}}return c!==""||$(b.target).prop("tagName")=="A"};a.prototype._isInlineAction=function(b){if($(b.target).is(this.options.inlineActionSelector)||$(b.target).parents(this.options.inlineActionSelector).length>0){return true}return false};a.prototype.toggleBulkActions=function(){if(this.element.find(this.options.rowCheckSelector).length>0){this.element.find(this.options.groupActionsSelector).show()}else{this.element.find(this.options.groupActionsSelector).hide()}};a.prototype._serializeRefreshModel=function(){var b={};for(var d in this.refreshModel){if(d in this.refreshModel){var e=this.refreshModel[d];if(e instanceof Array||typeof(e)!=="object"){b[d]=this.refreshModel[d]}else{for(var c in e){if(c in e){b[c]=e[c]}}}}}return b};a.prototype._addAdditionalData=function(b){if(typeof this.options.additionalData!=="undefined"){$.extend(true,b,this.options.additionalData)}};a.prototype.toggleRowColor=function(g,d,h){var e={};e[true]="rgb(89, 180, 68)";e[false]="rgb(240, 173, 78)";h=h||"objid";var b=(typeof g=="string"||typeof g=="number")?this.element.find(this.options.rowSelector+"[data-"+h+'="'+g+'"]'):g;var c=b.find(".grid_row_color");if(typeof d=="boolean"){d=e[d]}if(typeof d=="undefined"){var f=b.data("active")=="True";d=e[!f]}c.css("background-color",d)};a.prototype.removeRow=function(c,d){d=d||"objid";var b=(typeof c=="string"||typeof c=="number")?this.element.find(this.options.rowSelector+"[data-"+d+'="'+c+'"]'):c;b.remove()};a.prototype._getOrderColumn=function(b){return this.$element.find(this.options.gridRowsHeaderSelector).find('[data-name="'+b+'"]').find(this.options.orderElemSelector)};a.prototype.updateRow=function(f,d,e){var c={items:[{Id:f.data("objid"),GetDetails:d||true}]};this._addAdditionalData(c);var b={name:this.options.uniqueName+"|UpdateRow|"+c.objId,url:this.options.detailsUrl,data:c,callbackData:{sent:c,row:f},context:this,success:$.proxy(this._updateRowAjaxSuccess,this),error:$.proxy(this._updateRowAjaxError,this),loadingElement:f,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._updateRowAjaxSuccess=function(c,b){this.updateRows(c.RowsHtml)};a.prototype._updateRowAjaxError=function(d){if(d.Message){var c=arguments[4].row;var b=c.find(this.options.errorRowContainer);if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row"></div>');c.find(this.options.rowHeaderSelector).after(b)}this._addError(d.Message,b,true)}};a.prototype._rowActionAjaxError=function(d,c){if(d.Message){var b=c.find(".bs-validation_row_control");if(b.length==0){b=$('<div class="col-sm-12 col-lg-12 bs-validation_row_control"></div>');c.find(this.options.rowActionsContainerSelector).before(b)}this._addError(d.Message,b,true)}};a.prototype._addError=function(d,c,e){var b=$('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+d+"</div>");if(e){c.html(b)}else{c.append(b)}this._showResetGridButton()};a.prototype.setInitialCount=function(b){this._currentResultsCount=b};a.prototype.updateRows=function(e,d){var b=$(e);var c=b.find(this.options.rowSelector);var f=d?d:"objid";c.each($.proxy(function(k,m){var h=$(m),l=h.data(f)||h.data("objid");var g=this._getRowElement(l,d);if(this.options.hasRowCheck){var j=g.find(this.options.rowCheckSelector).prop("checked");var i=h.find(this.options.rowCheckSelector);if(i.length){h.find(this.options.rowCheckSelector).prop("checked",j);if(j){h.addClass("selected")}}}g.find(".bs-hasPanel").each(function(q,p){var n=$(p);if(n.hasClass("bs-panelEditMode")&&!n.hasClass("bs-replaceEditable")){var o=h.find("#"+n.attr("id"));o.replaceWith(n)}});g.replaceWith(h);this._initInitialDetails(h);this._evOnRowCheckChange()},this));this._updateExpandToggle()};a.prototype.getSelectedRows=function(){var c=this.element.find(this.options.rowSelector+".selected");var b=c.map(function(e,f){var d=$(f);return{Id:d.data("objid"),GetDetails:d.hasClass("open")}}).get();return b};a.prototype.getRowElement=function(b){return this._getRowElement(b)};a.prototype.enableRowActions=function(c){var b=typeof c==="number"?this._getRowElement(id):c;b.find(this.options.rowActionsContainerSelector).find(".disabled").removeClass("disabled")};a.prototype.disableRowActions=function(c){var b=typeof c==="number"?this._getRowElement(id):c;b.find(this.options.rowActionsContainerSelector).find("button").addClass("disabled")};$.widget("bforms.bsGrid",a.prototype);return a});define("bforms-toolbar",["bforms-toolbar-advancedSearch","bforms-toolbar-add","bforms-toolbar-quickSearch","bforms-toolbar-order","jquery","jquery-ui-core","amplify","bforms-form"],function(b,a,d,c){jQuery.nsx("bforms.toolbar.defaults");jQuery.nsx("bforms.toolbar.controls");$.bforms.toolbar.defaults.AdvancedSearch=b;$.bforms.toolbar.defaults.Add=a;$.bforms.toolbar.defaults.QuickSearch=d;$.bforms.toolbar.defaults.Order=c;var e=function(f){this.options=f;this._create()};e.prototype.options={uniqueName:null,saveTabState:false,tabContainerSelector:".grid_toolbar_form",autoInitControls:true,reset:null,controls:null,navbarCollapse:".grid_toolbar_responsive_navbar",controlsOptions:null};e.prototype._init=function(){this.$element=this.element;if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"toolbar needs a unique name or the element on which it is aplied has to have an id attr"}this._controls=[];this.subscribers=new Array();if(this.options.subscribers){this._addSubscribers(this.options.subscribers)}if(this.options.autoInitControls){for(var j in $.bforms.toolbar.defaults){if(j in $.bforms.toolbar.defaults){var l=$.extend(true,{},this.options.controlsOptions);if(typeof this.options.customControlsOptions!=="undefined"&&typeof this.options.customControlsOptions[j]!=="undefined"){$.extend(true,l,this.options.customControlsOptions[j])}var g=new $.bforms.toolbar.defaults[j](this.element,l);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}for(var j in $.bforms.toolbar.controls){if(j in $.bforms.toolbar.controls){var g=new $.bforms.toolbar.controls[j](this.element);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}}if(this.options.controls instanceof Array){for(var h=0;h<this.options.controls.length;h++){if(typeof(this.options.controls[h])!="undefined"){var g=new this.options.controls[h](this.element,this.options);var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}}}this._addControls(this._controls);this._updateSelectedTab();this._expandSavedTab();this._addDelegates()};e.prototype.reset=function(){this._reset(arguments);if(typeof this.options.reset==="function"){this.options.reset.apply(this,arguments)}};e.prototype._reset=function(j){var k=true,l=this.getControl("quickSearch");if(typeof j!=="undefined"){k=j.preventPagination}if(l!=null&&typeof l.reset==="function"){l.reset()}var f=this.getControl("advancedSearch"),g;if(f!=null){f.$container.bsForm("reset");g=f.$container.bsForm("parse")}var m=this.element.data("bformsBsToolbar");for(var h=0;h<m.subscribers.length;h++){m.subscribers[h].bsGrid("reset",g,k)}};e.prototype._addDelegates=function(){this.$element.on("hide.bs.collapse",$.proxy(this._onCollapseHide,this))};e.prototype.controls=function(h){for(var j=0;j<h.length;j++){var g=h[j];var f=this.element.find(g._defaultOptions.selector);if(f.length>0){g.$element=f;this._controls.push(g)}}this._addControls(h)};e.prototype._addControls=function(g){if(!g){return}for(var h=0;h<g.length;h++){var f=g[h];if(f.$element){switch(f.type){case"action":this._addAction(f);break;case"tab":this._addTab(f);f.init();break;default:this._addCustomControl(f);f.init();break}}}};e.prototype._addTab=function(f){f.$container=$("#"+f.$element.data("tabid"));f.$element.on("click",{tab:f},$.proxy(this._evBtnTabClick,this))};e.prototype._expandSavedTab=function(){if(this.options.saveTabState){var h=this._getTabs();for(var f=0;f<h.length;f++){var g=h[f];if(amplify.store(this._generateTabStateStoreKey(g))){g.$element.trigger("click")}}}};e.prototype._updateSelectedTab=function(){var f=this._getTabs();$.each(f,$.proxy(function(g,h){if(h.$container.is(":visible")){this._selectedTab=h}},this))};e.prototype._addCustomControl=function(f){if(typeof f.name!=="string"||f.name.trim().length==0){throw"all controls must have a name"}if(typeof f.options.selector!=="string"||f.options.selector.trim().length==0){throw"all controls must have a name"}};e.prototype._addAction=function(g){if(typeof g.handler!=="function"){throw"action "+g.name+" must implement an event handler"}var f=this.element.find(g.selector);f.on("click",{buttonOpt:g},$.proxy(this._evBtnClick,this));var h={name:g.name,type:"action",$element:f,options:g};this._controls.push(h)};e.prototype._addSubscribers=function(g){for(var f=0;f<g.length;f++){this._addSubscriber(g[f])}};e.prototype._addSubscriber=function(f){this.subscribers.push(f)};e.prototype._evBtnClick=function(g){g.preventDefault();var f=g.data.buttonOpt;f.handler.call(this,g)};e.prototype._evBtnTabClick=function(g,h){g.preventDefault();var f=g.data.tab;if(this._selectedTab!=null&&this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab)}this._toggleTab(f)};e.prototype._onCollapseHide=function(){if(this._selectedTab!=null){this._toggleTab(this._selectedTab,true)}};e.prototype._toggleTab=function(j,g){if(j==null){return}j.$element.toggleClass("selected");if(j.name=="advancedSearch"){var i=this.getControl("quickSearch");if(i!=null){i.$element.toggleClass("selected")}}var f=this,k=j.$container.is(":hidden"),l={toggled:k,tab:j};if(g){this._trigger("beforeTabToggle",0,l);if(j.$container.is(":visible")){j.$container.hide()}else{j.$container.show()}this._trigger("afterTabToggle",0,l)}else{j.$container.stop(true,false).slideToggle({start:function(){f._trigger("beforeTabToggle",0,l)},complete:function(){f._trigger("afterTabToggle",0,l)}})}var h=j.$element.hasClass("selected");if(this.options.saveTabState){amplify.store(this._generateTabStateStoreKey(j),h)}if(h){this._selectedTab=j}else{this._selectedTab=null}};e.prototype._generateTabStateStoreKey=function(f){var g=window.location.href.split("?")[0];return"slide|"+this.options.uniqueName+"|"+f.options.selector+"|"+g};e.prototype._getTabs=function(){return this._controls.filter(function(f){return f.type=="tab"})};e.prototype.getControl=function(g){var f=$.grep(this._controls,function(h){return h.name==g});if(f!=null&&f[0]!=null){return f[0]}return null};e.prototype.toggleControl=function(g,h){var f=this.getControl(g);if(f!=null&&f.type=="tab"){if(typeof h!=="undefined"){if(h==true){if(this._selectedTab!=null){if(this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab);this._toggleTab(f)}}else{this._toggleTab(f)}}else{if(this._selectedTab!=null&&this._selectedTab.name==f.name){this._toggleTab(f)}}}else{if(this._selectedTab!=null&&this._selectedTab.name!=f.name){this._toggleTab(this._selectedTab)}this._toggleTab(f)}}return f};$.widget("bforms.bsToolbar",e.prototype)});define("bforms-pager",["jquery","jquery-ui-core"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={pagesContainerSelector:".bs-pages",pageSelector:"a[data-page]",goToSelector:"a[data-goto]",dataPageContainer:"page",pageSizeSelector:".bs-perPage",currentPageSelector:"active",disabledPageSelector:"disabled",topResultsMargin:".bs-topResultsMargin",totalsContainerSelector:".results_number span",pageSizeContainerSelector:".results_per_page",perPageDisplaySelector:".bs-perPageDisplay",goTopButtonSelector:".bs-goTop",goTopTitle:""};a.prototype._create=function(){this._noOffset=this.element.data("nooffset")==true;this._initElements();this._addDelegates()};a.prototype._initElements=function(){if(typeof $(this.options.goTopButtonSelector)!=="undefined"&&this.options.goTopTitle){$(this.options.goTopButtonSelector).attr("title",this.options.goTopTitle)}this.$element=this.element};a.prototype._addDelegates=function(){if(this._noOffset){this.$element.on("click",this.options.goToSelector,$.proxy(this._onPageBtnClick,this))}else{this.element.on("click",this.options.pageSelector,$.proxy(this._evPageChanged,this))}this.element.on("click",this.options.pageSizeSelector,$.proxy(this._evPageSizeChanged,this));this.element.on("click",this.options.goTopButtonSelector,$.proxy(this._evGoTopClick,this))};a.prototype._onPageBtnClick=function(d){d.preventDefault();var c=$(d.currentTarget),b=c.parent();var f=c.data("goto");if(b.hasClass(this.options.currentPageSelector)||b.hasClass(this.options.disabledPageSelector)){return}this._trigger("pagerUpdateNoOffset",d,{goTo:f,pageSize:this.element.find(this.options.pageSizeSelector+".selected").data("value")})};a.prototype._evPageChanged=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parent();if(c.hasClass(this.options.currentPageSelector)||c.hasClass(this.options.disabledPageSelector)){return}this._trigger("pagerUpdate",d,{page:b.data(this.options.dataPageContainer),pageSize:this.element.find(this.options.pageSizeSelector+".selected").data("value")})};a.prototype._evPageSizeChanged=function(b){b.preventDefault();var c=$(b.currentTarget).data("value");this.element.find(".selected").removeClass("selected");$(b.currentTarget).addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>');if(this._noOffset){this._trigger("pagerUpdateNoOffset",b,{goTo:"First",pageSize:$(b.currentTarget).data("value")})}else{this._trigger("pagerUpdate",b,{page:1,pageSize:$(b.currentTarget).data("value")})}};a.prototype._evGoTopClick=function(b){this._trigger("pagerGoTop",b)};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c)}};a.prototype._btnClickAjaxError=function(){throw"not implemented error handler"};a.prototype.update=function(c){var d=this.element.find(this.options.pageSizeContainerSelector);var b=this.element.find(this.options.pagesContainerSelector);if(b.length>0){b.html(c.children())}else{this.element.html(c)}c.length==0?d.hide():d.show()};a.prototype.add=function(){var b=window.parseInt(this.element.find("."+this.options.currentPageSelector).find("a").data("page"),10);var f=window.parseInt(this.element.find(this.options.totalsContainerSelector).not(this.options.topResultsMargin).text(),10);if(!window.isNaN(f)){var d=f+1;this.element.find(this.options.totalsContainerSelector).not(this.options.topResultsMargin).html(d)}var e=window.parseInt(this.element.find(this.options.topResultsMargin).text(),10);if(!window.isNaN(e)){var g=this.getPageSize();if(e>g*(b-1)&&e<g*b){var c=e+1;this.element.find(this.options.topResultsMargin).text(c)}}};a.prototype.updateTotal=function(b){this.element.find(this.options.totalsContainerSelector).not(this.options.topResultsMargin).html(b)};a.prototype.selectValue=function(c){var b=this.element.find(this.options.pageSizeSelector+'[data-value="'+c+'"]');if(b.length){this.element.find(".selected").removeClass("selected");b.addClass("selected");this.element.find(this.options.perPageDisplaySelector).html(c+'<span class="caret"></span>')}};a.prototype.getPageSize=function(){return this.element.find(this.options.pageSizeSelector+".selected").data("value")};a.prototype.noOffset=function(){return this._noOffset==true};a.prototype.blockGoTo=function(d){var b=this.$element.find('a[data-goto="'+d+'"]'),c=b.parents("li:first");c.addClass("disabled")};$.widget("bforms.bsPager",a.prototype);return a});define("bforms-editable",["jquery","bforms-extensions","jquery-ui-core","bforms-initUI","bforms-ajax"],function(){var a=function(b){this.options=b;this._init()};a.prototype.options={uniqueName:null,isGroup:true,toggles:true,editFirst:false,editOnly:false,headerSelector:"h3",headerSelectorTrigger:"open-editable",saveClass:"btn-success",cancelClass:"btn-danger",readOnlySelector:".bs-readonly",editorSelector:"form",editModeSelector:"bs-edit_mode",url:null,additionalData:{},editSuccessHandler:null,initPlugins:null};a.prototype._init=function(){if(this.element.hasClass("bs-editable_applied")){return}if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"editable needs a unique name or the element on which it is aplied has to have an id attr"}if(!this.options.url){throw"url must have a value"}this._initSelectors();this._addDelegates();if(this.options.toggles){this.element.find(this.options.headerSelector).addClass("editable")}this._createControls();if(typeof this.options.initPlugins==="function"){this.options.initPlugins.call(this)}if(this.options.editFirst||this.options.editOnly){this._switchToEditable()}var b=this.element.bsInitUI();b.done($.proxy(function(){this._trigger("afterFormInit",{editable:this,$element:this.element})},this));this.element.addClass("bs-editable_applied")};a.prototype._initSelectors=function(){this.$readOnly=this.element.find(this.options.readOnlySelector);this.$editor=this.element.find(this.options.editorSelector);this.$header=this.element.find(this.options.headerSelector)};a.prototype._addDelegates=function(){if(this.options.toggles){this.$header.on("click",$.proxy(this._evOnHeaderClick,this))}};a.prototype.initValidation=function(){if(this.$editor.length){$.validator.unobtrusive.parse(this.$editor);this.$editor.validate()}};a.prototype._createControls=function(){if(this.options.editOnly||this.options.toggles){var c=$('<a title="Save"></a>').addClass(this.options.saveClass).addClass("btn").html('<span class="glyphicon glyphicon-ok"></span> ').attr("href","#").on("click",$.proxy(this._evOnSaveClick,this));if(this.options.toggles){var b=$('<a title="Cancel"></a>').addClass(this.options.cancelClass).addClass("btn").html('<span class="glyphicon glyphicon-remove"></span> ').attr("href","#").on("click",$.proxy(this._evOnCancelClick,this))}this.$controls=$("<span></span>").addClass("controls").append(c).append(b).appendTo(this.$header).hide()}};a.prototype._evOnHeaderClick=function(d){d.preventDefault();var b=$(d.currentTarget);var c=$(d.target);if(b.data("editmode")||(!c.hasClass(this.options.headerSelectorTrigger)&&d.currentTarget!=d.target)){return}this._switchToEditable()};a.prototype._evOnSaveClick=function(g){g.preventDefault();var c=$(g.currentTarget);var b=this.$editor;if(b.length>0){$.validator.unobtrusive.parse(b);var h=b.validate();h.settings.partialNameSearch=true;if(!b.valid()){return}}var f=this.options.prefix?b.parseForm(this.options.prefix):b.parseForm();$.extend(true,f,this.options.additionalData);this._trigger("beforeSaveAjax",0,f);f.Type=this.element.data("type");var d={name:this.options.uniqueName,url:this.options.url,data:f,callbackData:{sent:f},context:this,success:$.proxy(this._saveAjaxSuccess,this),error:$.proxy(this._saveAjaxError,this),validationError:$.proxy(this._saveAjaxValidationError,this),loadingElement:this.element,loadingClass:"loading"};$.bforms.ajax(d)};a.prototype._saveAjaxValidationError=function(c,b){if(c){var d=this.$editor.data("validator");d.showErrors(c.Errors,true)}};a.prototype._saveAjaxSuccess=function(c,b){if(typeof this.options.editSuccessHandler==="function"){this.options.editSuccessHandler.call(this,c)}if(this.options.editOnly){return}this.$readOnly.html($(c.Html).html());this._switchToReadOnly()};a.prototype._saveAjaxError=function(b){if(b.Message){var c=this.$editor.data("validator");c.showSummaryError(b.Message)}};a.prototype._evOnCancelClick=function(b){b.preventDefault();this._switchToReadOnly()};a.prototype._switchToEditable=function(){this.$readOnly.hide();this.$editor.show();this.$controls.show();this.$header.data("editmode",true);this.$header.removeClass("editable")};a.prototype._switchToReadOnly=function(){this.$readOnly.show();this.$editor.hide();this.$controls.hide();this.$header.data("editmode",false);this.$header.addClass("editable")};a.prototype._destroy=function(){this.element.removeClass("bs-editable_applied")};$.widget("bforms.bsEditable",a.prototype);return a});define("bforms-form",["jquery","bforms-extensions","jquery-ui-core","bforms-validate-unobtrusive","bforms-initUI","bforms-ajax","amplify"],function(){var a=function(b){this.options=b;this._create()};a.prototype.options={uniqueName:null,hasGroupToggle:true,style:{},focusFirst:true,ignoreFields:".bs-noreset",saveGroupContainerState:true,appendUrlToUniqueName:true,groupToggleSelector:".bs-group_toggle",groupToggleContainerSelector:".bs-group_toggle_container",groupToggleUp:"glyphicon-chevron-up",groupToggleDown:"glyphicon-chevron-down",glyphClass:".glyphicon",actions:[],refreshUrl:null};a.prototype._init=function(){if(!this.options.uniqueName){this.options.uniqueName=this.element.attr("id")}if(!this.options.uniqueName){throw"form needs a unique name or the element on which it is aplied has to have an id attr"}this._buttons=new Array();this._initSelectors();this._addDelegates();this._initAmplifyStore();this._addActions(this.options.actions);var b=this.$form.bsInitUI(this.options.style);b.done($.proxy(function(){this._trigger("afterInitUI",0,{name:this.options.uniqueName,form:this.$form})},this))};a.prototype._initSelectors=function(){this.$form=this.element.is("form")?this.element:this.element.find("form")};a.prototype._addDelegates=function(){if(this.options.hasGroupToggle){this.element.on("click",this.options.groupToggleSelector,$.proxy(function(c){var b=$(c.currentTarget);this.toggleGroup(b)},this))}};a.prototype._initAmplifyStore=function(){if(this.options.saveGroupContainerState){var b=this._getKeyForGroupContainer();if(amplify.store(b)){try{var e=amplify.store(b);var c=this;this.$form.find(this.options.groupToggleSelector).each(function(f){var g=$(this).closest(c.options.groupToggleContainerSelector).data("keepopen");if(e[f]||g){c.showGroup($(this))}else{c.hideGroup($(this))}})}catch(d){console.warn("Error on saving on local storage:"+d)}}}};a.prototype._addActions=function(b){if(b){for(var c=0;c<b.length;c++){this._addAction(b[c])}}};a.prototype._addAction=function(c){var b=this.element.find(c.selector);if(b.length==0){throw"element with selector "+c.selector+" is not found in form container "+this.options.uniqueName}b.on("click",{buttonOpt:c,handlerContext:this.options.handlerContext},$.proxy(this._evBtnClick,this));this._buttons.push({name:c.name,elem:b})};a.prototype._evBtnClick=function(h){h.preventDefault();var b=$(h.currentTarget);var f=h.data.buttonOpt;var i=h.data.handlerContext;if(f.validate&&!this._validate()){return}var j=this.$form.validate();var g;if(f.parse){g=this._parse();if(typeof f.getExtraData==="function"){f.getExtraData.call(this,g,b)}var d={$button:b,buttonOpt:f,data:g};this._trigger("beforeFormSubmit",0,d);g=d.data}var c=b.data("action")||f.actionUrl;if(c){$.bforms.ajax({name:this.options.uniqueName,url:c,data:g,callbackData:{handler:f.handler,handlerContext:i,sent:g},context:this,success:$.proxy(this._btnClickAjaxSuccess,this),error:$.proxy(this._btnClickAjaxError,this),loadingElement:this.element,loadingClass:"loading",validationError:function(e){if(e!=null&&e.Errors!=null){if(typeof j==="undefined"){$.validator.unobtrusive.parse(this.$form);j=this.$form.validate()}j.showErrors(e.Errors,true);this._trigger("validationError",0,e)}}})}else{if(typeof f.handler!=="function"){throw"action "+f.name+" must implement an event handler or have an url option"}f.handler.call(this,g)}};a.prototype._parse=function(){return this.element.parseForm(this.options.prefix?this.options.prefix:"")};a.prototype._saveGroupContainer=function(){if(this.options.saveGroupContainerState){try{var c=[];var b=this._getKeyForGroupContainer();this.$form.find(this.options.groupToggleContainerSelector).each(function(){c.push($(this).next().is(":visible"))});amplify.store(b,c)}catch(d){console.warn("Error on saving on local storage:"+d)}}};a.prototype._validate=function(){this.$form.removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(this.$form);var c=this.$form.validate();var b=this.$form.valid();var d={validator:c,form:this.$form,name:this.options.uniqueName,isValid:b};this._trigger("beforeFormValidation",0,d);return this.$form.valid()&&d.isValid};a.prototype._getAction=function(b){return $.grep(this._buttons,function(c,d){return c.name==b})[0]};a.prototype._refresh=function(b){var c=$.Deferred();return $.bforms.ajax({name:"BsForm|Refresh|"+this.options.uniqueName,url:this.options.refreshUrl,data:b,callbackData:{deferred:c},context:this,success:this._onRefreshSuccess,error:this._onRefreshError,loadingElement:this.$form,loadingClass:"loading"})};a.prototype._getKeyForGroupContainer=function(){return this.options.appendUrlToUniqueName?"groupContainer|"+this.options.uniqueName+"|"+location.host+location.pathname:"groupContainer|"+this.options.uniqueName};a.prototype._btnClickAjaxSuccess=function(c,b){if(typeof b.handler==="function"){b.handler.call(this,b.sent,c,this)}};a.prototype._btnClickAjaxError=function(b){if(b.Message){var c=this.$form.data("validator");c.showSummaryError(b.Message)}this._trigger("ajaxError",0,b)};a.prototype._onRefreshSuccess=function(e,c){var b=$(e.Html);this.$form.html(b.html());this._initSelectors();this._initAmplifyStore();this._addActions(this.options.actions);this.element.bsResetForm(false,this.options.ignoreFields);var d=this.$form.bsInitUI(this.options.style);d.done($.proxy(function(){this._trigger("afterInitUI",0,{name:this.options.uniqueName,form:this.$form});c.deferred.resolve()},this))};a.prototype._onRefreshError=function(b){if(b.Message){var c=this.$form.data("validator");c.showSummaryError(b.Message)}};a.prototype.getFormData=function(b){var c=this.element.find("form");c.removeData("validator");c.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(c);var d=c.validate();this._trigger("beforeFormValidation",0,{validator:d,form:c,name:this.options.uniqueName});if(c.valid()){b=this._parse()}};a.prototype.parse=function(b){return this._parse()};a.prototype.triggerAction=function(c){var b=this._getAction(c);if(b!=null){b.elem.trigger("click")}};a.prototype.refresh=function(b){return this._refresh(b)};a.prototype.reset=function(b){this.removeSummarySuccess();this.element.bsResetForm(this.options.focusFirst,this.options.ignoreFields)};a.prototype.toggleGroup=function(b){if(this.options.hasGroupToggle){b.find(this.options.glyphClass).toggleClass(this.options.groupToggleUp).toggleClass(this.options.groupToggleDown);b.toggleClass("open").closest(this.options.groupToggleContainerSelector).next().stop().slideToggle($.proxy(this._saveGroupContainer,this))}};a.prototype.showGroup=function(b){if(this.options.hasGroupToggle){b.find(this.options.glyphClass).removeClass(this.options.groupToggleUp).addClass(this.options.groupToggleDown);b.addClass("open").closest(this.options.groupToggleContainerSelector).next().stop().slideDown($.proxy(this._saveGroupContainer,this))}};a.prototype.hideGroup=function(b){if(this.options.hasGroupToggle){b.find(this.options.glyphClass).addClass(this.options.groupToggleUp).removeClass(this.options.groupToggleDown);b.removeClass("open").closest(this.options.groupToggleContainerSelector).next().stop().slideUp($.proxy(this._saveGroupContainer,this))}};a.prototype.showSummarySuccess=function(d){var c=this.$form.find(".bs-validation_summary");if(c.length==0){c=$('<div class="col-sm-12 col-lg-12 bs-validation_summary"></div>');this.$form.prepend(c)}var b=$('<div class="bs-form-success alert alert-success"><button class="close" data-dismiss="alert" type="button">×</button>'+d+"</div>");c.html(b);return{element:b}};a.prototype.removeSummarySuccess=function(){var b=this.$form.find(".bs-validation_summary");if(b.length){b.html("")}};$.widget("bforms.bsForm",a.prototype);return a});define("bforms-toolbar-advancedSearch",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="advancedSearch";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_advanced_search"};a.prototype.init=function(){var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}var b=this.$container.find(this._defaultOptions.selector);var e=$.extend(true,this.options,{container:b.attr("id"),actions:c});this.$searchForm=this.$container.bsForm(e);this._initSearchModel(this.$searchForm.bsForm("parse"))};a.prototype._addDefaultOptions=function(){var c={name:"search",selector:".js-btn-search",validate:false,parse:true,handler:$.proxy(this._evOnSearch,this)};this._controls.search=c;var b={name:"reset",selector:".js-btn-reset",validate:false,parse:true,handler:$.proxy(this._evOnReset,this)};this._controls.reset=b};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnSearch=function(b){this.widget._trigger("beforeAdvancedSearch",0,{data:b});for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("search",b)}this.widget._trigger("afterAdvancedSearch",0,{data:b})};a.prototype._initSearchModel=function(b){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("initSearch",b)}};a.prototype._evOnReset=function(){this.$searchForm.bsForm("reset");var b={};this.$searchForm.bsForm("getFormData",b);for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("reset",b)}this.widget._trigger("afterAdvancedSearchReset",0,{data:b})};return a});define("bforms-toolbar-add",["jquery","bforms-toolbar","bforms-form"],function(){var a=function(b,c){this.name="add";this.type="tab";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c);this.widget=this.$toolbar.data("bformsBsToolbar");this._controls={};this._addDefaultOptions()};a.prototype._defaultOptions={selector:".bs-show_add"};a.prototype.init=function(){var b=this.$container.find(this._defaultOptions.selector);var c=[];for(var d in this._controls){if(d in this._controls){c.push(this._controls[d])}}var e=$.extend(true,this.options,{container:b.attr("id"),actions:c});this.$addForm=this.$container.bsForm(e)};a.prototype._addDefaultOptions=function(){var b={name:"save",selector:".js-btn-save",validate:true,parse:true,handler:$.proxy(this._evOnAdd,this)};this._controls.save=b;var c={name:"reset",selector:".js-btn-reset",validate:false,parse:false,handler:$.proxy(this._evOnReset,this)};this._controls.reset=c};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._evOnAdd=function(b,e){if(e.Row){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("add",e.Row,b,e)}}else{if(e.Rows){for(var d=0;d<e.Rows.length;d++){for(var c=0;c<this.widget.subscribers.length;c++){this.widget.subscribers[c].bsGrid("add",e.Rows[d],b,e)}}}}this.$addForm.bsForm("reset");this.widget._trigger("afterAdd",0,{data:b,response:e})};a.prototype._evOnReset=function(b){this.$addForm.bsForm("reset");this.widget._trigger("afterReset",0,{data:b})};return a});define("bforms-toolbar-quickSearch",["jquery"],function(){var a=function(b,c){this.name="quickSearch";this.type="custom";this.$toolbar=b;this.options=$.extend(true,{},this._defaultOptions,c)};a.prototype._defaultOptions={selector:".bs-quick_search",instant:true,timeout:250,removeBtn:".bs-remove"};a.prototype.init=function(){this.widget=this.$toolbar.data("bformsBsToolbar");this.$toolbar.on("keyup",this.options.selector+" .bs-text",$.proxy(this._evOnQuickSearchKeyup,this));this.$toolbar.find(this.options.selector).parents("form:first").on("submit",function(b){b.preventDefault()});this.$toolbar.on("click",this.options.removeBtn,$.proxy(this._onRemoveBtnClick,this))};a.prototype._evOnQuickSearchKeyup=function(d){var b=$(d.currentTarget);var g=b.val().trim();if(g.length==0&&b.data("empty")){return}var c=this.widget.getControl("advancedSearch");if(c!=null&&c.$element.hasClass("selected")){c.$element.trigger("click")}if(g.length==0){b.data("empty",true)}else{b.data("empty",false)}var f=d.which==13||d.keyCode==13;if(this.options.instant){if(!f){window.clearTimeout(this.quickSearchTimeout);this.quickSearchTimeout=window.setTimeout($.proxy(function(){this._search(g)},this),this.options.timeout)}else{this._search(g)}}else{if(f){this._search(g)}}};a.prototype._onRemoveBtnClick=function(b){b.preventDefault();this.$toolbar.find(this.options.selector+" .bs-text").val("");this._search("")};a.prototype._search=function(c){if(c!=""){this.$toolbar.find(this.options.removeBtn).show()}else{this.$toolbar.find(this.options.removeBtn).hide()}this.widget._trigger("beforeQuickSearch",0,{quickSearch:c});for(var b=0;b<this.widget.subscribers.length;b++){this.widget.subscribers[b].bsGrid("search",c,true)}this.widget._trigger("afterQuickSearch",0,{quickSearch:c})};a.prototype.reset=function(){this.$toolbar.find(this.options.selector+" .bs-text").val("");this.$toolbar.find(this.options.removeBtn).hide()};return a});define("bforms-toolbar-order",["jquery","bforms-toolbar","bforms-form","bforms-sortable"],function(){var a=function(b,c){this.options=$.extend(true,{},this._defaultOptions,c);this.name="order";this.type="tab";this.$toolbar=b;this.widget=b.data("bformsBsToolbar");this._controls={};this.updated=false;this.currentConnection={};this._addDefaultControls()};a.prototype.init=function(){var b=this.$container.find(this.options.selector);var c=[];for(var d in this._controls){if(this._controls.hasOwnProperty(d)){c.push(this._controls[d])}}this.$orderForm=this.$container.bsForm({container:b.attr("id"),actions:c});this.$sortable=$(this.options.containerSelector).find(this.options.listSelector+":first");this.bsSortableOptions={itemSelector:this.options.itemSelector,listSelector:this.options.listSelector,containerSelector:this.options.containerSelector,sortUpdate:$.proxy(this._evOnUpdate,this)};this.$sortable.bsSortable(this.bsSortableOptions);this.previousConfigurationHtml=this.$sortable.html();this._addDelegates()};a.prototype._defaultOptions={selector:".bs-show_order",itemSelector:".bs-sortable-item",listSelector:".bs-sortable",containerSelector:".sortable-container",serialize:"hierarchy"};a.prototype._addDefaultControls=function(){this._controls.reset={name:"reset",selector:".js-btn-reset",validate:false,parse:false,handler:$.proxy(this._evOnReset,this)};this._controls.save={name:"save",selector:".js-btn-save_order",validate:false,parse:false,handler:$.proxy(this._evOnSave,this)}};a.prototype.setControl=function(c,d){var b=this._controls[c];if(b){b=$.extend(true,{},b,d)}this._controls[c]=b};a.prototype._addDelegates=function(){$(this.options.containerSelector).on("update",$.proxy(this._evOnUpdate,this))};a.prototype._evOnUpdate=function(c,b){this.updated=true};a.prototype._evOnReset=function(){this.$sortable.html(this.previousConfigurationHtml);$(".placeholder").remove();this.$sortable.bsSortable(this.bsSortableOptions)};a.prototype._evOnSave=function(){if(this.updated||true){event.preventDefault();$(this._controls.save.selector).attr("disabled",true);this.$orderForm.attr("disabled",true);var b=this.$sortable.bsSortable("serialize",this.options.serialize);var c=$(this._controls.save.selector).data("url");this.widget._trigger("beforeOrderFormSubmit",event,{data:b});$(".loading-global").show();$.bforms.ajax({data:{model:b},url:c,success:this._reorderSuccess,error:this._reorderError,context:this,loadingClass:"loading"})}};a.prototype._reorderError=function(b){$(".loading-global").hide();this.$orderForm.removeAttr("disabled");$(this._controls.save.selector).attr("disabled",false);this.updated=false;this.widget._trigger("afterOrderFormSubmit",event,{response:b})};a.prototype._reorderSuccess=function(b){this.updated=false;$(".loading-global").hide();this.$orderForm.removeAttr("disabled");$(this._controls.save.selector).attr("disabled",false);this.previousConfigurationHtml=this.$sortable.html();this.widget._trigger("afterOrderFormSubmit",event,{response:b})};return a});define("bforms-groupEditor",["jquery","jquery-ui-core","bforms-pager","bforms-ajax","bforms-namespace","bforms-inlineQuestion","bforms-form","bforms-extensions"],function(){var a=function(b){this.options=$.extend(true,{},this.options,b);this._init()};a.prototype.options={uniqueName:"",enableQuickSearch:false,tabsSelector:".bs-tabs",groupsSelector:".bs-groups",groupSelector:".bs-group",navbarSelector:".bs-navbar",toolbarBtnSelector:".bs-toolbarBtn",editorFormSelector:".bs-editorForm",pagerSelector:".bs-pager",tabContentSelector:".bs-tabContent",tabItemSelector:".bs-tabItem",tabItemsListSelector:".bs-tabItemsList",groupBulkMoveSelector:".bs-moveToGroupBtn",groupBulkMoveMainSelector:".bs-bulkGroupMove",groupBulkMoveConfirmContent:"Are you sure?",groupBulkMoveConfirmShown:function(){},groupBulkMoveConfirm:false,groupBulkMoveConfirmBtns:[{text:"Yes",cssClass:"btn-primary bs-confirm",callback:function(){}},{text:"No",cssClass:"btn-theme bs-cancel",callback:function(b){}}],groupEditorFormSelector:".bs-groupForm",groupItemSelector:".bs-groupItem",groupItemTemplateSelector:".bs-itemTemplate",groupItemContentSelector:".bs-itemContent",groupItemsWrapper:".bs-itemsWrapper",groupItemsCounter:".bs-counter",tabInlineSearch:".bs-tabInlineSearch",removeBtn:".bs-removeBtn",addBtn:".bs-addBtn",selectedBtn:".bs-selectedBtn",editBtn:".bs-editBtn",upBtn:".bs-upBtn",downBtn:".bs-downBtn",toggleExpandBtn:".bs-toggleExpand",resetBtn:".bs-resetGroupEditor",saveBtn:".bs-saveGroupEditor",getTabUrl:"",validation:{},errorMessageContainer:".bs-errorMessage",errorMessageHolder:".bs-errorMessageHolder",noResultsItemTabSelector:".bs-noResultsTabItem",};a.prototype._init=function(){this.$element=this.element;if(!this.options.uniqueName){this.options.uniqueName=this.$element.attr("id")}if(!this.options.uniqueName){throw"grid needs a unique name or the element on which it is aplied has to have an id attr"}this._initOptions();this._initSelectors();this._initComponents();this._addDelegates();this._initSelectedTab();this._initTemplates();this._initSortable();this._initGroupItemForms()};a.prototype._initComponents=function(){this._countGroupItems();this._checkEditable()};a.prototype._initOptions=function(){this.options.saveUrl=this.options.saveUrl||this.$element.find(this.options.saveBtn).attr("href")};a.prototype._initSelectors=function(){this.$navbar=this.$element.find(this.options.navbarSelector);this.$tabs=this.$element.find(this.options.tabsSelector);this.$groups=this.$element.find(this.options.groupsSelector);this.$counter=this.$groups.find(this.options.groupItemsCounter);this.$groupForm=this.$element.find(this.options.groupEditorFormSelector)};a.prototype._addDelegates=function(){this.$navbar.on("click","a",$.proxy(this._evChangeTab,this));this.$tabs.find("div[data-tabid]").on("click","button"+this.options.toolbarBtnSelector,$.proxy(this._evChangeToolbarForm,this));this.$tabs.on("click",this.options.addBtn,$.proxy(this._evAdd,this));this.$tabs.on("click",this.options.selectedBtn,$.proxy(this._evPreventDefault,this));this.$groups.on("click",this.options.removeBtn,$.proxy(this._evRemove,this));this.$groups.on("click",this.options.editBtn,$.proxy(this._evEdit,this));this.$groups.on("click",this.options.upBtn,$.proxy(this._evUp,this));this.$groups.on("click",this.options.downBtn,$.proxy(this._evDown,this));this.$groups.on("click",this.options.toggleExpandBtn,$.proxy(this._evToggleExpand,this));this.$element.on("click",this.options.resetBtn,$.proxy(this._evResetClick,this));this.$element.on("click",this.options.saveBtn,$.proxy(this._evSaveClick,this));if(!this.options.groupBulkMoveConfirm){this.$tabs.on("click",this.options.groupBulkMoveSelector,$.proxy(this._evBulkMoveClick,this))}else{this.groupBulkInlineQuestion=this.$tabs.find(this.options.groupBulkMoveMainSelector).bsInlineQuestion({container:"body",toggle:"popover",placement:"top",content:this.options.groupBulkMoveConfirmContent,buttons:this.options.groupBulkMoveConfirmBtns,shown:this.options.groupBulkMoveConfirmShown,popoverOptions:{trigger:"manual"}});this.$tabs.on("click",this.options.groupBulkMoveSelector,$.proxy(function(d){var b=$(d.currentTarget),f=b.data("groupid");var c=b.parents(this.options.groupBulkMoveMainSelector+":first");c.bsInlineQuestion("option","additionalData",{groupId:f,groupEditor:this});c.bsInlineQuestion("show");d.preventDefault()},this))}};a.prototype._initSelectedTab=function(){this._initTab(this._getSelectedTab())};a.prototype._initTemplates=function(){this.element.find(this.options.groupSelector).each($.proxy(function(e,d){var b=$(d),c=b.find(this.options.groupItemTemplateSelector);b.data("template",c.children(":first").clone());c.remove()},this))};a.prototype._initTab=function(f,d){var e=this;if(f){var c=true;if(!f.loaded){c=false;this._ajaxGetTab({tabModel:f,data:{settings:{TabId:f.tabId}}})}if(f.html){f.container.find(this.options.tabContentSelector).html(f.html)}if(!f.pager){f.pager=f.container.find(this.options.pagerSelector);f.pager.bsPager({pagerUpdate:function(h,g){e._evChangePage(g,f)},pagerGoTop:$.proxy(this._evGoTop,this)})}if(d!==true){f.container.show()}if(c){this._checkItems()}if(f.container.data("init")!==true){this._trigger("onTabInit",0,f);var b=f.container.find(this.options.editorFormSelector);b.each($.proxy(function(i,h){var g=$(h),j=g.data("uid");if(typeof this.options.initEditorForm==="function"){this.options.initEditorForm(g,j,f)}},this));if(this.options.enableQuickSearch){f.container.on("keyup",this.options.tabInlineSearch,$.proxy(this._evInlineSearch,this,f))}else{f.container.on("change",this.options.tabInlineSearch,$.proxy(this._evInlineSearch,this,f))}}f.container.data("init",true);this._initDraggable(f);this._initBulkMove(f)}};a.prototype._initSortable=function(){this.$element.find(this.options.groupSelector).find(this.options.groupItemsWrapper).sortable({items:this.options.groupItemSelector,distance:5,connectWith:this.options.groupItemsWrapper,start:$.proxy(this._sortStart,this),beforeStop:$.proxy(this._beforeSortStop,this),stop:$.proxy(this._sortStop,this),handle:"header",cancel:".bs-notDraggable"})};a.prototype._initDraggable=function(b){b.container.find(this.options.tabItemSelector).each($.proxy(function(d,e){var c=$(e);this._checkItem(c,b.tabId,b.connectsWith);c.draggable(this._getDraggableOptions(b))},this))};a.prototype._initGroupItemForms=function(){if(this.$groupForm.length){this.$groupForm.bsForm({uniqueName:"groupEditorForm"})}var b=this.$element.find(this.options.groupsSelector).find(this.options.editorFormSelector);b.each($.proxy(function(d,c){this._initGroupItemForm($(c))},this))};a.prototype._initGroupItemForm=function(b,d){if(typeof d!=="undefined"){var c="prefix"+b.data("uid")+".";b.bsFillForm(d,c)}b.bsForm({uniqueName:b.data("uid")})};a.prototype._initBulkMove=function(b){b.container.find(this.options.groupBulkMoveSelector).each($.proxy(function(e,d){var c=$(d);if(jQuery.inArray(c.data("groupid"),b.connectsWith)<0){c.parent().remove()}},this))};a.prototype._evUp=function(d){d.preventDefault();var b=$(d.currentTarget).parents(this.options.groupItemSelector).first(),c=b.prevAll(this.options.groupItemSelector).first(),f=(b.outerHeight()+window.parseInt(b.css("margin-bottom"))),h=c.outerHeight()+window.parseInt(c.css("margin-top")),g=Math.min(f,h);if(c.length>0){b.animate({top:-g});c.animate({top:g},function(){c.css("top","auto");b.css("top","auto");c.before(b)});this._rebuildNumbers()}else{this._shakeElement(b)}};a.prototype._evDown=function(d){d.preventDefault();var b=$(d.currentTarget).parents(this.options.groupItemSelector).first(),c=b.nextAll(this.options.groupItemSelector).first(),f=(b.outerHeight()+window.parseInt(b.css("margin-bottom"))),i=(c.outerHeight()+window.parseInt(c.css("margin-top"))),h=Math.min(f,i);var g=b.css("z-index"),k=c.css("z-index");var j=window.parseInt(k,10);if(!window.isNaN(j)){b.css("z-index",j+1)}else{b.css("z-index",16777271);c.css("z-index",16777270)}if(c.length>0){b.animate({top:h});c.animate({top:-h},function(){b.css("z-index",g);c.css("z-index",k);c.css("top","auto");b.css("top","auto");c.after(b)});this._rebuildNumbers()}else{this._shakeElement(b)}};a.prototype.bulkMoveToGroup=function(e,c){var d=this._getSelectedTab(),b=d.container.find(this.options.tabItemSelector),f=false;b.each($.proxy(function(h,i){var g=$(i);f=this.addToGroup({objId:g.data("objid"),itemModel:g.data("model"),tabId:d.tabId},e,true,c)||f},this));if(!f){this._showMoveError(this.$element)}};a.prototype._evBulkMoveClick=function(c){var b=$(c.currentTarget),d=b.data("groupid");this.bulkMoveToGroup(d);c.preventDefault()};a.prototype._evToggleExpand=function(f){f.preventDefault();var c=$(f.currentTarget),d=c.parents("[data-groupid]"),b=d.find(this.options.groupItemsWrapper);b.toggle("fast",$.proxy(function(){d.find(this.options.toggleExpandBtn).toggleClass("open")},this))};a.prototype._evChangeToolbarForm=function(d){d.preventDefault();var c=$(d.currentTarget),g=c.data("uid"),f=this._getSelectedTab(),b=f.container,h=b.find("div[data-uid]:visible"),i=h.data("uid");h.slideUp();if(i!=g){b.find("div[data-uid='"+g+"']").slideDown()}};a.prototype._evChangeTab=function(f){f.preventDefault();var c=$(f.currentTarget),h=c.data("tabid"),b=this._getTab(h),g=this._isLoaded(b),d=b.data("connectswith");this._hideTabs();this._initTab({container:b,loaded:g,tabId:h,connectsWith:d})};a.prototype._evChangePage=function(b,c){this._ajaxGetTab({tabModel:c,data:{settings:{Page:b.page,PageSize:b.pageSize||5,TabId:c.tabId}}})};a.prototype._evGoTop=function(b){b.preventDefault();$.bforms.scrollToElement(this.$element.find(this.options.navbarSelector))};a.prototype._evRemove=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parents(this.options.groupItemSelector);this._removeItemGroup(c)};a.prototype._evAdd=function(g){g.preventDefault();var b=$(g.currentTarget),d=b.parents(this.options.tabItemSelector),h=d.data("objid"),j=this._getSelectedTab(),i=j.tabId,f=j.connectsWith,c=this._getGroups(f);$.each(c,$.proxy(function(n,m){var e=$(m);if(!this._isInGroup(h,i,e)){var l=true,p=this._getTabItem(i,h),o=p.data("model");if(typeof this.options.validateMove==="function"){var q=this.options.validateMove(o,i,e);l=typeof q==="boolean"?q:true}if(l){var k=this._getGroupItemTemplate($(m),i,h,o);var r=this._renderGroupItem(o,m,i,h);k.find(this.options.groupItemContentSelector).html(r);this._checkEditableItem(k);this._initGroupItemForm(k.find(this.options.editorFormSelector),o);e.find(this.options.groupItemsWrapper).append(k);this._trigger("onTabItemAdd",0,{model:o,tabId:i,$row:k,$group:e});this.validateUnobtrusive();d.effect("transfer",{to:e.find(k)});this._checkItem(this._getTabItem(i,h),i,f);return false}}},this));this._countGroupItems()};a.prototype._evEdit=function(d){d.preventDefault();var b=$(d.currentTarget),c=b.parents(this.options.groupItemSelector),g=c.data("objid"),h=c.data("tabid"),f=c.parents("[data-groupid]").data("groupid");throw"[objId: "+g+", groupId: "+f+", tabId: "+h+"] . not implemented yet"};a.prototype._evResetClick=function(b){this.reset();b.preventDefault();b.stopPropagation()};a.prototype._evSaveClick=function(c){c.preventDefault();c.stopPropagation();var d=this.parse();if(d.valid){var b=d.data;if(typeof this.options.additionalData!=="undefined"){$.extend(true,b,this.options.additionalData)}this._trigger("beforeSaveAjax",0,b);this._ajaxSaveGroup(b)}};a.prototype._evInlineSearch=function(f,c){var b=$(c.currentTarget),d=b.val();f.QuickSearch=d;this.search(f)};a.prototype._ajaxSaveGroup=function(b){$.bforms.ajax({name:this.options.uniqueName+"|saveGroupEditor",url:this.options.saveUrl,data:b,callbackData:b,context:this,success:$.proxy(this._ajaxSaveGroupSuccess),error:$.proxy(this._ajaxSaveGroupError),loadingElement:this.$element,loadingClass:"loading"})};a.prototype._ajaxSaveGroupSuccess=function(c,b){this._trigger("onSaveSuccess",0,arguments)};a.prototype._ajaxSaveGroupError=function(c,b){if(typeof c!=="undefined"&&typeof c.Message==="string"){this._showValidationError(c.Message)}this._trigger("onSaveError",0,arguments)};a.prototype._ajaxGetTab=function(c){if(typeof this.options.additionalData!=="undefined"){$.extend(true,c.data,this.options.additionalData)}this._trigger("beforeGetTab",0,c);var b={name:this.options.uniqueName+"|getTab|"+c.tabModel.tabId,url:this.options.getTabUrl,data:c.data,callbackData:c,context:this,success:$.proxy(this._ajaxGetTabSuccess,this),error:$.proxy(this._ajaxGetTabError,this),loadingElement:c.tabModel.container,loadingClass:"loading"};$.bforms.ajax(b)};a.prototype._ajaxGetTabSuccess=function(d,c){if(d){this._trigger("onGetTabSuccess",0,arguments);var b=c.tabModel.container;b.data("loaded","true");if(d.Html){this._initTab({container:b,loaded:true,html:d.Html,tabId:c.tabModel.tabId,connectsWith:b.data("connectswith")},c.data.preventShow)}}};a.prototype._ajaxGetTabError=function(){console.trace();this._trigger("onGetTabError",0,arguments)};a.prototype._checkEditable=function(){$.each(this._getGroupItems(),$.proxy(function(b,c){this._checkEditableItem($(c))},this))};a.prototype._checkEditableItem=function(b){if(this._isTabEditable(b.data("tabid"))){b.find(this.options.editBtn).show()}};a.prototype._rebuildNumbers=function(){};a.prototype._shakeElement=function(b){b.effect("shake",{times:2,direction:"up",distance:10},50)};a.prototype._countGroupItems=function(){this.$counter.html(this._getGroupItems().length)};a.prototype._checkItem=function(b,d,c){if(this._isItemSelected(b.data("objid"),d,c,b.data("model"))){this._toggleItemCheck(b,false)}};a.prototype._checkItems=function(){var c=this._getSelectedTab(),b=c.container.find(this.options.tabItemSelector);$.each(b,$.proxy(function(d,e){this._checkItem($(e),c.tabId,c.connectsWith)},this))};a.prototype._isItemSelected=function(h,i,d,g){var b=this._getGroups(d),c=0,e=0;$.each(b,$.proxy(function(m,l){var j=$(l),n=this._isInGroup(h,i,j),k=true;if(typeof this.options.validateMove==="function"){var o=this.options.validateMove(g,i,j);k=typeof o==="boolean"?o:true}if(k){c++}if(n){e++}},this));var f=this.getItemCount(h);return(c>0||f>0)?(c==0?(c+f===e):c===e):false};a.prototype._isInGroup=function(e,f,b){var d=false,c=b.find(this.options.groupItemSelector);$.each(c,function(h,i){var g=$(i);if(g.data("objid")==e&&g.data("tabid")==f&&!g.hasClass("temp-sortable")){d=true;return false}});return d};a.prototype._toggleItemCheck=function(d,f){var b=d.find("span.glyphicon"),c=b.parents("a:first"),e=this.options.addBtn.replace(".",""),g=this.options.selectedBtn.replace(".","");if(f&&!d.hasClass("selected")){return false}if(!f&&d.hasClass("selected")){return false}d.toggleClass("selected");c.toggleClass(e);c.toggleClass(g);if(b.hasClass("glyphicon-ok")){b.removeClass("glyphicon-ok").addClass("glyphicon-plus");if(c.hasClass("disabled")){c.hide()}}else{b.removeClass("glyphicon-plus").addClass("glyphicon-ok");if(c.hasClass("disabled")){c.show()}}this._trigger("afterToggleItem",0,arguments)};a.prototype._removeItemGroup=function(b){var d=b.data("tabid"),c=b.data("objid");b.effect("drop",$.proxy(function(){b.remove();this._toggleItemCheck(this._getTabItem(d,c),true);this._countGroupItems()},this))};a.prototype._uncheckAllItems=function(){var b=this.$element.find(this.options.tabItemSelector+".selected");b.each($.proxy(function(c,d){this._toggleItemCheck($(d),true)},this))};a.prototype._getSelectedTab=function(){var b=this.$tabs.find("div[data-tabid]:visible"),e=b.data("tabid"),c=b.data("connectswith"),d=this._isLoaded(b);return{container:b,tabId:e,connectsWith:c,loaded:d}};a.prototype._hideTabs=function(){var b=this.$tabs.find("div[data-tabid]");b.hide()};a.prototype._isLoaded=function(b){var c=b.data("loaded");return c=="true"||c=="True"||c==true};a.prototype._getTab=function(b){return this.$tabs.find('div[data-tabid="'+b+'"]')};a.prototype._isTabEditable=function(b){return this._getTab(b).data("editable")};a.prototype._getTabItem=function(e,d){var b=this._getTab(e),c=b.find(this.options.tabItemSelector+'[data-objid="'+d+'"]');return c};a.prototype._getGroup=function(b){return this.$groups.find('div[data-groupid="'+b+'"]')};a.prototype._getGroupItems=function(){return this.$groups.find(this.options.groupItemSelector+":not("+this.options.groupItemTemplateSelector+" >)")};a.prototype._getGroups=function(c){var b;if(c){b=[];$.each(c,$.proxy(function(e,d){b.push(this._getGroup(d))},this))}else{b=this.$groups.find("div[data-groupid]")}return b};a.prototype._getGroupItemTemplate=function(b,g,f,e){var h=b.data("template").clone();h.data("objid",f);h.data("tabid",g);h.data("model",e);var d=h.html();d=d.replace(/__tabid__/gi,g);d=d.replace(/{{tabid}}/gi,g);d=d.replace(/__objid__/gi,g);d=d.replace(/{{objid}}/gi,f);h.html(d);var c={template:h};this._trigger("afterGetGroupItemTemplate",0,c);return c.template};a.prototype._renderGroupItem=function(c,b,e,d){if(typeof this.options.buildGroupItem==="function"){return this.options.buildGroupItem(c,b,e,d)}else{if(typeof c.Name==="undefined"){throw"No buildGroupItem method define and no Name property found on object"}else{return c.Name}}};a.prototype._getDraggableOptions=function(b){return{distance:5,connectToSortable:this._buildConnectsWithSelector(b.connectsWith),helper:typeof this.options.buildDragHelper==="function"?$.proxy(this._buildDragElement,this):"clone",cursorAt:{top:typeof this.options.getCursorAtTop==="function"?this.options.getCursorAtTop(b):0,left:typeof this.options.getCursorAtLeft==="function"?this.options.getCursorAtLeft(b):0,},start:$.proxy(this._dragStart,this),stop:$.proxy(this._dragStop,this),cancel:".selected, .bs-notDraggable"}};a.prototype._buildDragElement=function(g){var b=$(g.currentTarget),h=b.data("model"),d=b.parents("[data-tabid]"),i=d.data("tabid"),f=d.data("connectswith");var c=$(this.options.buildDragHelper(h,i,f));return c};a.prototype._buildConnectsWithSelector=function(b){var d="";for(var c in b){d+=this.options.groupSelector+'[data-groupid="'+b[c]+'"] '+this.options.groupItemsWrapper;if(c<b.length-1){d+=", "}}return d};a.prototype._dragStart=function(f,g){var b=$(f.target),c=b.parents("[data-connectswith]"),d=c.data("connectswith");this._dragging=true;this._addOpacity(d);this._trigger("onDragStart",0,arguments)};a.prototype._dragStop=function(){this._dragging=false;this._removeOpacity();this._trigger("onDragStop",0,arguments);this._countGroupItems()};a.prototype._sortStart=function(c,f){var b=f.item,d=b.parents(this.options.groupSelector).data("groupid");b.data("groupid",d).addClass("temp-sortable");this._trigger("onSortStart",0,arguments)};a.prototype._beforeSortStop=function(b,c){};a.prototype._sortStop=function(h,r){this._trigger("onSortStop",0,arguments);var c=r.item,b=c.parents(this.options.groupSelector).first(),p=this._getSelectedTab(),g=p.connectsWith||[],l=c.data("model"),o=p.tabId,i=b.data("groupid"),m=c.data("objid");this._removeOpacity();var k=this._isInGroup(m,o,b),j=g.indexOf(i)!==-1,f=j&&!k;c.removeData("groupid").removeClass("temp-sortable");if(this._dragging!==true){var n=c.data("groupid"),q=b.data("groupid");if(n==q){return}}if(typeof this.options.validateMove==="function"){var s=this.options.validateMove(l,o,b);f=typeof s==="boolean"?s:f}if(f){var d=this._getGroupItemTemplate(b,o,m,l);var t=this._renderGroupItem(l,b,o,m);d.find(this.options.groupItemContentSelector).html(t);this._initGroupItemForm(d.find(this.options.editorFormSelector),l);this._checkEditableItem(d);r.item.replaceWith(d);this._trigger("onTabItemAdd",0,{model:l,tabId:o,$row:d,$group:b});this.validateUnobtrusive();this._checkItem(this._getTabItem(o,m),o,g)}else{this._showMoveError(b);if(!this._dragging){return false}else{r.item.remove()}}};a.prototype._showMoveError=function(b){if(typeof this.options.showMoveError==="function"){this.options.showMoveError(b)}else{this.$element.css({cursor:"not-allowed"});window.setTimeout($.proxy(function(){this.$element.css({cursor:""})},this),300)}};a.prototype._addOpacity=function(c){var b=this.$element.find(this.options.groupSelector);c=c||[];b.each(function(f,e){var d=$(e),g=d.data("groupid");if(c.indexOf(g)===-1){d.css("opacity","0.3")}})};a.prototype._removeOpacity=function(){var b=this.$element.find(this.options.groupSelector);b.css("opacity","1")};a.prototype._evPreventDefault=function(b){b.preventDefault()};a.prototype.parse=function(k){var j={},c=this.$groups.find(this.options.groupSelector),h=true,i=0;c.each($.proxy(function(q,n){var l=$(n),p=l.data("propertyname"),o={Items:[]};var m=l.find(this.options.groupItemSelector).filter($.proxy(function(r,s){return $(s).parents(this.options.groupItemTemplateSelector).length==0},this));m.each($.proxy(function(v,u){var s=$(u),w={};w.Id=s.data("objid");w.TabId=s.data("tabid");var r=s.find(this.options.editorFormSelector);if(r.length){var x="prefix"+r.data("uid")+".";r.find("form").removeData("validator").removeData("unobstrusiveValidation");$.validator.unobtrusive.parse(r.find("form"));var z=r.find("form").validate(),t=r.find("form").valid(),y={validator:z,valid:t,$form:r,$item:s,$group:l};this._trigger("onGroupItemFormValidation",0,y);h=h&&y.valid;w.Form=r.parseForm(x)}this._trigger("getExtraItemData",0,[w,s,l]);o.Items.push(w);i++},this));this._trigger("getExtraGroupData",0,[o,l]);j[p]=o},this));if(this.$groupForm.length){var d=this.$groupForm.parseForm();j.form=d;var b=this.$groupForm.find("form");if(b.length){$.validator.unobtrusive.parse(b);var f=b.validate(),g=b.valid();var e={$form:b,valid:g,validator:f};this._trigger("onGroupFormValidation",0,e);h=h&&e.valid}}h=this.valid()&&h;if(h){this._removeValidationError()}return{data:j,valid:h}};a.prototype.reset=function(c){this._trigger("beforeReset");if(typeof c==="undefined"||c==false){this.$element.find(this.options.groupItemSelector).remove();this.$counter.html(0)}var b=this.$tabs.find("*[data-loaded]").filter(function(){var d=$(this).data("loaded");return d==true||d=="true"});b.each($.proxy(function(f,g){var d=$(g),h={container:d,loaded:true,tabId:d.data("tabid"),connectsWith:d.data("connectswith")},e={settings:{Page:1,PageSize:5,TabId:h.tabId,},preventShow:true};this._trigger("beforeResetTab",0,e);this._ajaxGetTab({tabModel:h,data:e})},this));this._uncheckAllItems();this._rebuildNumbers();this._removeValidationError();this.$element.find("form").bsResetForm();this._trigger("afterReset")};a.prototype.filterGroupItems=function(c,d,e){var b=this._getGroup(c);b.find(this.options.groupItemSelector).each($.proxy(function(g,h){var f=$(h);var i=f.data("model");if(!i.hasOwnProperty(d)||i[d]!=e){this._removeItemGroup(f)}},this))};a.prototype.setTabContent=function(b){var c=this._getSelectedTab();c.html=b;this._initTab(c)};a.prototype.addTabItem=function(b){var c=this._getSelectedTab();c.container.find(this.options.tabItemsListSelector).prepend(b);b.draggable(this._getDraggableOptions(c));c.container.find(".bs-pager").bsPager("add");c.container.find(this.options.noResultsItemTabSelector).remove()};a.prototype.getItemCount=function(c,d){var b=this.$groups.find(this.options.groupItemSelector).filter(function(){return $(this).data("objid")==c&&(typeof d!=="undefined"?$(this).data("tabid")==d:true)}).length;return b};a.prototype.addToGroup=function(i,j,m,f){var b=this._getGroup(j),l=i.objId,n=i.tabId,k=i.itemModel,c=this._getTab(n),h=c.data("connectswith"),d=this._getTabItem(n,l);if(d.length&&typeof k==="undefined"){k=d.data("model")}var g=!this._isInGroup(l,n,b);if(typeof this.options.validateMove==="function"){var o=this.options.validateMove(k,n,b);g=typeof o==="boolean"?o:g}if(g){var e=this._getGroupItemTemplate(b,n,l,k);var p=this._renderGroupItem(k,b,n,l);e.find(this.options.groupItemContentSelector).html(p);this._checkEditableItem(e);this._initGroupItemForm(e.find(this.options.editorFormSelector));b.find(this.options.groupItemsWrapper).append(e);this._trigger("onTabItemAdd",0,{model:k,tabId:n,$row:e,$group:b,additionalData:f});if(d.length){if(m!==true){d.effect("transfer",{to:b.find(e)})}this._checkItem(d,n,h)}}this._countGroupItems();return g};a.prototype.search=function(e,d){var f;if(typeof e==="number"){var b=this.$element.find("[data-tabid="+e+"]");f={container:b,loaded:container.data("loaded"),tabId:e,connectsWith:b.data("connectswith")}}else{f=e}var c={tabModel:f,data:{settings:{Page:1,PageSize:5,TabId:f.tabId,QuickSearch:f.QuickSearch},preventShow:true,search:d}};this._trigger("beforeTabSearch",0,c);this._ajaxGetTab({tabModel:c.tabModel,data:c.data})};a.prototype.valid=function(){var b=true;for(var c in this.options.validation){if(typeof this["_validate_"+c]==="function"){b=this["_validate_"+c].apply(this,[true,c])&&b}}return b};a.prototype.validateUnobtrusive=function(){var b=true;for(var c in this.options.validation){if(this.options.validation[c].unobtrusive===true&&typeof this["_validate_"+c]==="function"){b=this["_validate_"+c].apply(this,[true,c])&&b}}if(b){this._removeValidationError()}return b};a.prototype._showValidationError=function(e){var d=this.$element.find(this.options.saveBtn);if(!d.hasClass("btn-danger")){this.$element.find(this.options.saveBtn).removeClass("btn-default").addClass("btn-danger")}if(typeof e!=="undefined"){var b=this._createErrorContainer(e);var c=this.$element.find(this.options.errorMessageContainer);if(c.length){c.replaceWith(b)}else{this.$element.find(this.options.groupSelector).first().before(b)}$.bforms.scrollToElement(b)}};a.prototype._removeValidationError=function(){var b=this.$element.find(this.options.saveBtn);if(!b.hasClass("btn-default")){this.$element.find(this.options.saveBtn).removeClass("btn-danger").addClass("btn-default")}this.$element.find(this.options.errorMessageContainer).remove()};a.prototype._createErrorContainer=function(e){var c=$("<div></div>").addClass("alert alert-danger").addClass(this.options.errorMessageContainer.replace(".",""));var b=$("<button></button>").addClass("close").attr("data-dismiss","alert").prop("type","button").text("×");var d=$("<div></div>").addClass(this.options.errorMessageHolder.replace(".",""));if(typeof e!=="undefined"){d.html(e)}c.append(b).append(d);return c};a.prototype._validate_required=function(e,d){var c=this.$element.find(this.options.groupItemSelector).length;var b=c>0;if(!b&&e===true){if(typeof this["_showError_"+d]==="function"){this["_showError_"+d].apply(this,[this.options.validation[d].message])}else{this._showValidationError(this.options.validation[d].message)}}return b};a.prototype.addValidationRule=function(c,d,b){if(typeof d==="function"){this["_validate_"+c]=d}if(typeof b==="function"){this["_showError_"+c]=b}};$.widget("bforms.bsGroupEditor",a.prototype);return a});(function(a){if(typeof define==="function"&&define.amd){define("bforms-themeSelect",["jquery","jquery-ui-core","amplify"],a)}else{a(window.jQuery)}}(function(a){var b=requireConfig.websiteOptions;String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var c=function(){};c.prototype.options={targets:"body, .form_container, .grid_toolbar, .grid_view, .bs-datetime-picker, .bs-range-picker, .bs-pager",startTheme:b.startTheme,themeEnum:b.themeEnum,availableColors:"turqoise orange red green blue purple black",toggleSelector:".bs-toggleThemeSelect",openSelector:".bs-selectThemeOpen",closeSelector:".bs-selectThemeClose",defaultTheme:"turqoise",optionsSelector:".bs-selectThemeOptions",localStorageSave:false,ajaxSaveUrl:b.saveThemeUrl};c.prototype._init=function(){this.$element=this.element;this._currentColor=this.options.startTheme||"Default";if(this._currentColor=="Default"){this._isDefaultSelected=true}this._currentColorClass=this._currentColor.toLowerCase();this._isOpen=this.$element.find(this.options.closeSelector).is(":visible");if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}this._addDelegates();this._restoreState()};c.prototype._addDelegates=function(){this.$element.on("click",this.options.optionsSelector+" a",a.proxy(this._onColorSelect,this));this.$element.on("click",this.options.toggleSelector,a.proxy(this._onToggleClick,this))};c.prototype._onColorSelect=function(f){f.preventDefault();var d=a(f.currentTarget);if(d.data("isdefault")){this._isDefaultSelected=true}else{this._isDefaultSelected=false}var g=d.data("color");this.setColor(g)};c.prototype._onToggleClick=function(d){d.preventDefault();if(this._isOpen){this.close()}else{this.open()}};c.prototype.setColor=function(d){try{a(this.options.targets).removeClass(this.options.availableColors);a(this.options.targets).removeClass(d);a(this.options.targets).addClass(d);this._currentColor=d;this._currentColorClass=d;if(this._isDefaultSelected){this.$element.find('*[data-isdefault="true"]').parent().hide()}else{this.$element.find('*[data-isdefault="true"]').parent().show()}}catch(f){throw"Invalid targets for themeSelect"}this._saveState()};c.prototype.getCurrentColorClass=function(){return this._currentColorClass};c.prototype.open=function(){this.element.find(this.options.openSelector).hide();this.element.find(this.options.closeSelector).show();this.element.removeClass("collapsed");this._isOpen=true};c.prototype.close=function(){this.element.find(this.options.closeSelector).hide();this.element.find(this.options.openSelector).show();this.element.addClass("collapsed");this._isOpen=false};c.prototype._saveState=function(){if(this.options.localStorageSave){var d={Theme:this._currentColor.toUpperCaseFirst(),Open:this._isOpen};amplify.store("themeSelect",d)}if(this.options.ajaxSaveUrl!=null){a.ajax({url:this.options.ajaxSaveUrl,data:{Theme:this._isDefaultSelected?"Default":this.options.themeEnum[this._currentColor.toUpperCaseFirst()],Open:this._isOpen,},type:"POST"})}};c.prototype._restoreState=function(){if(this.options.localStorageSave===true){var e=amplify.store("themeSelect");if(typeof e!=="undefined"&&e!=null){if(e.Theme){var d=e.Theme.toLowerCase();this.setColor(d)}if(e.open){this.open()}}}};a.widget("bforms.bsThemeSelect",c.prototype);return c}));(function(a){if(typeof define==="function"&&define.amd){define("bforms-panel",["jquery","bootstrap","amplify","bforms-ajax","bforms-form"],a)}else{a(window.jQuery)}})(function(a){var b=function(){};b.prototype.options={collapse:true,loaded:false,editable:true,toggleSelector:".bs-togglePanel",editSelector:".bs-editPanel",cancelEditSelector:".bs-cancelEdit",saveFormSelector:".bs-savePanel",containerSelector:".bs-containerPanel",contentSelector:".bs-contentPanel",retrySelector:".bs-retryBtn",headerToggle:false,headerSelector:".bs-panelHeader",cacheReadonlyContent:true,additionalData:{},formOptions:{validateSave:true,parseSave:true,},expandable:true,formSelector:"form",retryMessage:"Reload"};b.prototype._init=function(){if(this.element.hasClass("bs-hasPanel")){return this.element}this.$element=this.element;this.$element.addClass("bs-hasPanel");this.$toggleElement=this.$element.find(this.options.toggleSelector);this._loadOptions();this._initDefaultProperties();this._initSelectors();this._delegateEvents();if(this.options.loaded===true){this._initControls();this._loadState();this._initCurrentContent()}else{var c=this._readonly?"_loadReadonlyContent":"_loadEditableContent";this[c]().then(a.proxy(function(){this._initControls();this._loadState()},this))}if(!this.$toggleElement.data("expandable")){this._loadState(true)}};b.prototype._loadOptions=function(){var c=this.$element.data("settings");a.extend(true,this.options,c)};b.prototype._initDefaultProperties=function(){this._name=this.options.name||this.$element.prop("id");if(typeof this._name==="undefined"||this._name==""){throw"boxForm requires an unique name"}this._componentId=this.$element.data("component");if(typeof this._componentId==="undefined"){console.warn("No component id specified for "+this._name)}this._objId=this.$element.data("objid");this._key=window.location.pathname+"|BoxForm|"+this._name;if((typeof this.options.initialReadonly==="undefined"||this.options.initialReadonly==true)&&this.$element.data("readonly")!==false){this.showReadonly()}else{this.showEditable()}this.options.readonlyUrl=this.options.readonlyUrl||this.$element.data("readonlyurl");this.options.editableUrl=this.options.editableUrl||this.$element.data("editableurl");this.options.saveUrl=this.options.saveUrl||this.$element.data("saveurl");this._allowExpand=this.options.loaded};b.prototype._initSelectors=function(){this.$container=this.$element.find(this.options.containerSelector);this.$content=this.$element.find(this.options.contentSelector)};b.prototype._delegateEvents=function(){if(this.options.expandable){this.$element.on("click",this.options.toggleSelector,a.proxy(this._onToggleClick,this))}if(this.options.editable!==false){if(this.options.headerToggle){this.$element.on("click",this.options.headerSelector,a.proxy(this._onHeaderClick,this))}else{this.$element.on("click",this.options.editSelector,a.proxy(this._onEditClick,this))}}this.$element.on("click",this.options.cancelEditSelector,a.proxy(this._onCancelEditClick,this));this.$element.on("click",this.options.retrySelector,a.proxy(this._onRetryClick,this))};b.prototype._initCurrentContent=function(){if(this._readonly){}else{this._initEditable()}};b.prototype._onToggleClick=function(d){d.preventDefault();d.stopPropagation();var c=a(d.currentTarget);if(!c.data("expandable")){return}if(this._allowExpand){if(this._state){this.close()}else{this.open()}}};b.prototype._onHeaderClick=function(c){if(this._readonly==true){this._loadEditableContent().then(a.proxy(function(){if(!this._state&&this._allowExpand){this.open()}},this));c.preventDefault();c.stopPropagation()}};b.prototype._onEditClick=function(c){c.preventDefault();c.stopPropagation();this._loadEditableContent().then(a.proxy(function(){if(!this._state&&this._allowExpand){this.open()}},this))};b.prototype._onCancelEditClick=function(c){c.preventDefault();c.stopPropagation();if(this.options.cacheReadonlyContent&&this._cachedReadonlyContent){this.$content.html(this._cachedReadonlyContent);this.showReadonly();this._toggleEditBtn(true);if(!this._state){this.open()}}else{this._loadReadonlyContent().then(a.proxy(function(){this._toggleEditBtn(true);if(!this._state){this.open()}},this))}};b.prototype._onRetryClick=function(d){var c=a(d.currentTarget),f=c.data("method");if(typeof this[f]==="function"){this[f]()}};b.prototype._saveState=function(){if(this._shouldSaveState()){amplify.store(this._key,this._state)}};b.prototype._loadState=function(c){if(c){this.open();return}var d=amplify.store(this._key);if(d!=null){if(d==true){this.open()}else{this.close()}}};b.prototype._shouldSaveState=function(){return this.options.expandable};b.prototype._initControls=function(){if(this.options.editable&&this.options.isEditableBtnVisible){this._toggleEditBtn(this._readonly?true:false)}};b.prototype._toggleLoading=function(c){if(c){this.$element.find(".bs-panelLoader").show()}else{this.$element.find(".bs-panelLoader").hide()}};b.prototype._toggleCaret=function(c){if(c){this.$element.find(".bs-panelCaret").show()}else{this.$element.find(".bs-panelCaret").hide()}};b.prototype._toggleEditBtn=function(c){if(c){this.$element.find(this.options.cancelEditSelector).hide().end().find(this.options.editSelector).show()}else{this.$element.find(this.options.editSelector).hide().end().find(this.options.cancelEditSelector).show()}};b.prototype._getXhrData=function(){return a.extend(true,{},{componentId:this._componentId,objId:this._objId},this.options.additionalData)};b.prototype._showErrorMessage=function(e,d,g,f){var c=a('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+e+'<div><a href="#" class="bs-retryBtn" data-method="'+f+'">'+this.options.retryMessage+' <span class="glyphicon glyphicon-refresh"></span> </a></div></div>');if(g){d.html(c)}else{d.append(c)}};b.prototype._initEditable=function(){var c=this.$content.find(this.options.formSelector).show(),d=c.find(this.options.saveFormSelector);this._allowExpand=true;if(c.length==0){console.warn("No editable form found")}if(d.length==0){console.warn("No save button found")}if(this.options.formOptions.parseSave!=true){}var e=a.extend(true,{},{prefix:this.options.prefix,actions:[{name:"save",selector:this.options.saveFormSelector,validate:this.options.formOptions.validateSave,actionUrl:this.options.saveUrl,parse:true,getExtraData:a.proxy(function(f){f.componentId=this._componentId;f.objId=this._objId;a.extend(true,f,this.options.formAdditionalData);this._trigger("beforeSaveAjax",0,f)},this),handler:a.proxy(function(g,f){this._trigger("beforeEditSuccessHandler",0,f);this.$content.html(f.Html);this._toggleLoading();this._toggleEditBtn(true);if(this.options.cacheReadonlyContent){this._cachedReadonlyContent=this.$content.html()}this._trigger("onReadonlyLoadSuccess",0,f);this.showReadonly();this._trigger("editSuccessHandler",0,f)},this)}]},this.options.formOptions);this.$content.find(this.options.formSelector).bsForm(e);this._trigger("afterFormInit",0)};b.prototype._loadReadonlyContent=function(c){var d=a.extend(true,this._getXhrData(),c);this._trigger("beforeReadonlyLoad",0,d);this.$content.find(this.options.formSelector).addClass("loading");return a.bforms.ajax({name:"BsPanel|LoadReadonly|"+this._name,url:this.options.readonlyUrl,data:d,context:this,success:this._onReadonlyLoadSuccess,error:this._onReadonlyLoadError})};b.prototype._onReadonlyLoadSuccess=function(c){this.$content.html(c.Html);this._toggleLoading();this._toggleCaret(true);this._allowExpand=true;if(this.options.cacheReadonlyContent){this._cachedReadonlyContent=this.$content.html()}this._trigger("onReadonlyLoadSuccess",0,c);this.showReadonly()};b.prototype._onReadonlyLoadError=function(d){this.$content.find(this.options.formSelector).removeClass("loading");if(d.Message){var c=this.$element.find(".bs-panel-error");if(c.length==0){c=a('<div class="col-sm-12 col-lg-12 bs-validation_row_control bs-panel-error"></div>');this.$container.before(c)}this._toggleLoading();this._showErrorMessage(d.Message,c,true,"_loadReadonlyContent")}};b.prototype._loadEditableContent=function(c){var d=a.extend(true,this._getXhrData(),c);this._trigger("beforeEditableLoad",0,d);this.$content.find(this.options.formSelector).addClass("loading");this.$element.addClass("loading");return a.bforms.ajax({name:"BsPanel|LoadEditable|"+this._name,url:this.options.editableUrl,context:this,data:d,success:this._onEditableLoadSuccess,error:this._onEditableLoadError})};b.prototype._onEditableLoadSuccess=function(c){if(this.options.cacheReadonlyContent&&this._readonly==true){this._cachedReadonlyContent=this.$content.clone().find(this.options.formSelector).removeClass("loading").end().html()}this.$content.html(c.Html);this._initEditable();this._toggleEditBtn();this._toggleLoading();this._toggleCaret(true);this.$element.removeClass("loading");this._trigger("onEditableLoadSuccess",0,c);this.showEditable()};b.prototype._onEditableLoadError=function(d){this.$content.find(this.options.formSelector).removeClass("loading");if(d.Message){var c=this.$element.find(".bs-panel-error");if(c.length==0){c=a('<div class="col-sm-12 col-lg-12 bs-validation_row_control bs-panel-error"></div>');this.$container.before(c)}this._toggleLoading();this.$element.removeClass("loading");this._showErrorMessage(d.Message,c,true,"_loadEditableContent")}};b.prototype.open=function(){var c={allowOpen:true,$content:this.$content};this._trigger("beforeOpen",c);if(c.allowOpen===true){this.$container.stop(true,true).slideDown(300);this.$container.addClass("in");this.$element.find(this.options.toggleSelector).addClass("dropup")}this._state=true;this._saveState();this._trigger("afterOpen")};b.prototype.close=function(){var c={allowClose:true,$content:this.$content};this._trigger("beforeClose",c);if(c.allowClose===true){this.$container.stop(true,true).slideUp(300,a.proxy(function(){this.$container.removeClass("in")},this));this.$element.find(this.options.toggleSelector).removeClass("dropup")}this._state=false;this._saveState();this._trigger("afterClose")};b.prototype.showReadonly=function(){this._readonly=true;this.$element.data("readonly",true);this.$element.removeClass("bs-panelEditMode");this._trigger("onReadonlyShow",0)};b.prototype.showEditable=function(){this._readonly=false;this.$element.data("readonly",false);this.$element.addClass("bs-panelEditMode");this._trigger("onEditableShow",0)};b.prototype.save=function(){var c=this.$content.find(this.options.formSelector);if(typeof c.bsForm==="function"){c.bsForm("triggerAction","save")}};b.prototype.refresh=function(c){var d=this._readonly?"_loadReadonlyContent":"_loadEditableContent";this[d](c).then(a.proxy(function(){this._initControls();this._loadState()},this))};b.prototype.showErrorMessage=function(e,f){var d=this.$element.find(".bs-panel-error");if(d.length==0){d=a('<div class="col-sm-12 col-lg-12 bs-validation_row_control bs-panel-error"></div>');this.$container.before(d)}var c=a('<div class="bs-form-error alert alert-danger"><button class="close" data-dismiss="alert" type="button">×</button>'+e+"</div>");if(f){d.html(c)}else{d.append(c)}};a.widget("bforms.bsPanel",b.prototype);return b});define("bforms-ajax",["bforms-namespace","jquery"],function(){var a=function(){this._xhrStack={};$(window).on("beforeunload",$.proxy(function(){this._willUnload=true},this))};a.prototype._getStack=function(){return this._xhrStack};a.prototype._statusEnum={Success:1,ValidationError:2,Denied:3,ServerError:4,Timeout:5,Offline:6};a.prototype.getAjaxOptions=function(){return $.extend(true,{},$.bforms.defAjaxOptions)};a.prototype._updateXHRSettings=function(b){var c=$.extend(true,{},b);c.data=b.contentType===$.bforms.defAjaxOptions.contentType?JSON.stringify(this._serializeJsonData(b.data)):b.data;if($.bforms.defaultHeaders!=null){c.beforeSend=function(f){for(var e in $.bforms.defaultHeaders){var d=$.bforms.defaultHeaders[e];f.setRequestHeader(d.key,d.value)}}}return c};a.prototype._serializeJsonData=function(b){var d;if(b instanceof Array){d=b.slice(0)}else{d=$.extend(true,{},b)}for(var c in d){if(d.hasOwnProperty(c)){if(d[c] instanceof $){throw"Cannot send jQuery objects via ajax"}if(typeof d[c]==="number"){d[c]+=""}else{if(typeof d[c]==="object"){d[c]=this._serializeJsonData(d[c])}}}}return d};a.prototype._killPrevious=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null&&typeof c.jqXHR.abort==="function"&&c.finished!==true){c.aborted=true;c.finished=true;c.jqXHR.abort();this._xhrStack[b]=c;this._toggleLoading(c,true)}};a.prototype._toggleLoading=function(f,e){var c=typeof f==="string"?this._xhrStack[f]:f,d=(typeof c!=="undefined"&&c.settings.loadingClass!=="undefined")?c.settings.loadingClass:this._defaultLoadingClass;if(typeof c!=="undefined"&&typeof c.settings!=="undefined"){var b=c.settings.loadingElement;if(b!=null&&b.length){window.clearTimeout(c.loadingTimeout);if(e){c.loadingTimeout=window.setTimeout(function(){d==null?b.show():b.addClass(d)},c.settings.loadingDelay)}else{d==null?b.hide():b.removeClass(d)}}}};a.prototype._getQueryStringObject=function(){var b=location.search.slice(1).split("&");var c={};b.forEach(function(d){if(d){d=d.split("=");c[d[0]]=decodeURIComponent(d[1]||"")}});return JSON.parse(JSON.stringify(c))};a.prototype.ajax=function(e,b){var g=this._checkForFiles(e.data);var h=$.extend({},this.getDefaultOptions(),e),d=null;if(e.parseQueryString===true){$.extend(true,h.data,this._getQueryStringObject())}h.name=h.name||h.url;if(h.killPrevious===true){this._killPrevious(h.name)}var c=$.Deferred();c.done($.proxy(function(j,i){if(j===this._statusEnum.Success){if(typeof e.success==="function"){e.success.apply(e.context,i)}}else{if(j===this._statusEnum.ValidationError){if(typeof e.validationError==="function"){e.validationError.apply(e.context,i)}if(typeof e.error==="function"){e.error.apply(e.context,i)}}}if(j===this._statusEnum.ServerError){if(typeof e.serverError==="function"){e.serverError.apply(e.context,i)}if(typeof e.error==="function"){e.error.apply(e.context,i)}}if(j===this._statusEnum.Denied){this._handleUnauthorized.apply(self,[h,i[0]]);if(typeof e.denied==="function"){e.denied.apply(e.context,i)}if(typeof e.error==="function"){e.error.apply(e.context,i)}}},this));c.fail($.proxy(function(j,i){if(j===this._statusEnum.ServerError){if(typeof e.serverError==="function"){e.serverError.apply(e.context,i)}}else{if(j===this._statusEnum.Denied){this._handleUnauthorized.apply(self,[h,i[0]]);if(typeof e.denied==="function"){e.denied.apply(e.context,i)}}}if(j===this._statusEnum.Timeout){if(typeof e.onTimeout==="function"){e.onTimeout.apply(e.context,i)}}if(j===this._statusEnum.Offline){window.setTimeout($.proxy(function(){if(this._willUnload!==true){if(typeof e.offline==="function"){e.offline.apply(e.context,i)}if(typeof e.error==="function"){e.error.apply(e.context,i)}}},this),h.offlineDelay)}else{if(typeof e.error==="function"){e.error.apply(e.context,i)}}},this));if(typeof e.complete==="function"){c.always($.proxy(e.complete,e.context))}if(typeof e.progress==="function"){c.progress($.proxy(e.progress,e.context))}if(g){d=this._ajaxWithFiles(h,b,c)}else{d=this._ajaxWithoutFiles(h,b,c)}var f=c.promise();f.abort=d.abort;f.success=c.done;f.error=c.fail;this._toggleLoading(h.name,true);if(typeof b!=="undefined"&&b!=null){b.deferred=c}return f};a.prototype.getDefaultOptions=function(){return $.extend(true,{},$.bforms.defAjaxOptions)};a.prototype.abort=function(b){var c=this._xhrStack[b];if(typeof c!=="undefined"&&c!=null&&c.jqXHR!=null){c.jqXHR.abort();c.aborted=true}};a.prototype._ajaxWithoutFiles=function(h,c,d){var f=this,e=$.extend({},h,{success:function(k,l,j){var m=f._xhrStack[h.name];if(m.aborted===true){return}f._applyLocalization(k,m.settings.lang);try{if(k.Status==f._statusEnum.Success||k.Status==f._statusEnum.ValidationError){d.resolve(k.Status,[k.Data,h.callbackData])}else{d.reject(k.Status,[k,j,l,null,h.callbackData])}}catch(i){if(typeof i.stack!=="undefined"){console.warn("Exception occurred in ajax request");console.log(i.stack)}else{console.warn("Exception occurred in ajax request: "+i)}}},error:function(k,m,i){var n=f._xhrStack[h.name];if(typeof n!=="undefined"&&n!=null&&n.aborted===true){return}try{if(m=="timeout"){f._handleTimeout.apply(f,[h,d,n,k,m,i])}else{if(k.status==401){f._handleUnauthorized.apply(f,[h,d,n,k,m,i])}var l={Message:i,Status:f._statusEnum.ServerError};if(k.status===0&&k.responseText===""){l.Status=f._statusEnum.Offline}if(typeof k.responseText!=="undefined"&&k.responseText!=""){try{l=JSON.parse(k.responseText)}catch(j){}}f._applyLocalization(l,n.settings.lang);d.reject(l.Status,[l,k,m,i,h.callbackData])}}catch(j){window.console.log(j.stack);d.reject(f._statusEnum.ServerError,[{Message:i},k,m,i,h.callbackData])}},complete:function(){var i=f._xhrStack[h.name];if(typeof i!=="undefined"&&i!=null){i.finished=true}f._toggleLoading(h.name,false)}});var b=this._updateXHRSettings(e);var g=this._xhrStack[h.name]={jqXHR:$.ajax(b),aborted:false,settings:h};return g.jqXHR};a.prototype._ajaxWithFiles=function(g,b,d){var j=new XMLHttpRequest(),c=new FormData(),h=this;$.bforms.flattenObject(g.data,c);g.contentType="";$.extend(true,j,$.extend(true,{},this.getDefaultOptions(),g));j.upload.addEventListener("progress",$.proxy(function(i){i.percentage=(i.loaded/i.total)*100;d.notify(i,g.callbackData)},this));j.onreadystatechange=$.proxy(function(i){var n=this._xhrStack[j.name];if(j.readyState===4&&n.aborted!==true){var l=false;try{var m=JSON.parse(j.responseText);l=true}catch(k){d.reject(h._statusEnum.ServerError,[m!=null?m.Data:null,j,j.statusText,null,g.callbackData])}if(l){try{if(m.Status==h._statusEnum.Success||m.Status==h._statusEnum.ValidationError){d.resolve(m.Status,[m.Data,g.callbackData])}else{d.reject(m.Status,[m.Data,j,j.statusText,null,g.callbackData])}}catch(k){window.console.log(k.stack)}}n.finished=true;h._toggleLoading(g.name,false)}},this);j.open("POST",g.url,true);j.setRequestHeader("X-Requested-With","XMLHttpRequest");if($.bforms.defaultHeaders!=null){for(var f in $.bforms.defaultHeaders){var e=$.bforms.defaultHeaders[f];j.setRequestHeader(e.key,e.value)}}j.send(c);this._xhrStack[g.name]={jqXHR:j,aborted:false,settings:g};return this._xhrStack[g.name].jqXHR};a.prototype._handleTimeout=function(g,b,f,d,e,c){b.reject(this._statusEnum.Timeout,[{Message:this._getResource(f.settings.lang,"TimeoutOccurred")},d,e,c,g.callbackData])};a.prototype._handleUnauthorized=function(c,b){if(b!=null&&b.Data!=null&&typeof b.Data.ReturnUrl==="string"){window.location.href=b.Data.ReturnUrl}else{if(typeof c.unauthorizedRedirectUrl==="string"&&c.unauthorizedRedirectUrl!=""){window.location.href=c.unauthorizedRedirectUrl}}};a.prototype._applyLocalization=function(d,c){if(!d.Message){var e;for(var b in this._statusEnum){if(this._statusEnum[b]==d.Status){e=b;break}}if(typeof e==="string"&&typeof $.bforms.ajaxResources[c]==="object"&&typeof $.bforms.ajaxResources[c][e]==="string"){d.Message=$.bforms.ajaxResources[c][e]}}};a.prototype._getResource=function(c,b){if($.bforms.ajaxResources[c]!=null){return $.bforms.ajaxResources[c][b]}return""};a.prototype._checkForFiles=function(b){if(typeof File!=="undefined"){if(b instanceof $){throw"Cannot send jQuery objects via ajax"}if(b instanceof File){return true}else{if(b instanceof Array||b instanceof Object){for(var d in b){var c=this._checkForFiles(b[d]);if(c){return true}}}}}else{return false}};$.extend(true,$.bforms,new a());$.bforms.ajaxResources=$.extend(true,$.bforms.ajaxResources,{en:{ValidationError:"A validation error has occured",Denied:"The request was denied",ServerError:"Server error",TimeoutOccurred:"Timeout ocurred",Offline:"The computer appears to be offline"}});$.bforms.addResources=function(b,c){if(typeof $.bforms.ajaxResources[b]!=="undefined"){$.extend(true,$.bforms.ajaxResources[b],c)}else{$.bforms.ajaxResources[b]=c}};$.bforms.defAjaxOptions={cache:false,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",context:null,registerGlobal:true,killPrevious:true,loadingDelay:100,parseQueryString:true,lang:typeof requireConfig!=="undefined"?requireConfig.locale:"en",offlineDelay:5000};$.bforms.addDefaultOption=function(b,c){if(typeof $.bforms.defAjaxOptions==="undefined"||$.bforms.defAjaxOptions==null){$.bforms.defAjaxOptions={}}$.bforms.defAjaxOptions[b]=c};$.bforms.setHeaders=function(b){$.bforms.defaultHeaders=b};return a});/*
 * BForms v1.0.0 Alpha
 * http://bforms.veritech.io
 *
 * Copyright 2013 Stefan Prodan and contributors
 * http://github.com/vtfuture/BForms/contributors
 * Licensed under the MIT license
 */
define("bforms-namespace",["jquery","jquery-migrate"],function(a){a.nsx=function(d){var f=d.split("."),e=a,c;if(f[0]==="$"){f=f.slice(1)}else{if(f[0]==="jQuery"){f=f.slice(1)}}for(c=0;c<f.length;c+=1){if(typeof e[f[c]]==="undefined"){e[f[c]]={}}e=e[f[c]]}return e};a.nsx("bforms");var b=function(){};b.prototype.scrollToElement=function(e){var c=$(e);if(c.length>0){var h=a.bforms.getViewport();var g=$(e).offset().top;var f=h.height/2;var d=g;if(f<g){d=g-f}else{d=0}if($.browser.msie&&$.browser.mobile){$("html").scrollTop(d)}else{$("html,body").animate({scrollTop:d},500)}}};b.prototype.getViewport=function(){var i=window,c=document,f=c.documentElement,h=c.getElementsByTagName("body")[0],j=i.innerWidth||f.clientWidth||h.clientWidth,k=i.innerHeight||f.clientHeight||h.clientHeight;return{width:j,height:k}};b.prototype.param=function(c,g){var e,f=[],d=function(h,i){i=a.isFunction(i)?i():(i==null?"":i);f[f.length]=encodeURIComponent(h)+"="+encodeURIComponent(i)};if(g===undefined){g=a.ajaxSettings&&a.ajaxSettings.traditional}if(a.isArray(c)||(c.jquery&&!a.isPlainObject(c))){a.each(c,function(){d(this.name,this.value)})}else{for(e in c){this.buildParams(e,c[e],g,d)}}return f.join("&").replace("/%20/g","+")};b.prototype.buildParams=function(f,e,g,c){var d;if(a.isArray(e)){a.each(e,$.proxy(function(h,j){if(g||/\[\]$/.test(f)){c(f,j)}else{this.buildParams(f+"["+h+"]",j,g,c)}},this))}else{if(!g&&a.type(e)==="object"){for(d in e){this.buildParams(f+"."+d,e[d],g,c)}}else{c(f,e)}}};b.prototype.flattenObject=function(c,g,f){if(f==null){f=""}if(c instanceof Array){var d=0;for(d;d<c.length;d++){this.flattenObject(c[d],g,f+"["+d+"]")}}else{if(c instanceof Object&&!(c instanceof File)){for(var e in c){this.flattenObject(c[e],g,f==""?e:f+"."+e)}}else{if(g instanceof FormData){g.append(f,c)}else{g[f]=c}}}};b.prototype.inherit=function(e,d){for(var f in d){if(d.hasOwnProperty(f)){e[f]=d[f]}}function c(){this.constructor=e}c.prototype=d.prototype;e.prototype=new c()};$.extend(true,$.bforms,new b());return b});